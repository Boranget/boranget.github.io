---
title: 网页打卡功能位置校验逻辑
date: 2025-02-27 10:35:19
updated: 2025-02-27 16:35:19
tags:
  - 位置
  - 微信web
categories:
  - experience
---

# 功能概述

使用微信网页，在其中调用微信的功能获取当前经纬度，使用百度地图api获取详细地址，从而进行位置校验

# 调试方法

1. 手机开启usb调试模式并使用数据线连接电脑
2. Edge浏览器打开chrome://inspect/#devices。
3. 手机的微信上打开路径http://debugxweb.qq.com/?inspector=true，页面展示成功后（微信官网）关闭页面。后打开要看的页面
4. 在Edge浏览器打开的页面可以看到设备，和要看的页面路径。点击路径下方的
    inspect fallback。即可弹出微信手机内置浏览器页面。
5. 调试窗口会与当前手机端操作同步
6. 调试窗口的上方地址栏可直接输入地址，输入地址并回车后手机端会同步跳转

# 具体逻辑

使用微信的获取位置功能获取当前位置，并将位置存储在当前环境

```js
wx.ready(function() {
    console.log("准备定位2333"),
        wx.getLocation({
        altitude: !0,
        type: "gcj02",
        success: function(t) {
            // 可在此处拦截t，修改经纬度
            console.log(t, "res!!!");
            var o = t.latitude
            , n = t.longitude
            , i = new BMap.Geocoder;
            i.getLocation(new BMap.Point(n,o), function(t) {
                t && (e.writePageParams.addressDetail = t.address,
                      e.writePageParams.province = t.addressComponents.province,
                      e.writePageParams.city = t.addressComponents.city,
                      _.province = t.addressComponents.province,
                      _.city = t.addressComponents.city,
                      console.log("新地址？", t))
            });
            t.speed,
                t.accuracy;
            e.writePageParams.longitude = n,
                e.writePageParams.latitude = o,
                _.longitude = n,
                _.latitude = o;
            var a = !1;
            decodeURI(location.search.substring(1)).indexOf("|") > 0 && (a = !0,
                                                                         console.log());
            for (var s = {}, r = location.search.substring(1), l = r.split("&"), d = 0; d < l.length; d++) {
                var p = l[d].indexOf("=");
                if (p != -1) {
                    var g = l[d].substring(0, p);
                    s[g] = l[d].substring(p + 1)
                }
            }
            var f = s.code;
            s.state;
            window.localStorage.token = "",
                a && (e.currentDate = decodeURI(r).split("|")[2].replace(/\-/gi, ""),
                      e.showCurrentDate = decodeURI(r).split("|")[2],
                      e.showWeek = e.weekArray[new Date(decodeURI(r).split("|")[2]).getDay()],
                      console.log("来自于消息推送", e.currentDate)),
                f ? u.wxLogin(f, V, e.currentDate, n, o, I) : c.showShortCenterToast("微信授权失败,请联系管理员!")
        },
        fail: function(e) {
            console.log(e, "getLocation err!!!")
        }
    })
}),
```

在每次切换相关内容时，使用api校验是否超出范围

