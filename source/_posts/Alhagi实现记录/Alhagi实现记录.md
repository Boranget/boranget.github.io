---
title: Alhagi实现记录
date: 2024-11-17 21:35:19
updated: 2024-11-17 21:35:19
tags:
  - 编辑器
  - markdown
categories:
  - notes
---

# 参考资料

https://spec.commonmark.org/0.31.2/

# CommonMark解析策略

先将文档分解为块结构，但不解析文本，链接引用定义可以先收集起来

- 按行解析
  - 先判断当前行内容是否能加到已有容器中， 从根节点的最后一个子节点A开始，检测当前行的开头元素， 若能匹配，则取该节点A的最后一个子节点B，继续匹配当前行的剩余元素，以此类推，直到已有的最深层容器无法匹配当前行；若不能匹配，则容器指针指向当前容器上一级，并且将当前指针另存为T，用于后期关闭使用
- 判断当前行剩余内容可以解析成什么块，如果说 解析成了容器块，则说明后面还有叶子块，循环解析，直到解析到叶子块，并将后面所有内容添加到叶子块中
  - 如果没能匹配到任何块，则说明是纯文本内容，有以下几种处理：
    - 判断当前容器是否能包含纯文本
  - 新创建一个段落块
    - 添加到现有段落的懒延续中
- 关闭：从当前节点开始，向上级关闭，直到关闭到T，（T不关闭，因为下一行可能还要放在这个容器中）