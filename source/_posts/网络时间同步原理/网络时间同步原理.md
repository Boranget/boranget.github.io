---
title: 网络时间同步原理
date: 2025-09-21 20:27:19
updated: 2025-09-21 20:27:19
tags:
  - 时间同步
categories:
  - 笔记
---

# 参考资料

[(36 封私信 / 80 条消息) 网络时间同步是怎么实现的？怎样消除延迟带来的影响？ - 知乎](https://www.zhihu.com/question/21045190)https://springdoc.cn/spring-boot-resilience4j/)

[计算机网络时间同步技术原理介绍 - CodeInsight - SegmentFault 思否](https://segmentfault.com/a/1190000005337116)

# 简述

计算机在进行时间同步时，理想的情况是客户端发送时间查询请求，服务器将当前时间响应，客户端将本机时间设为服务器响应时间，但现实情况是，网络传输数据是有时延的。

# NTP

服务器在UDP的132端口提供授时服务，客户端发送附带T1时间戳（Timestamp）的查询报文给服务器，服务器在该报文上添加到达时刻T2和响应报文发送时刻T3，客户端记录响应报到达时刻T4。

![NTP时间同步](网络时间同步原理/bVwyAB)

- 网络延时（蓝色部分） = (t4 - t1) - (t3 - t2)
- 假设来回网络链路是对称的，则客户端与服务端的时间差 = t2 - t1 - （网络延时 / 2） = ((t2 - t1) + (t3 - t4)) / 2

客户端在本机时间上加上时间差即可，存在的不足有：

- 四个时间点的获取是程序计算，存在程序执行时的延迟
- 网络上传递信息不一定是对称的

# PTP

![ptp时间同步](网络时间同步原理/bVwyAE)

- a.主时钟向从时钟发送Sync报文，并在**本地记录**发送时间t1；从时钟收到该报文后，**本地记录**接收时间t2。
- b.时钟发送Sync报文之后，紧接着发送一个携带有t1的Follow_Up报文。
- c.从时钟向主时钟发送Delay_Req报文，用于发起反向传输延时的计算，并在**本地记录**发送时间t3；主时钟收到该报文后，**本地记录**接收时间t4。
- d.主时钟收到Delay_Req报文之后，回复一个携带有t4的Delay_Resp报文。

与NTP不同的是，PTP的主时钟使用广播的方式，且当前记录的时间并不会在当前请求发送，而是先在本地记录，下次请求再带上

计算方式与NTP相同，核心优势在于使用硬件记录时间戳，依赖专用网卡