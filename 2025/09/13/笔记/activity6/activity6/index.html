<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>activity6 | Boranget.博客</title><meta name="author" content="Boranget"><meta name="copyright" content="Boranget"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="参考资料 十分钟认识Activiti6.0工作流引擎 - 知乎 基本概念activity6能做到的东西其实就是根据画好的流程图走流程，但是具体流程里的逻辑，还是需要自定义实现，比如点击哪个按钮走到下一步，这个肯定是前后端配合实现。 流程图流程图可以使用满足activity6协议的各种工具绘画，最后会生成一个xml的配置文件，activity流程引擎会根据该文件来判断流程的全局结构  1234567">
<meta property="og:type" content="article">
<meta property="og:title" content="activity6">
<meta property="og:url" content="https://boranget.github.io/2025/09/13/%E7%AC%94%E8%AE%B0/activity6/activity6/index.html">
<meta property="og:site_name" content="Boranget.博客">
<meta property="og:description" content="参考资料 十分钟认识Activiti6.0工作流引擎 - 知乎 基本概念activity6能做到的东西其实就是根据画好的流程图走流程，但是具体流程里的逻辑，还是需要自定义实现，比如点击哪个按钮走到下一步，这个肯定是前后端配合实现。 流程图流程图可以使用满足activity6协议的各种工具绘画，最后会生成一个xml的配置文件，activity流程引擎会根据该文件来判断流程的全局结构  1234567">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://boranget.github.io/assets/img/tx.png">
<meta property="article:published_time" content="2025-09-13T02:35:19.000Z">
<meta property="article:modified_time" content="2025-09-13T08:35:19.000Z">
<meta property="article:author" content="Boranget">
<meta property="article:tag" content="activity6">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://boranget.github.io/assets/img/tx.png"><link rel="shortcut icon" href="/assets/img/tx.png"><link rel="canonical" href="https://boranget.github.io/2025/09/13/%E7%AC%94%E8%AE%B0/activity6/activity6/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'activity6',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-13 16:35:19'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assets/img/tx.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">191</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">198</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Boranget.博客"><img class="site-icon" src="/assets/img/tx.png"/><span class="site-name">Boranget.博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">activity6</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-13T02:35:19.000Z" title="发表于 2025-09-13 10:35:19">2025-09-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-13T08:35:19.000Z" title="更新于 2025-09-13 16:35:19">2025-09-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="activity6"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/38035481"> 十分钟认识Activiti6.0工作流引擎 - 知乎</a></p>
<h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><p>activity6能做到的东西其实就是根据画好的流程图走流程，但是具体流程里的逻辑，还是需要自定义实现，比如点击哪个按钮走到下一步，这个肯定是前后端配合实现。</p>
<h1 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h1><p>流程图可以使用满足activity6协议的各种工具绘画，最后会生成一个xml的配置文件，activity流程引擎会根据该文件来判断流程的全局结构</p>
<p><img src="/2025/09/13/%E7%AC%94%E8%AE%B0/activity6/activity6/v2-75b2ce3dced08e6d3781fea52a9a7cc4_1440w.jpg" alt="img"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><span class="tag">&lt;<span class="name">definitions</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">xmlns:activiti</span>=<span class="string">&quot;http://activiti.org/bpmn&quot;</span> <span class="attr">xmlns:bpmndi</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot;</span> <span class="attr">xmlns:omgdc</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DC&quot;</span> <span class="attr">xmlns:omgdi</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DI&quot;</span> <span class="attr">xmlns:tns</span>=<span class="string">&quot;http://www.activiti.org/test&quot;</span> <span class="attr">typeLanguage</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">expressionLanguage</span>=<span class="string">&quot;http://www.w3.org/1999/XPath&quot;</span> <span class="attr">targetNamespace</span>=<span class="string">&quot;http://www.activiti.org/test&quot;</span> <span class="attr">id</span>=<span class="string">&quot;m1528728906382&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>=<span class="string">&quot;second_approve&quot;</span> <span class="attr">name</span>=<span class="string">&quot;二级审批流程&quot;</span> <span class="attr">isExecutable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">isClosed</span>=<span class="string">&quot;false&quot;</span> <span class="attr">processType</span>=<span class="string">&quot;None&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">startEvent</span> <span class="attr">id</span>=<span class="string">&quot;startEvent&quot;</span> <span class="attr">name</span>=<span class="string">&quot;开始&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">startEvent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;submitForm&quot;</span> <span class="attr">name</span>=<span class="string">&quot;填写审批信息&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">extensionElements</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activiti:formProperty</span> <span class="attr">id</span>=<span class="string">&quot;message&quot;</span> <span class="attr">name</span>=<span class="string">&quot;申请信息&quot;</span> <span class="attr">type</span>=<span class="string">&quot;string&quot;</span> <span class="attr">required</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">activiti:formProperty</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activiti:formProperty</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">name</span>=<span class="string">&quot;申请人姓名&quot;</span> <span class="attr">type</span>=<span class="string">&quot;string&quot;</span> <span class="attr">required</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">activiti:formProperty</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activiti:formProperty</span> <span class="attr">id</span>=<span class="string">&quot;submitTime&quot;</span> <span class="attr">name</span>=<span class="string">&quot;提交时间&quot;</span> <span class="attr">type</span>=<span class="string">&quot;date&quot;</span> <span class="attr">datePattern</span>=<span class="string">&quot;yyyy-MM-dd&quot;</span> <span class="attr">required</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">activiti:formProperty</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activiti:formProperty</span> <span class="attr">id</span>=<span class="string">&quot;submitType&quot;</span> <span class="attr">name</span>=<span class="string">&quot;确认申请&quot;</span> <span class="attr">type</span>=<span class="string">&quot;string&quot;</span> <span class="attr">required</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">activiti:formProperty</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">extensionElements</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">userTask</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow1&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;startEvent&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;submitForm&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusiveGateway</span> <span class="attr">id</span>=<span class="string">&quot;decideSubmit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;提交OR取消&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">exclusiveGateway</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow2&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;submitForm&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;decideSubmit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;tl_approve&quot;</span> <span class="attr">name</span>=<span class="string">&quot;主管审批&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">extensionElements</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activiti:formProperty</span> <span class="attr">id</span>=<span class="string">&quot;tlApprove&quot;</span> <span class="attr">name</span>=<span class="string">&quot;主管审批结果&quot;</span> <span class="attr">type</span>=<span class="string">&quot;string&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">activiti:formProperty</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activiti:formProperty</span> <span class="attr">id</span>=<span class="string">&quot;tlMessage&quot;</span> <span class="attr">name</span>=<span class="string">&quot;主管备注&quot;</span> <span class="attr">type</span>=<span class="string">&quot;string&quot;</span> <span class="attr">required</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">activiti:formProperty</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">extensionElements</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">userTask</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow3&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;decideSubmit&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;tl_approve&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;submitType == &quot;y&quot; || submitType == &quot;Y&quot;&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusiveGateway</span> <span class="attr">id</span>=<span class="string">&quot;decideTLApprove&quot;</span> <span class="attr">name</span>=<span class="string">&quot;主管审批校验&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">exclusiveGateway</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow4&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;tl_approve&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;decideTLApprove&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;endEvent&quot;</span> <span class="attr">name</span>=<span class="string">&quot;结束&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">endEvent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;endEventCancel&quot;</span> <span class="attr">name</span>=<span class="string">&quot;取消&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">endEvent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow8&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;decideSubmit&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;endEventCancel&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;submitType == &quot;n&quot; || submitType == &quot;N&quot;&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow9&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;decideTLApprove&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;submitForm&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;tlApprove == &quot;n&quot; || tlApprove == &quot;N&quot;&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;_2&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;decideTLApprove&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;endEvent&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span>&lt;![CDATA[$&#123;tlApprove == &quot;y&quot; || tlApprove == &quot;Y&quot;&#125;]]&gt;<span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">process</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">definitions</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="流程执行"><a href="#流程执行" class="headerlink" title="流程执行"></a>流程执行</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.activiti.engine.FormService;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.RuntimeService;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.TaskService;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.form.FormProperty;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.form.TaskFormData;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.form.StringFormType;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.form.DateFormType;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.runtime.ProcessInstance;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.task.Task;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.CommandLineRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Activiti工作流自动配置演示类</span></span><br><span class="line"><span class="comment"> * 作用：Spring Boot容器启动后，自动执行二级审批流程（second_approve）的启动与任务处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoConfigurationProcessDemo</span> &#123;</span><br><span class="line">    <span class="comment">// 日志对象（替换原@Slf4j注解，显式声明更直观）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(AutoConfigurationProcessDemo.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注入Activiti核心服务：</span></span><br><span class="line">    <span class="comment">// RuntimeService：负责流程实例的启动、暂停、查询等运行时操作</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RuntimeService runtimeService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TaskService：负责任务的查询、完成、分配等操作</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TaskService taskService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// FormService：负责处理流程表单数据，如获取任务表单属性、提交表单数据等</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FormService formService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册CommandLineRunner Bean</span></span><br><span class="line"><span class="comment">     * 特性：Spring Boot容器启动完成后，自动执行其run()方法，触发流程执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> CommandLineRunner 命令行执行器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CommandLineRunner <span class="title function_">createProcessCommandLineRunner</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> args -&gt; &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;=== Activiti工作流程序启动 ===&quot;</span>);</span><br><span class="line">            <span class="comment">// 1. 启动二级审批流程（流程定义Key：second_approve，对应BPMN文件中的process id）</span></span><br><span class="line">            <span class="type">ProcessInstance</span> <span class="variable">approvalProcessInstance</span> <span class="operator">=</span> startApprovalProcess(<span class="string">&quot;second_approve&quot;</span>);</span><br><span class="line">            <span class="comment">// 2. 处理流程中的所有任务（循环直至流程结束）</span></span><br><span class="line">            handleProcessTasks(approvalProcessInstance);</span><br><span class="line">            logger.info(<span class="string">&quot;=== Activiti工作流程序结束 ===&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动审批流程实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> processDefinitionKey 流程定义Key（来自BPMN文件的process id）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ProcessInstance 启动后的流程实例对象（包含流程实例ID、状态等信息）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ProcessInstance <span class="title function_">startApprovalProcess</span><span class="params">(String processDefinitionKey)</span> &#123;</span><br><span class="line">        <span class="comment">// 通过流程定义Key启动实例（类似根据类名创建对象，一个Key可生成多个实例）</span></span><br><span class="line">        <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService.startProcessInstanceByKey(processDefinitionKey);</span><br><span class="line">        logger.info(<span class="string">&quot;已启动流程，流程定义Key：&#123;&#125;&quot;</span>, processInstance.getProcessDefinitionKey());</span><br><span class="line">        <span class="keyword">return</span> processInstance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理流程中的所有待办任务</span></span><br><span class="line"><span class="comment">     * 逻辑：循环查询待办任务，获取控制台输入的表单数据，完成任务直至流程结束</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> processInstance 待处理的流程实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ParseException 日期格式解析异常（当输入日期不符合yyyy-MM-dd时抛出）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleProcessTasks</span><span class="params">(ProcessInstance processInstance)</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line">        <span class="comment">// 控制台扫描器：用于接收用户输入的表单数据</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">consoleScanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 循环条件：流程实例不为空且未结束（避免空指针与重复处理）</span></span><br><span class="line">        <span class="keyword">while</span> (processInstance != <span class="literal">null</span> &amp;&amp; !processInstance.isEnded()) &#123;</span><br><span class="line">            <span class="comment">// 查询当前所有待办任务</span></span><br><span class="line">            List&lt;Task&gt; pendingTaskList = taskService.createTaskQuery().list();</span><br><span class="line">            logger.info(<span class="string">&quot;当前待处理任务数量：&#123;&#125;&quot;</span>, pendingTaskList.size());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 遍历处理每个待办任务</span></span><br><span class="line">            <span class="keyword">for</span> (Task currentTask : pendingTaskList) &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;正在处理任务：&#123;&#125;&quot;</span>, currentTask.getName());</span><br><span class="line">                <span class="comment">// 1. 从控制台获取当前任务所需的表单数据（如申请人姓名、审批结果等）</span></span><br><span class="line">                Map&lt;String, Object&gt; taskFormData = getTaskFormDataFromConsole(consoleScanner, currentTask);</span><br><span class="line">                <span class="comment">// 2. 提交表单数据，完成当前任务（任务ID + 表单数据）</span></span><br><span class="line">                taskService.complete(currentTask.getId(), taskFormData);</span><br><span class="line">                <span class="comment">// 3. 更新流程实例状态（避免使用旧状态判断流程是否结束）</span></span><br><span class="line">                processInstance = runtimeService.createProcessInstanceQuery()</span><br><span class="line">                        .processInstanceId(processInstance.getId())</span><br><span class="line">                        .singleResult();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭扫描器，释放资源</span></span><br><span class="line">        consoleScanner.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从控制台获取单个任务的表单数据</span></span><br><span class="line"><span class="comment">     * 逻辑：先获取任务的表单属性（如申请信息、提交时间），再根据属性类型接收用户输入</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> consoleScanner 控制台扫描器（复用避免重复创建）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentTask 当前待处理任务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Map&lt;String, Object&gt; 任务表单数据（key：表单属性ID，value：用户输入值）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ParseException 日期格式解析异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title function_">getTaskFormDataFromConsole</span><span class="params">(Scanner consoleScanner, Task currentTask)</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line">        <span class="comment">// 获取当前任务的表单元数据（包含表单属性列表，如id、name、类型）</span></span><br><span class="line">        <span class="type">TaskFormData</span> <span class="variable">taskFormMeta</span> <span class="operator">=</span> formService.getTaskFormData(currentTask.getId());</span><br><span class="line">        List&lt;FormProperty&gt; formPropertyList = taskFormMeta.getFormProperties();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用静态方法，统一处理表单属性与用户输入的映射</span></span><br><span class="line">        <span class="keyword">return</span> buildFormDataFromConsole(consoleScanner, formPropertyList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 静态方法：根据表单属性列表，从控制台收集并构建表单数据</span></span><br><span class="line"><span class="comment">     * 支持类型：字符串（StringFormType）、日期（DateFormType，格式yyyy-MM-dd）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> consoleScanner 控制台扫描器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> formPropertyList 表单属性列表（来自任务表单元数据）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Map&lt;String, Object&gt; 构建后的表单数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ParseException 日期格式解析异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title function_">buildFormDataFromConsole</span><span class="params">(Scanner consoleScanner, List&lt;FormProperty&gt; formPropertyList)</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line">        <span class="comment">// 存储表单数据的Map（替换原Maps.newHashMap()，使用JDK原生类减少依赖）</span></span><br><span class="line">        Map&lt;String, Object&gt; formDataMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历每个表单属性，按类型处理用户输入</span></span><br><span class="line">        <span class="keyword">for</span> (FormProperty formProperty : formPropertyList) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">userInput</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">// 获取表单属性类型（判断是字符串还是日期）</span></span><br><span class="line">            <span class="keyword">if</span> (formProperty.getType() <span class="keyword">instanceof</span> StringFormType) &#123;</span><br><span class="line">                <span class="comment">// 字符串类型：直接提示用户输入</span></span><br><span class="line">                logger.info(<span class="string">&quot;请输入 &#123;&#125; ：&quot;</span>, formProperty.getName());</span><br><span class="line">                userInput = consoleScanner.nextLine();</span><br><span class="line">                formDataMap.put(formProperty.getId(), userInput);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (formProperty.getType() <span class="keyword">instanceof</span> DateFormType) &#123;</span><br><span class="line">                <span class="comment">// 日期类型：提示格式并解析输入（格式yyyy-MM-dd）</span></span><br><span class="line">                logger.info(<span class="string">&quot;请输入 &#123;&#125; （格式：yyyy-MM-dd）：&quot;</span>, formProperty.getName());</span><br><span class="line">                userInput = consoleScanner.nextLine();</span><br><span class="line">                <span class="type">SimpleDateFormat</span> <span class="variable">dateFormatter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">                <span class="type">Date</span> <span class="variable">formattedDate</span> <span class="operator">=</span> dateFormatter.parse(userInput);</span><br><span class="line">                formDataMap.put(formProperty.getId(), formattedDate);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 不支持的类型：打印日志提示（避免程序崩溃）</span></span><br><span class="line">                logger.info(<span class="string">&quot;暂不支持的表单类型：&#123;&#125;&quot;</span>, formProperty.getType());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 日志打印用户输入，便于调试</span></span><br><span class="line">            logger.info(<span class="string">&quot;您输入的 &#123;&#125; 内容：&#123;&#125;&quot;</span>, formProperty.getName(), userInput);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> formDataMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="主要组件"><a href="#主要组件" class="headerlink" title="主要组件"></a>主要组件</h1><h2 id="RepositoryService（流程仓库服务）"><a href="#RepositoryService（流程仓库服务）" class="headerlink" title="RepositoryService（流程仓库服务）"></a>RepositoryService（流程仓库服务）</h2><p>存储并解析流程定义，创建并部署流程</p>
<ul>
<li><p>把本地 &#x2F; 远程的 BPMN 文件（.bpmn20.xml）、表单文件等打包成 “部署包”，部署到 Activiti 数据库中（本质是将文件解析为数据库记录，供引擎识别）。</p>
</li>
<li><p>关键 API：<code>createDeployment()</code>（创建部署构建器）、<code>deploy()</code>（执行部署）。</p>
</li>
<li><p>示例：部署 “请假审批流程” 的 BPMN 文件</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repositoryService.createDeployment()</span><br><span class="line">                .addClasspathResource(<span class="string">&quot;processes/leave-approve.bpmn20.xml&quot;</span>) <span class="comment">// 加载BPMN文件</span></span><br><span class="line">                .name(<span class="string">&quot;请假审批流程V1.0&quot;</span>) <span class="comment">// 部署名称</span></span><br><span class="line">                .deploy(); <span class="comment">// 执行部署</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查询已部署的流程定义（如按流程 Key、版本号筛选），判断流程是否已部署、获取最新版本。</p>
</li>
<li><p>关键 API：<code>createProcessDefinitionQuery()</code>（创建流程定义查询器）、<code>deleteDeployment()</code>（删除部署，可选是否级联删除历史数据）。</p>
</li>
<li><p>场景：查询 “报销流程” 的所有版本，确认是否需要更新为最新版本。</p>
</li>
<li><p>从数据库中获取已部署的 BPMN 文件、流程图（.png）等原始资源，用于前端展示或二次编辑。</p>
</li>
<li><p>关键 API：<code>getResourceAsStream()</code>（获取资源流）。</p>
</li>
</ul>
<h2 id="RuntimeService（流程运行时服务）"><a href="#RuntimeService（流程运行时服务）" class="headerlink" title="RuntimeService（流程运行时服务）"></a>RuntimeService（流程运行时服务）</h2><p>管理流程的 动态实例，负责流程实例的启动、暂停、推进、终止</p>
<ul>
<li><p>根据流程定义 Key（BPMN 文件中<code>process</code>标签的<code>id</code>）启动一个流程实例（即 “发起一个具体的流程”，如 “张三发起请假申请”）。</p>
<ul>
<li>关键 API：<code>startProcessInstanceByKey()</code>（按流程 Key 启动）、<code>startProcessInstanceById()</code>（按流程定义 ID 启动，需指定版本）。</li>
<li>示例：张三发起 3 天的请假流程，传入 “申请人”“请假天数” 等参数</li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">variables.put(<span class="string">&quot;applicant&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">variables.put(<span class="string">&quot;leaveDays&quot;</span>, <span class="number">3</span>);</span><br><span class="line"><span class="comment">// 按流程Key启动实例（自动选择最新版本的流程定义）</span></span><br><span class="line"><span class="type">ProcessInstance</span> <span class="variable">instance</span> <span class="operator">=</span> runtimeService.startProcessInstanceByKey(<span class="string">&quot;leave-approve&quot;</span>, variables);</span><br></pre></td></tr></table></figure>
</li>
<li><p>暂停 &#x2F; 激活流程实例（如 “请假流程因材料不全暂停，补充后激活”）、终止流程实例（如 “请假申请被驳回如 “请假申请被驳回，终止流程”）。</p>
</li>
<li><p>关键 API：<code>suspendProcessInstanceById()</code>（暂停实例）、<code>activateProcessInstanceById()</code>（激活实例）、<code>deleteProcessInstance()</code>（终止实例）。</p>
</li>
<li><p>读写流程实例的 “全局变量”（如 “请假天数”“审批意见”，整个流程实例可共享），支撑流程逻辑判断（如 “请假天数 &gt; 3 天需部门经理审批”）。</p>
</li>
<li><p>关键 API：<code>setVariable()</code>（设置变量）、<code>getVariable()</code>（获取变量）。</p>
</li>
<li><p>推进流程实例的 “执行流”（如跳过某个节点、强制流转到指定节点），用于特殊场景（如 “紧急流程跳过部门审批，直接到 CEO 审批”）。</p>
<ul>
<li>关键 API：<code>signal()</code>（发送信号推进流程）、<code>createExecutionQuery()</code>（查询执行流状态）。</li>
</ul>
</li>
</ul>
<h2 id="TaskService（任务服务）"><a href="#TaskService（任务服务）" class="headerlink" title="TaskService（任务服务）"></a>TaskService（任务服务）</h2><p>管理流程中的 人工任务，也就是我们说的审批节点，负责任务的查询、分配、完成、认领，处理流程中需要人参与的步骤（如 “部门经理审批请假申请”）。</p>
<ul>
<li><p>按用户 &#x2F; 用户组查询 “待办任务”（如 “查询张三的所有待审批任务”“查询财务部的待处理报销任务”）。</p>
<ul>
<li>关键 API：<code>createTaskQuery()</code>（创建任务查询器），支持按<code>assignee</code>（执行人）、<code>candidateUser</code>（候选用户）、<code>candidateGroup</code>（候选组）筛选。</li>
<li>示例：查询张三的待办任务</li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Task&gt; todoTasks = taskService.createTaskQuery()</span><br><span class="line">                                  .taskAssignee(<span class="string">&quot;张三&quot;</span>) <span class="comment">// 执行人是张三</span></span><br><span class="line">                                  .list();</span><br></pre></td></tr></table></figure>
</li>
<li><p>直接分配任务给指定用户（<code>setAssignee</code>，如 “将请假审批任务分配给李四”）；</p>
<ul>
<li>候选任务认领（如 “财务部任务池中有一个报销任务，王五认领后成为执行人”）。</li>
<li>关键 API：<code>setAssignee()</code>（分配任务）、<code>claim()</code>（认领任务）、<code>unclaim()</code>（释放任务）。</li>
</ul>
</li>
<li><p>提交任务处理结果，推进流程到下一个节点（如 “李四审批通过请假申请，完成任务后流程流转到 HR 归档”）。</p>
<ul>
<li>关键 API：<code>complete()</code>（完成任务，可传入任务变量，如 “审批意见 &#x3D; 同意”）。</li>
<li>示例：李四完成请假审批，传入审批意见</li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; taskVariables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">taskVariables.put(<span class="string">&quot;approvalOpinion&quot;</span>, <span class="string">&quot;同意&quot;</span>);</span><br><span class="line">taskService.complete(<span class="string">&quot;taskId123&quot;</span>, taskVariables); <span class="comment">// taskId为待办任务的ID</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加任务备注、附件（如 “审批时上传证明文件”），或设置任务到期时间（用于提醒）。</p>
<ul>
<li>关键 API：<code>addComment()</code>（添加备注）、<code>createAttachment()</code>（添加附件）、<code>setDueDate()</code>（设置到期时间）。</li>
</ul>
</li>
</ul>
<h2 id="IdentityService（身份服务）"><a href="#IdentityService（身份服务）" class="headerlink" title="IdentityService（身份服务）"></a>IdentityService（身份服务）</h2><p>管理流程的 “角色权限数据”，负责用户、用户组的创建、查询、关联，是流程 “权限控制” 的基础组件。<br>可以理解为：流程的 “用户权限系统”，定义 “谁能参与流程”“哪些人属于同一个部门”。</p>
<ul>
<li><p>创建、查询、删除流程相关的用户（注意：Activiti 的用户体系是 “独立的”，可与业务系统用户关联，但不依赖业务系统）。</p>
<ul>
<li>关键 API：<code>newUser()</code>（创建用户）、<code>saveUser()</code>（保存用户）、<code>createUserQuery()</code>（查询用户）。</li>
<li>示例：创建用户 “李四”，指定密码和邮箱</li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> identityService.newUser(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">user.setPassword(<span class="string">&quot;123456&quot;</span>); <span class="comment">// 实际场景需加密存储</span></span><br><span class="line">user.setEmail(<span class="string">&quot;lisi@example.com&quot;</span>);</span><br><span class="line">identityService.saveUser(user);</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建、查询、删除用户组（如 “部门经理组”“财务部组”），用于批量分配任务（如 “将报销任务分配给财务部组，组内任何人可认领”）。</p>
<ul>
<li>关键 API：<code>newGroup()</code>（创建用户组）、<code>saveGroup()</code>（保存用户组）、<code>createGroupQuery()</code>（查询用户组）。</li>
</ul>
</li>
<li><p>将用户加入用户组（如 “李四加入部门经理组”），支撑 “按组分配任务” 的场景。</p>
<ul>
<li>关键 API：<code>createMembership()</code>（建立用户 - 组关联）、<code>deleteMembership()</code>（解除关联）。</li>
</ul>
</li>
</ul>
<h2 id="ManagementService（管理服务）"><a href="#ManagementService（管理服务）" class="headerlink" title="ManagementService（管理服务）"></a>ManagementService（管理服务）</h2><p>主要用于运维和监控，一般不直接参与业务流程。</p>
<ol>
<li>作业调度管理<ul>
<li>管理 Activiti 的 “定时作业”（如 “流程超时自动终止”“定时发送流程提醒”），查询、执行、暂停定时作业。</li>
<li>关键 API：<code>createJobQuery()</code>（查询作业）、<code>executeJob()</code>（手动执行作业）、<code>suspendJob()</code>（暂停作业）。</li>
</ul>
</li>
<li>数据库表操作<ul>
<li>手动执行 Activiti 数据库表的 “schema 更新”（如从 Activiti 5 升级到 6 时更新表结构），或查询表信息。</li>
<li>关键 API：<code>databaseSchemaUpgrade()</code>（更新数据库 schema）、<code>getTableCount()</code>（查询表记录数）。</li>
</ul>
</li>
<li>引擎配置与元数据查询<ul>
<li>查询引擎的配置信息（如数据源、事务管理器）、流程引擎的元数据（如已部署的流程定义数量）。</li>
<li>关键 API：<code>getProcessEngineConfiguration()</code>（获取引擎配置）、<code>getProperties()</code>（获取引擎属性）。</li>
</ul>
</li>
</ol>
<h2 id="HistoryService（历史服务）"><a href="#HistoryService（历史服务）" class="headerlink" title="HistoryService（历史服务）"></a>HistoryService（历史服务）</h2><p><strong>核心定位</strong>：管理流程的 “历史数据”，负责查询流程实例、任务、变量的历史记录，是流程 “追溯与统计” 的组件。<br>可以理解为：流程的 “历史日志库”，记录所有流程的过往操作，用于审计、统计或复盘。</p>
<ul>
<li><p>查询已结束 &#x2F; 正在运行的流程实例的历史信息（如 “查询张三过去 3 个月的所有请假流程”“查询某个流程的启动时间、结束时间”）。</p>
<ul>
<li>关键 API：<code>createHistoricProcessInstanceQuery()</code>（创建历史实例查询器）。</li>
</ul>
</li>
<li><p>查询已完成 &#x2F; 未完成的任务的历史记录（如 “查询李四上周审批过的所有任务”“查询某个任务的处理人、处理时间、审批意见”）。</p>
<ul>
<li>关键 API：<code>createHistoricTaskInstanceQuery()</code>（创建历史任务查询器）。</li>
</ul>
</li>
<li><p>查询流程实例 &#x2F; 任务的历史变量（如 “查询某个请假流程的原始请假天数”）、历史操作记录（如 “谁在什么时候修改了流程变量”）。</p>
<ul>
<li>关键 API：<code>createHistoricVariableInstanceQuery()</code>（查询历史变量）、<code>createHistoricActivityInstanceQuery()</code>（查询历史活动记录，如 “某个节点的执行时间”）。</li>
</ul>
</li>
<li><p>清理过期的历史数据（如 “删除 1 年前已结束的流程历史记录”），避免数据库表过大。</p>
<ul>
<li>关键 API：<code>deleteHistoricProcessInstance()</code>（删除单个流程的历史数据）、<code>bulkDeleteHistoricProcessInstances()</code>（批量删除历史数据）。</li>
</ul>
</li>
</ul>
<h2 id="FormService（表单服务）"><a href="#FormService（表单服务）" class="headerlink" title="FormService（表单服务）"></a>FormService（表单服务）</h2><p>Activiti 6 中表单功能相对基础，复杂场景常结合业务系统自定义表单</p>
<ul>
<li><p>查询某个任务对应的表单元数据（如 “请假审批任务需要显示‘申请人’‘请假天数’‘审批意见’字段”），用于前端渲染表单。</p>
<ul>
<li><p>关键 API：<code>getTaskFormData()</code>（获取任务表单数据，包含表单字段列表）。</p>
</li>
<li><p>示例：获取任务的表单字段</p>
</li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TaskFormData</span> <span class="variable">formData</span> <span class="operator">=</span> formService.getTaskFormData(<span class="string">&quot;taskId123&quot;</span>);</span><br><span class="line">List&lt;FormProperty&gt; formFields = formData.getFormProperties(); <span class="comment">// 表单字段列表（如“审批意见”是字符串类型）</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将前端填写的表单数据提交给引擎，并完成任务（本质是 “表单数据 + 任务完成” 的组合操作）。</p>
<ul>
<li><p>关键 API：<code>submitTaskFormData()</code>（提交表单数据并完成任务）。</p>
</li>
<li><p>示例：提交审批意见并完成任务</p>
</li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; formValues = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">formValues.put(<span class="string">&quot;approvalOpinion&quot;</span>, <span class="string">&quot;同意&quot;</span>); <span class="comment">// 表单字段ID -&gt; 填写值</span></span><br><span class="line">formService.submitTaskFormData(<span class="string">&quot;taskId123&quot;</span>, formValues); <span class="comment">// 提交表单并完成任务</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查询流程启动时需要的表单数据（如 “发起请假流程需要填写‘申请人’‘请假天数’‘请假原因’”），用于前端渲染启动表单。</p>
<ul>
<li>关键 API：<code>getStartFormData()</code>（获取流程启动表单数据）。</li>
</ul>
</li>
</ul>
<h2 id="整体"><a href="#整体" class="headerlink" title="整体"></a>整体</h2><p>以 “请假审批流程” 为例，7 个组件的协作流程如下：</p>
<ol>
<li><strong>RepositoryService</strong>：部署 “请假审批.bpmn” 文件，完成流程定义；</li>
<li><strong>IdentityService</strong>：创建用户 “张三（申请人）”“李四（部门经理）”，并将李四加入 “部门经理组”；</li>
<li><strong>RuntimeService</strong>：张三发起请假流程，启动一个流程实例，传入 “请假天数 &#x3D; 3”；</li>
<li><strong>TaskService</strong>：流程自动生成 “部门经理审批” 任务，分配给 “部门经理组”，李四认领任务；</li>
<li><strong>FormService</strong>：李四通过表单填写 “审批意见 &#x3D; 同意”，提交表单并完成任务；</li>
<li><strong>RuntimeService</strong>：任务完成后，流程推进到 “HR 归档” 节点，最终流程结束；</li>
<li><strong>HistoryService</strong>：记录整个流程的启动时间、处理人、审批意见等历史数据，供后续查询；</li>
<li><strong>ManagementService</strong>：后台监控流程引擎的运行状态，处理可能的定时作业（如 “超时未审批提醒”）。</li>
</ol>
<h1 id="表"><a href="#表" class="headerlink" title="表"></a>表</h1><h2 id="其他表"><a href="#其他表" class="headerlink" title="其他表"></a>其他表</h2><ul>
<li><code>act_procdef_info</code>：存储流程定义的扩展信息，用于记录流程定义的额外配置等。</li>
<li><code>act_evt_log</code>： 用于记录事件日志</li>
</ul>
<h2 id="通用数据表（act-ge-）"><a href="#通用数据表（act-ge-）" class="headerlink" title="通用数据表（act_ge_*）"></a>通用数据表（<code>act_ge_*</code>）</h2><ul>
<li><strong>核心作用</strong>：存储流程引擎共享的通用基础数据，不绑定特定业务模块，支撑引擎整体运行。</li>
<li>具体表及存储内容：<ol>
<li><code>act_ge_bytearray</code>：存储二进制资源文件，例如流程部署时上传的 BPMN 流程图（.bpmn 文件）、流程节点图片（.png&#x2F;.jpg）、表单模板文件等；</li>
<li><code>act_ge_property</code>：存储引擎全局配置属性，例如流程引擎版本号（<code>schema.version</code>）、下次生成流程实例 ID 的自增起始值（<code>next.dbid</code>）、引擎启动时间等。</li>
</ol>
</li>
</ul>
<h2 id="历史数据表（act-hi-）"><a href="#历史数据表（act-hi-）" class="headerlink" title="历史数据表（act_hi_*）"></a>历史数据表（<code>act_hi_*</code>）</h2><ul>
<li><strong>核心作用</strong>：存储流程运行的所有历史记录（数据不可修改），用于后续查询、统计、审计，对应 <code>HistoryService</code> 接口。</li>
<li>具体表及存储内容：<ol>
<li><code>act_hi_actinst</code>：存储流程活动（节点）的历史记录，包括节点启动时间、完成时间、处理人、节点类型等。</li>
<li><code>act_hi_attachment</code>：存储历史流程中的附件信息，如流程相关的文档等。</li>
<li><code>act_hi_comment</code>：存储历史流程中的评论信息，用于记录流程处理过程中的备注等。</li>
<li><code>act_hi_detail</code>：存储变量变更等详细的历史信息，可追溯变量从旧值到新值的变化等。</li>
<li><code>act_hi_identitylink</code>：存储历史任务的权限关联记录，如任务被指派、抄送等关系。</li>
<li><code>act_hi_procinst</code>：存储流程实例的历史记录，包括流程实例 ID、启动时间、结束时间、启动人、流程状态等。</li>
<li><code>act_hi_taskinst</code>：存储用户任务的历史记录，包括任务 ID、任务名称、处理人、提交时间、任务状态等。</li>
<li><code>act_hi_varinst</code>：存储流程变量的历史记录，可回溯变量在不同节点的变化。</li>
</ol>
</li>
</ul>
<h2 id="身份数据表（act-id-）"><a href="#身份数据表（act-id-）" class="headerlink" title="身份数据表（act_id_*）"></a>身份数据表（<code>act_id_*</code>）</h2><ul>
<li><strong>核心作用</strong>：存储流程专属的用户、用户组（角色）及二者关联关系，对应 <code>IdentityService</code> 接口（注：不建议用于系统全局用户管理，仅适配流程内身份权限）。</li>
<li>具体表及存储内容：<ol>
<li><code>act_id_user</code>：存储流程用户基础信息，例如用户 ID、用户名、加密后的密码、邮箱、手机号、用户状态（启用 &#x2F; 禁用）等；</li>
<li><code>act_id_group</code>：存储用户组（角色）信息，例如 “部门经理组”“HR 归档组”“财务审批组” 的组 ID、组名称、组类型（如 <code>assignment</code> 表示任务分配组）；</li>
<li><code>act_id_membership</code>：存储用户与用户组的映射关系，例如 “张三 - 部门经理组”“李四 - HR 归档组” 的关联记录，实现 “按组分配任务” 的权限基础；</li>
<li><code>act_id_info</code>：存储用户扩展信息（可选），以键值对（Key-Value）形式存储非核心字段，例如用户性别、入职时间、所属部门等。</li>
</ol>
</li>
</ul>
<h2 id="流程存储表（act-re-）"><a href="#流程存储表（act-re-）" class="headerlink" title="流程存储表（act_re_*）"></a>流程存储表（<code>act_re_*</code>）</h2><ul>
<li><strong>核心作用</strong>：存储流程的 “静态定义数据”（部署后不随流程运行变化），是流程实例启动的 “模板库”，对应 <code>RepositoryService</code> 接口。</li>
<li>具体表及存储内容：<ol>
<li><code>act_re_deployment</code>：存储流程部署记录，例如某次 BPMN 文件部署的部署 ID、部署名称、部署时间、部署人、部署备注（如 “请假流程 V2.0 部署”）等（一个部署可包含多个流程定义）；</li>
<li><code>act_re_procDef</code>：存储流程定义核心信息，例如 “请假流程” 的定义 ID、流程 Key（BPMN 中 <code>process</code> 标签的 <code>id</code>）、流程名称、流程版本号（多次部署同一流程自动升版）、流程状态（激活 &#x2F; 暂停）等；</li>
<li><code>act_re_model</code>：存储流程模型设计记录（仅用于 Activiti 建模工具场景），例如流程模型 ID、模型名称、创建人、创建时间、模型对应的 BPMN 源码、模型状态（草稿 &#x2F; 已发布）等。</li>
</ol>
</li>
</ul>
<h2 id="运行时数据表（act-ru-）"><a href="#运行时数据表（act-ru-）" class="headerlink" title="运行时数据表（act_ru_*）"></a>运行时数据表（<code>act_ru_*</code>）</h2><ul>
<li><strong>核心作用</strong>：存储流程运行中的 “动态临时数据”（流程结束后自动清理，仅保留历史数据），支撑流程实时运行，对应 <code>RuntimeService</code>（流程实例管理）和 <code>TaskService</code>（任务管理）接口。</li>
<li>具体表及存储内容：<ul>
<li><code>act_ru_deadletter_job</code>：存储执行失败且无法重试的 “死信任务”，如定时任务多次执行报错后归档。</li>
<li><code>act_ru_event_subscr</code>：存储事件订阅信息，用于流程中事件的监听和触发。</li>
<li><code>act_ru_execution</code>：存储流程执行实例记录，包括当前运行中的流程实例 ID、当前所在节点、父执行实例、流程状态等。</li>
<li><code>act_ru_identitylink</code>：存储运行时任务的权限关联记录，如当前任务被指派、抄送等关系。</li>
<li><code>act_ru_job</code>：存储引擎定时任务记录，如流程中定时网关、延迟执行的服务任务对应的定时任务信息。</li>
<li><code>act_ru_suspended_job</code>：存储被挂起的定时任务，暂时不执行。</li>
<li><code>act_ru_task</code>：存储当前待处理的用户任务记录，如任务 ID、任务名称、处理人、到期时间等。</li>
<li><code>act_ru_timer_job</code>：存储定时任务记录，用于处理流程中的定时相关逻辑。</li>
<li><code>act_ru_variable</code>：存储流程运行时的变量记录，如当前流程中的实时变量值。</li>
</ul>
</li>
</ul>
<h1 id="驳回"><a href="#驳回" class="headerlink" title="驳回"></a>驳回</h1><p>当两个不同来源的节点（如 <strong>A1 节点</strong>、<strong>A2 节点</strong>）都流转到同一个 <strong>B 节点</strong>，且需要从 B 节点 “精准驳回到上一个来源节点” </p>
<p>一种实现方式是在流程监听器中，在到达下一个节点时记录上一个节点的id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.activiti.engine.delegate.DelegateExecution;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.delegate.JavaDelegate;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A1节点流向B节点的服务任务：记录上一节点为A1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RecordPrevActivityFromA1</span> <span class="keyword">implements</span> <span class="title class_">JavaDelegate</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(DelegateExecution execution)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1. 获取当前服务任务的“上一节点ID”（即A1节点的ID，需与流程图中A1的id一致，如&quot;activity_A1&quot;）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">prevActivityId</span> <span class="operator">=</span> <span class="string">&quot;activity_A1&quot;</span>; </span><br><span class="line">        <span class="comment">// 2. 将上一节点ID存入流程变量，供B节点驳回时使用</span></span><br><span class="line">        execution.setVariable(<span class="string">&quot;prevActivityId&quot;</span>, prevActivityId);</span><br><span class="line">        <span class="comment">// 3. （可选）记录更完整的轨迹，如流转时间、操作人，便于追溯</span></span><br><span class="line">        execution.setVariable(<span class="string">&quot;prevActivityTime&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        execution.setVariable(<span class="string">&quot;prevActivityOperator&quot;</span>, execution.getVariable(<span class="string">&quot;currentOperator&quot;</span>)); <span class="comment">// 假设currentOperator是已存的操作人变量</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A2节点流向B节点的服务任务：记录上一节点为A2（逻辑同上，仅prevActivityId改为&quot;activity_A2&quot;）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RecordPrevActivityFromA2</span> <span class="keyword">implements</span> <span class="title class_">JavaDelegate</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(DelegateExecution execution)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        execution.setVariable(<span class="string">&quot;prevActivityId&quot;</span>, <span class="string">&quot;activity_A2&quot;</span>);</span><br><span class="line">        <span class="comment">// 其他轨迹信息可按需添加</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者使用监听器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RecordPrevActivityByListener</span> <span class="keyword">implements</span> <span class="title class_">JavaDelegate</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(DelegateExecution execution)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取当前序列流的“源节点ID”（即上一节点，如A1或A2）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">prevActivityId</span> <span class="operator">=</span> execution.getCurrentFlowElement().getSourceRef().getId();</span><br><span class="line">        execution.setVariable(<span class="string">&quot;prevActivityId&quot;</span>, prevActivityId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>驳回时获取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.activiti.engine.RuntimeService;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.TaskService;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.task.Task;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RejectController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注入Activiti核心服务</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RuntimeService runtimeService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TaskService taskService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * B节点驳回接口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> taskId B节点当前用户任务的ID（从前端获取，如用户点击“驳回”时携带）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 驳回结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/rejectToPrevNode&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">rejectToPreviousNode</span><span class="params">(<span class="meta">@RequestParam</span> String taskId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 根据任务ID获取当前任务信息（确认是B节点的任务，避免误操作）</span></span><br><span class="line">            <span class="type">Task</span> <span class="variable">currentTask</span> <span class="operator">=</span> taskService.createTaskQuery().taskId(taskId).singleResult();</span><br><span class="line">            <span class="keyword">if</span> (currentTask == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;驳回失败：任务不存在&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 校验当前任务是否为B节点（B节点的ID需与流程图中一致，如&quot;activity_B&quot;）</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">currentActivityId</span> <span class="operator">=</span> currentTask.getTaskDefinitionKey();</span><br><span class="line">            <span class="keyword">if</span> (!<span class="string">&quot;activity_B&quot;</span>.equals(currentActivityId)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;驳回失败：仅B节点支持此操作&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. 获取流程实例ID和“上一节点ID”变量</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">processInstanceId</span> <span class="operator">=</span> currentTask.getProcessInstanceId();</span><br><span class="line">            <span class="type">String</span> <span class="variable">prevActivityId</span> <span class="operator">=</span> (String) runtimeService.getVariable(processInstanceId, <span class="string">&quot;prevActivityId&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (prevActivityId == <span class="literal">null</span> || (!<span class="string">&quot;activity_A1&quot;</span>.equals(prevActivityId) &amp;&amp; !<span class="string">&quot;activity_A2&quot;</span>.equals(prevActivityId))) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;驳回失败：无法定位上一节点，请检查流程轨迹记录&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3. （关键）通过流程实例修改器，实现从B节点定向跳转到上一节点</span></span><br><span class="line">            runtimeService.createProcessInstanceModificationBuilder(processInstanceId)</span><br><span class="line">                    <span class="comment">// 3.1 暂停当前B节点的执行（避免流程继续向下流转）</span></span><br><span class="line">                    .cancelAllForActivity(currentActivityId)</span><br><span class="line">                    <span class="comment">// 3.2 启动上一节点（A1或A2）的执行</span></span><br><span class="line">                    .startBeforeActivity(prevActivityId)</span><br><span class="line">                    <span class="comment">// 3.3 执行修改（完成跳转）</span></span><br><span class="line">                    .execute();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. （可选）删除B节点的当前任务（若任务未自动清除）</span></span><br><span class="line">            taskService.deleteTask(taskId, <span class="string">&quot;用户发起驳回，任务取消&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;驳回成功！已跳转至节点：&quot;</span> + prevActivityId;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;驳回失败：&quot;</span> + e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另一种方式是通过历史记录，获取上一任节点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.activiti.engine.HistoryService;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.ProcessEngine;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.ProcessEngines;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.RuntimeService;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.TaskService;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.history.HistoricActivityInstance;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.task.Task;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BNodeRejectController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RuntimeService runtimeService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TaskService taskService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HistoryService historyService; <span class="comment">// 也可直接通过 ProcessEngine 获取</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * B 节点驳回接口：通过历史记录定位上一节点并跳转</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> taskId 当前 B 节点的任务 ID（用户点击“驳回”时携带）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 驳回结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/rejectBNode&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">rejectBNode</span><span class="params">(<span class="meta">@RequestParam</span> String taskId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 步骤1：获取当前 B 节点的任务信息</span></span><br><span class="line">            <span class="type">Task</span> <span class="variable">bNodeTask</span> <span class="operator">=</span> taskService.createTaskQuery().taskId(taskId).singleResult();</span><br><span class="line">            <span class="keyword">if</span> (bNodeTask == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;驳回失败：B 节点任务不存在&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">processInstanceId</span> <span class="operator">=</span> bNodeTask.getProcessInstanceId(); <span class="comment">// 流程实例ID</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">bNodeActivityId</span> <span class="operator">=</span> bNodeTask.getTaskDefinitionKey(); <span class="comment">// B 节点的 activityId（如 &quot;activity_B&quot;）</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 步骤2：通过历史记录查询 B 节点的上一节点</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">prevActivityId</span> <span class="operator">=</span> getPrevNodeFromHistory(processInstanceId, bNodeActivityId);</span><br><span class="line">            <span class="keyword">if</span> (prevActivityId == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;驳回失败：未找到上一来源节点（可能 B 节点是第一个节点）&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 步骤3：验证上一节点是否为合法目标（如仅允许 A1/A2 作为上一节点）</span></span><br><span class="line">            List&lt;String&gt; validPrevNodes = Arrays.asList(<span class="string">&quot;activity_A1&quot;</span>, <span class="string">&quot;activity_A2&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (!validPrevNodes.contains(prevActivityId)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;驳回失败：上一节点[&quot;</span> + prevActivityId + <span class="string">&quot;]不允许作为驳回目标&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 步骤4：执行驳回跳转（从 B 节点跳转到上一节点）</span></span><br><span class="line">            runtimeService.createProcessInstanceModificationBuilder(processInstanceId)</span><br><span class="line">                    .cancelAllForActivity(bNodeActivityId) <span class="comment">// 取消当前 B 节点的执行</span></span><br><span class="line">                    .startBeforeActivity(prevActivityId) <span class="comment">// 启动上一节点的执行</span></span><br><span class="line">                    .execute(); <span class="comment">// 执行修改</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 步骤5：删除 B 节点的当前任务（避免残留待办）</span></span><br><span class="line">            taskService.deleteTask(taskId, <span class="string">&quot;B 节点驳回，跳转至[&quot;</span> + prevActivityId + <span class="string">&quot;]&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;驳回成功！已跳转至节点：&quot;</span> + prevActivityId;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;驳回失败：&quot;</span> + e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 工具方法：通过历史记录查询上一节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getPrevNodeFromHistory</span><span class="params">(String processInstanceId, String currentActivityId)</span> &#123;</span><br><span class="line">        <span class="comment">// 优化后的历史活动查询（按结束时间倒序，过滤有效节点类型）</span></span><br><span class="line">        List&lt;HistoricActivityInstance&gt; finishedActivities = historyService.createHistoricActivityInstanceQuery()</span><br><span class="line">                .processInstanceId(processInstanceId)</span><br><span class="line">                .finished()</span><br><span class="line">                .activityTypes(Arrays.asList(<span class="string">&quot;userTask&quot;</span>, <span class="string">&quot;serviceTask&quot;</span>)) <span class="comment">// 仅保留业务节点</span></span><br><span class="line">                .orderByHistoricActivityInstanceEndTime().desc()</span><br><span class="line">                .list();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历找到 B 节点的上一节点</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isBNodeFound</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (HistoricActivityInstance activity : finishedActivities) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isBNodeFound) &#123;</span><br><span class="line">                <span class="keyword">return</span> activity.getActivityId(); <span class="comment">// 上一节点的 activityId</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 匹配 B 节点的历史记录（若 B 节点已完成过，会有记录）</span></span><br><span class="line">            <span class="keyword">if</span> (currentActivityId.equals(activity.getActivityId())) &#123;</span><br><span class="line">                isBNodeFound = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 特殊情况：B 节点是第一次执行（无历史记录），需查询“当前正在执行的节点”找前置</span></span><br><span class="line">        <span class="keyword">if</span> (!isBNodeFound) &#123;</span><br><span class="line">            <span class="keyword">return</span> getPrevNodeFromRunningActivities(processInstanceId, currentActivityId);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 补充工具方法：当 B 节点第一次执行（无历史记录）时，从“正在执行的活动”中找前置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getPrevNodeFromRunningActivities</span><span class="params">(String processInstanceId, String currentActivityId)</span> &#123;</span><br><span class="line">        <span class="comment">// 查询当前流程实例中「正在执行的活动节点」（排除 B 节点本身）</span></span><br><span class="line">        List&lt;HistoricActivityInstance&gt; runningActivities = historyService.createHistoricActivityInstanceQuery()</span><br><span class="line">                .processInstanceId(processInstanceId)</span><br><span class="line">                .unfinished() <span class="comment">// 未完成的活动（正在执行）</span></span><br><span class="line">                .activityTypes(Arrays.asList(<span class="string">&quot;userTask&quot;</span>, <span class="string">&quot;serviceTask&quot;</span>))</span><br><span class="line">                .orderByHistoricActivityInstanceStartTime().desc()</span><br><span class="line">                .list();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 若存在正在执行的前置节点（如 A1/A2 刚完成，B 节点刚启动），取最近的一个</span></span><br><span class="line">        <span class="keyword">for</span> (HistoricActivityInstance activity : runningActivities) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!currentActivityId.equals(activity.getActivityId())) &#123;</span><br><span class="line">                <span class="keyword">return</span> activity.getActivityId();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/activity6/">activity6</a></div><div class="post_share"><div class="social-share" data-image="/assets/img/tx.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/09/13/%E7%AC%94%E8%AE%B0/nexus/nexus/" title="nexus"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">nexus</div></div></a></div><div class="next-post pull-right"><a href="/2025/07/02/%E7%AC%94%E8%AE%B0/%E7%BD%91%E5%AE%89/%E7%BD%91%E5%AE%89/" title="网安"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">网安</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/assets/img/tx.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Boranget</div><div class="author-info__description">整理的一些笔记和平时的一些经验</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">191</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">198</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Boranget"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">笔记分类是一些看书或者网课做的笔记，经验分类一般是平时碰到的问题或者折腾的一些小东西。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">1.</span> <span class="toc-text">参考资料</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">2.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">3.</span> <span class="toc-text">流程图</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%89%A7%E8%A1%8C"><span class="toc-number">4.</span> <span class="toc-text">流程执行</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E7%BB%84%E4%BB%B6"><span class="toc-number">5.</span> <span class="toc-text">主要组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RepositoryService%EF%BC%88%E6%B5%81%E7%A8%8B%E4%BB%93%E5%BA%93%E6%9C%8D%E5%8A%A1%EF%BC%89"><span class="toc-number">5.1.</span> <span class="toc-text">RepositoryService（流程仓库服务）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RuntimeService%EF%BC%88%E6%B5%81%E7%A8%8B%E8%BF%90%E8%A1%8C%E6%97%B6%E6%9C%8D%E5%8A%A1%EF%BC%89"><span class="toc-number">5.2.</span> <span class="toc-text">RuntimeService（流程运行时服务）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TaskService%EF%BC%88%E4%BB%BB%E5%8A%A1%E6%9C%8D%E5%8A%A1%EF%BC%89"><span class="toc-number">5.3.</span> <span class="toc-text">TaskService（任务服务）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IdentityService%EF%BC%88%E8%BA%AB%E4%BB%BD%E6%9C%8D%E5%8A%A1%EF%BC%89"><span class="toc-number">5.4.</span> <span class="toc-text">IdentityService（身份服务）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ManagementService%EF%BC%88%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%EF%BC%89"><span class="toc-number">5.5.</span> <span class="toc-text">ManagementService（管理服务）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HistoryService%EF%BC%88%E5%8E%86%E5%8F%B2%E6%9C%8D%E5%8A%A1%EF%BC%89"><span class="toc-number">5.6.</span> <span class="toc-text">HistoryService（历史服务）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FormService%EF%BC%88%E8%A1%A8%E5%8D%95%E6%9C%8D%E5%8A%A1%EF%BC%89"><span class="toc-number">5.7.</span> <span class="toc-text">FormService（表单服务）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E4%BD%93"><span class="toc-number">5.8.</span> <span class="toc-text">整体</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%A8"><span class="toc-number">6.</span> <span class="toc-text">表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%A1%A8"><span class="toc-number">6.1.</span> <span class="toc-text">其他表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E6%95%B0%E6%8D%AE%E8%A1%A8%EF%BC%88act-ge-%EF%BC%89"><span class="toc-number">6.2.</span> <span class="toc-text">通用数据表（act_ge_*）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2%E6%95%B0%E6%8D%AE%E8%A1%A8%EF%BC%88act-hi-%EF%BC%89"><span class="toc-number">6.3.</span> <span class="toc-text">历史数据表（act_hi_*）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BA%AB%E4%BB%BD%E6%95%B0%E6%8D%AE%E8%A1%A8%EF%BC%88act-id-%EF%BC%89"><span class="toc-number">6.4.</span> <span class="toc-text">身份数据表（act_id_*）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E5%AD%98%E5%82%A8%E8%A1%A8%EF%BC%88act-re-%EF%BC%89"><span class="toc-number">6.5.</span> <span class="toc-text">流程存储表（act_re_*）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E8%A1%A8%EF%BC%88act-ru-%EF%BC%89"><span class="toc-number">6.6.</span> <span class="toc-text">运行时数据表（act_ru_*）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A9%B3%E5%9B%9E"><span class="toc-number">7.</span> <span class="toc-text">驳回</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/21/%E7%AC%94%E8%AE%B0/%E7%BD%91%E7%BB%9C%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E5%8E%9F%E7%90%86/%E7%BD%91%E7%BB%9C%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E5%8E%9F%E7%90%86/" title="Resilience4j Circuit Breaker">Resilience4j Circuit Breaker</a><time datetime="2025-09-21T12:27:19.000Z" title="更新于 2025-09-21 20:27:19">2025-09-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/21/%E7%AC%94%E8%AE%B0/%E6%97%A0%E5%A4%B4%E6%B5%8F%E8%A7%88%E5%99%A8/%E6%97%A0%E5%A4%B4%E6%B5%8F%E8%A7%88%E5%99%A8/" title="无头浏览器">无头浏览器</a><time datetime="2025-09-21T05:56:19.000Z" title="更新于 2025-09-21 13:56:19">2025-09-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/21/%E7%AC%94%E8%AE%B0/Resilience4jCircuitBreaker/Resilience4jCircuitBreaker/" title="Resilience4j Circuit Breaker">Resilience4j Circuit Breaker</a><time datetime="2025-09-21T05:27:19.000Z" title="更新于 2025-09-21 13:27:19">2025-09-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/21/%E7%AC%94%E8%AE%B0/ELK/ELK/" title="ELK">ELK</a><time datetime="2025-09-21T04:56:19.000Z" title="更新于 2025-09-21 12:56:19">2025-09-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/21/%E7%AC%94%E8%AE%B0/SpringBootAdmin/SpringBootAdmin/" title="SpringBootAdmin">SpringBootAdmin</a><time datetime="2025-09-21T04:56:19.000Z" title="更新于 2025-09-21 12:56:19">2025-09-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Boranget</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>