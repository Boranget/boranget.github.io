<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SQL | Boranget.博客</title><meta name="author" content="Boranget"><meta name="copyright" content="Boranget"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="虚拟表我有一个名为a的字符串，其中包含多个值，我有一张表b，其中包含多个值，我想使用sql语句来知道有哪些数据是a中有但是b中没有的 123456789CREATE TEMPORARY TABLE temp_a (value VARCHAR(255));INSERT INTO temp_a (value)VALUES (&amp;#x27;value1&amp;#x27;), (&amp;#x27;value2&amp;#x27">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL">
<meta property="og:url" content="https://boranget.github.io/2023/03/31/%E7%AC%94%E8%AE%B0/sql/sql/index.html">
<meta property="og:site_name" content="Boranget.博客">
<meta property="og:description" content="虚拟表我有一个名为a的字符串，其中包含多个值，我有一张表b，其中包含多个值，我想使用sql语句来知道有哪些数据是a中有但是b中没有的 123456789CREATE TEMPORARY TABLE temp_a (value VARCHAR(255));INSERT INTO temp_a (value)VALUES (&amp;#x27;value1&amp;#x27;), (&amp;#x27;value2&amp;#x27">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://boranget.github.io/assets/img/tx.png">
<meta property="article:published_time" content="2023-03-31T08:50:30.000Z">
<meta property="article:modified_time" content="2024-02-21T08:40:19.000Z">
<meta property="article:author" content="Boranget">
<meta property="article:tag" content="sql">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://boranget.github.io/assets/img/tx.png"><link rel="shortcut icon" href="/assets/img/tx.png"><link rel="canonical" href="https://boranget.github.io/2023/03/31/%E7%AC%94%E8%AE%B0/sql/sql/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SQL',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-02-21 16:40:19'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assets/img/tx.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">198</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">206</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Boranget.博客"><img class="site-icon" src="/assets/img/tx.png"/><span class="site-name">Boranget.博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SQL</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-31T08:50:30.000Z" title="发表于 2023-03-31 16:50:30">2023-03-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-02-21T08:40:19.000Z" title="更新于 2024-02-21 16:40:19">2024-02-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SQL"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="虚拟表"><a href="#虚拟表" class="headerlink" title="虚拟表"></a>虚拟表</h1><p>我有一个名为a的字符串，其中包含多个值，我有一张表b，其中包含多个值，我想使用sql语句来知道有哪些数据是a中有但是b中没有的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> temp_a (<span class="keyword">value</span> <span class="type">VARCHAR</span>(<span class="number">255</span>));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> temp_a (<span class="keyword">value</span>)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;value1&#x27;</span>), (<span class="string">&#x27;value2&#x27;</span>), (<span class="string">&#x27;value3&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> temp_a.value</span><br><span class="line"><span class="keyword">FROM</span> temp_a</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> b</span><br><span class="line"><span class="keyword">ON</span> temp_a.value <span class="operator">=</span> b.value</span><br><span class="line"><span class="keyword">WHERE</span> b.value <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>这里使用了虚拟&#x2F;临时表的概念，虚拟表不会实际创建一张表，只在当前连接可见。当关闭当前的数据库连接后会清除该缓存</p>
<h1 id="连接时-ON-和-WHERE-的区别"><a href="#连接时-ON-和-WHERE-的区别" class="headerlink" title="连接时 ON 和 WHERE 的区别"></a>连接时 ON 和 WHERE 的区别</h1><ul>
<li>在使用left jion时，on和where条件的区别如下：<br>1、 on条件是在生成临时表时使用的条件，它不管on中的条件是否为真，都会返回左边表中的记录。<br>2、where条件是在临时表生成好后，再对临时表进行过滤的条件。这时已经没有left join的含义（必须返回左边表的记录）了，条件不为真的就全部过滤掉。</li>
</ul>
<h1 id="在没有group-by时也可以使用having"><a href="#在没有group-by时也可以使用having" class="headerlink" title="在没有group by时也可以使用having"></a>在没有group by时也可以使用having</h1><p>效果相当于将整体视为一个分组，但不建议；还是建议使用whee</p>
<h1 id="关于in-x2F-exists"><a href="#关于in-x2F-exists" class="headerlink" title="关于in&#x2F;exists"></a>关于in&#x2F;exists</h1><p>IN是做外表和内表通过Hash连接，先查询子表，再查询主表，不管子查询是否有数据，都对子查询进行全部匹配。<br>EXISTS是外表做loop循环，先主查询，再子查询，然后去子查询中匹配，如果匹配到就退出子查询返回true，将结果放到结果集<br>所以：子查询结果集越大用EXISTS，子查询结果集越小用IN</p>
<h1 id="存储引擎对比"><a href="#存储引擎对比" class="headerlink" title="存储引擎对比"></a>存储引擎对比</h1><table>
<thead>
<tr>
<th></th>
<th>特性</th>
<th>使用场景</th>
</tr>
</thead>
<tbody><tr>
<td>MyISAM</td>
<td>1. 不支持事务<br>2. 不支持外键<br>3. 非聚集索引<br>4. 维护一个变量保存行数<br>5. 支持全文索引<br>6. 可以被压缩后进行查询操作<br>7.支持表级锁<br>8.可以没有唯一索引如主键<br>9. 存储文件: frm 表定义文件,mbd 数据文件,myi索引文件</td>
<td>大多数都只是读查询<br>可以接受系统奔溃后，MyISAM恢复起来更困难</td>
</tr>
<tr>
<td>InnoDB</td>
<td>1. 支持事务<br>2. 支持外键<br>3. 聚集索引<br>4. 事务原因无法维护<br>5. 5.7之前不支持全文索引<br>6. 支持表\行级锁<br>7. 必须有一个唯一索引如主键<br>8. frm 表定义文件,ibd数据文件</td>
<td>支持事务<br>需要外键</td>
</tr>
</tbody></table>
<h1 id="Explain-x2F-Analyze"><a href="#Explain-x2F-Analyze" class="headerlink" title="Explain&#x2F;Analyze"></a>Explain&#x2F;Analyze</h1><p>explain是估计，analyze是真的会执行</p>
<ul>
<li>id select 的序列号，有几个select就有几个id，</li>
<li>select_type<ul>
<li>simple 简单查询，查询不包含子查询和union</li>
<li>primary：复杂查询最外面的select</li>
<li>subquery： 包含在select中的子查询（不在from子句中）</li>
<li>derived： 包含在from中的子查询</li>
<li>union： 在union中的第二个或者随后出现的select</li>
<li>union result： 从union临时表检索结果的select</li>
</ul>
</li>
<li>table<ul>
<li>表示explain的一行正在访问哪个表</li>
</ul>
</li>
<li>type<ul>
<li>表示关联类型或者访问类型，即MySQL决定如何查找表中的行。如果该值为all，则说明完全没走索引</li>
</ul>
</li>
<li>possible_keys列<ul>
<li>显示查询可能使用哪些索引来查找</li>
</ul>
</li>
<li>key<ul>
<li>显示MySQL实际采用哪个索引来优化对该表的访问</li>
</ul>
</li>
<li>key_len<ul>
<li>显示了mysql在索引里使用的字节数,通过这个值可以算出具体使用了索引中的哪些列。 <ul>
<li>key_len计算规则如下：<ul>
<li>字符串 <ul>
<li>char(n)：n字节长度</li>
<li>varchar(n)：2字节存储字符串长度，如果是utf-8，则长度 3n + 2</li>
</ul>
</li>
<li>数值类型 <ul>
<li>tinyint：1字节</li>
<li>smallint：2字节</li>
<li>int：4字节</li>
<li>bigint：8字节</li>
</ul>
<p>　　</p>
</li>
<li>时间类型　 <ul>
<li>date：3字节</li>
<li>timestamp：4字节</li>
<li>datetime：8字节</li>
</ul>
</li>
<li>如果字段允许为 NULL，需要1字节记录是否为 NULL</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>ref<ul>
<li>显示在key列记录的索引中,表查找值要用到的列或者常量</li>
</ul>
</li>
<li>rows<ul>
<li>MySQL估计要读取并检测的行数</li>
</ul>
</li>
<li>extra<ul>
<li>额外信息</li>
</ul>
</li>
</ul>
<h1 id="开窗函数"><a href="#开窗函数" class="headerlink" title="开窗函数"></a>开窗函数</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建一个临时表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> TempTable (</span><br><span class="line">    ID <span class="type">INT</span>,</span><br><span class="line">    Score <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 插入一些数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> TempTable (ID, Score)</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="number">90</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="number">85</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="number">90</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="number">80</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="number">95</span>),</span><br><span class="line">(<span class="number">6</span>, <span class="number">85</span>);</span><br><span class="line"><span class="comment">-- ROW_NUMBER()：</span></span><br><span class="line"><span class="comment">-- 为每一行分配一个连续的唯一行号。</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID,</span><br><span class="line">    Score,</span><br><span class="line">    <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> Score <span class="keyword">DESC</span>) <span class="keyword">AS</span> RowNum</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    TempTable;</span><br><span class="line"><span class="comment">-- RANK()：</span></span><br><span class="line"><span class="comment">-- 为具有相同值的行分配相同的排名，但后续的排名会跳过。</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID,</span><br><span class="line">    Score,</span><br><span class="line">    <span class="built_in">RANK</span>() <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> Score <span class="keyword">DESC</span>) <span class="keyword">AS</span> RankNum</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    TempTable;</span><br><span class="line"><span class="comment">-- DENSE_RANK()：</span></span><br><span class="line"><span class="comment">-- 也为具有相同值的行分配相同的排名，但后续的排名不会跳过。</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID,</span><br><span class="line">    Score,</span><br><span class="line">    <span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> Score <span class="keyword">DESC</span>) <span class="keyword">AS</span> DenseRankNum</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    TempTable;</span><br><span class="line">		</span><br><span class="line"><span class="comment">-- NTILE()：</span></span><br><span class="line"><span class="comment">-- 将结果集分为指定数量的近似相等的组，并为每个组分配一个组号。如下为分为了两组</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID,</span><br><span class="line">    Score,</span><br><span class="line">    <span class="built_in">NTILE</span>(<span class="number">2</span>) <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> Score <span class="keyword">DESC</span>) <span class="keyword">AS</span> NTileNum</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    TempTable;</span><br></pre></td></tr></table></figure>



<p><img src="/2023/03/31/%E7%AC%94%E8%AE%B0/sql/sql/image-20220729144350171.png" alt="image-20220729144350171"></p>
<p><img src="/2023/03/31/%E7%AC%94%E8%AE%B0/sql/sql/image-20220726185823781.png" alt="image-20220726185823781"></p>
<h1 id="数据库类型"><a href="#数据库类型" class="headerlink" title="数据库类型"></a>数据库类型</h1><ul>
<li>关系型数据库</li>
<li>非关系型数据库<ul>
<li>键值型：如redis</li>
<li>文档型：如MongoDB</li>
<li>列式数据库：如HBase</li>
<li>图形数据库：如NEo4J</li>
</ul>
</li>
</ul>
<h2 id="不同数据库的特点及应用"><a href="#不同数据库的特点及应用" class="headerlink" title="不同数据库的特点及应用"></a>不同数据库的特点及应用</h2><ul>
<li><p>关系型数据库</p>
<p>优点</p>
<ul>
<li>保持数据的一致性</li>
<li>容易理解，接近人的思考方式</li>
<li>SQL语言方便使用</li>
</ul>
<p>缺点</p>
<ul>
<li>由于其需要维护一致性导致其读写性能比较差</li>
<li>当字段不固定时，关系型数据库处理麻烦</li>
<li>在进行大量数据的写入时效率较差</li>
</ul>
<p>应用</p>
<p>​	处理复杂、数据量相对较少、安全性要求较高、数据格式单一的场景</p>
</li>
<li><p>非关系型数据库</p>
<p>优点</p>
<ul>
<li>适合处理高并发、大批量的数据</li>
<li>支持分布式集群，负载均衡，效率较高</li>
<li>扩展简单</li>
<li>成本低廉</li>
</ul>
<p>缺点</p>
<ul>
<li>技术起步晚，相关资料有限</li>
<li>事务处理能力弱</li>
<li>无法保证数据的完整性和安全性</li>
</ul>
<p>应用</p>
<p>​	海量数据、多格式数据存储，对查询速度要求快的场景</p>
</li>
</ul>
<h1 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h1><h2 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h2><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, group_function</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> group_by_expression]</span><br><span class="line">[<span class="keyword">HAVING</span> group_condition]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">column</span>];</span><br></pre></td></tr></table></figure>

<ul>
<li>查询过程中可对数值,日期等进行计算</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span>	显示员工代号、员工姓名及薪水<span class="operator">*</span> <span class="number">1.5</span>倍后资料</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	EMPLOYEE_ID,</span><br><span class="line">	CONCAT( FIRST_NAME, <span class="string">&#x27; &#x27;</span>, LAST_NAME ) <span class="string">&#x27;NAME&#x27;</span>,</span><br><span class="line">	SALARY <span class="operator">*</span> <span class="number">1.5</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br></pre></td></tr></table></figure>

<ul>
<li>对NULL进行比较用IS关键字</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2.</span>	显示主管(MANAGER_ID)为<span class="keyword">Null</span>的员工资料</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	employees </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	MANAGER_ID <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>搜索结果去重,这里需要注意虽然GROUP BY 可以达到效果但是性能不及DISTINCT</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3.</span>	透过emp表格找出所有可能的部门代号(不可重复)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	DEPARTMENT_ID </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	employees </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	DEPARTMENT_ID </span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line">	DEPARTMENT_ID <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"># (建议)<span class="keyword">distinct</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="keyword">DISTINCT</span> DEPARTMENT_ID </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	employees </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	DEPARTMENT_ID <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>排序<ul>
<li>其中 ASC为升序(默认),DESC为降序</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">4.</span>	依照员工薪水资料，由大至小排列</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	employees </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">	SALARY <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>大小写字符串<ul>
<li>转为小写:LOWER</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">5.</span>	找出员工姓名为JOHN的员工数据</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	employees </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	<span class="built_in">UPPER</span>( FIRST_NAME ) <span class="operator">=</span> <span class="string">&#x27;JOHN&#x27;</span> </span><br><span class="line">	<span class="keyword">OR</span> <span class="built_in">UPPER</span>( LAST_NAME ) <span class="operator">=</span> <span class="string">&#x27;JOHN&#x27;</span>;</span><br><span class="line"># 例</span><br><span class="line"><span class="keyword">select</span> id,`name`,sex, <span class="built_in">LOWER</span>(`name`), <span class="built_in">UPPER</span>(sex) <span class="keyword">from</span> test_table ;</span><br></pre></td></tr></table></figure>

<ul>
<li>数值对比</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">6.</span>	找出薪水小于$<span class="number">3000</span>的员工数据</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	employees </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	SALARY <span class="operator">&lt;</span> <span class="number">3000</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>like</li>
</ul>
<table>
<thead>
<tr>
<th>通配符</th>
<th>使用场景</th>
</tr>
</thead>
<tbody><tr>
<td>%</td>
<td>代替0个或多个字符</td>
</tr>
<tr>
<td>_</td>
<td>代替一个字符</td>
</tr>
<tr>
<td>[charlist]</td>
<td>字符列中的任何单一字符</td>
</tr>
</tbody></table>
<p>( 正则表达式:使用 <strong>REGEXP</strong> 或 <strong>NOT REGEXP</strong> 运算符 (或 RLIKE 和 NOT RLIKE) 来操作)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">7.</span>	显示工作类别JOB_TITLE非<span class="string">&#x27;PRESIDENT&#x27;</span>及<span class="string">&#x27;MANAGER&#x27;</span>的员工数据</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	employees.<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	employees,</span><br><span class="line">	jobs </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	jobs.JOB_ID <span class="operator">=</span> employees.JOB_ID </span><br><span class="line">	<span class="keyword">AND</span> jobs.JOB_TITLE <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%PRESIDENT%&#x27;</span> </span><br><span class="line">	<span class="keyword">AND</span> jobs.JOB_TITLE <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%MANAGER%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>concat</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">8.</span>	找出员工名字为S开头的员工</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	employees </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	FIRST_NAME <span class="keyword">LIKE</span> <span class="string">&#x27;S%&#x27;</span>;# <span class="number">9.</span>	将员工姓名及员工代码结合为新字段，重新命名为NAME_NO</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	CONCAT( FIRST_NAME, <span class="string">&#x27; &#x27;</span>, LAST_NAME, <span class="string">&#x27;_&#x27;</span>, EMPLOYEE_ID ) <span class="string">&#x27;NAME_NO&#x27;</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	employees;</span><br></pre></td></tr></table></figure>

<ul>
<li>between and 与 &lt;&#x3D; &gt;&#x3D;<ul>
<li>两者在mysql中都包括端点</li>
<li>两者在mysql中都可以比较整型或字符串</li>
<li>BETWEEN AND 使用时需要注意顺序，&lt;&#x3D; and &gt;&#x3D;比较灵活</li>
<li>BETWEEN AND 使用更加简洁</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">10.</span>	找出部门代号为<span class="number">20</span>且薪水介于<span class="number">2000</span>及<span class="number">4000</span>间(包含<span class="number">2000</span>及<span class="number">4000</span>)，并依照(HIRE_DATE)资深至资浅排序(入职日期由小到大)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	employees </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	DEPARTMENT_ID <span class="operator">=</span> <span class="number">20</span> </span><br><span class="line">	<span class="keyword">AND</span> SALARY <span class="keyword">BETWEEN</span> <span class="number">2000</span> </span><br><span class="line">	<span class="keyword">AND</span> <span class="number">4000</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">	HIRE_DATE;</span><br></pre></td></tr></table></figure>

<ul>
<li>截取字符串&amp;获取字符串长度<ul>
<li>截取函数: SUBSTR(待截取字符串,起始位置从1开始,截取长度)</li>
<li>获取字符串长度函数: LENGTH(str)</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2.</span>	显示员工LastName名字(转换为第一个字大写其余为小写格式)</span><br><span class="line"><span class="keyword">SELECT</span> LAST_NAME, CONCAT(</span><br><span class="line">		<span class="built_in">UPPER</span>(SUBSTR(LAST_NAME,<span class="number">1</span>,<span class="number">1</span>)),</span><br><span class="line">		<span class="built_in">LOWER</span>(SUBSTR(LAST_NAME,<span class="number">2</span>,LENGTH(LAST_NAME)<span class="number">-1</span>))</span><br><span class="line">	) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>获取子字符串在母字符串中的索引<ul>
<li>相关函数: INSTER(母串,子串)</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3.</span>	显示员工名字及工作名称结合的新字符串，并找出工作名称在新字符串的开始位置</span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(FIRST_NAME,<span class="string">&#x27;_&#x27;</span>,JOB_TITLE) newStr,INSTR(CONCAT(FIRST_NAME,<span class="string">&#x27;_&#x27;</span>,JOB_TITLE),JOB_TITLE) <span class="string">&#x27;index&#x27;</span> <span class="keyword">FROM</span> employees,jobs <span class="keyword">WHERE</span> employees.JOB_ID <span class="operator">=</span> jobs.JOB_ID;</span><br></pre></td></tr></table></figure>

<ul>
<li>其他字符串相关函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 字符串左右填充</span><br><span class="line"><span class="keyword">select</span> `name`,RPAD(LPAD(`name`,<span class="number">10</span>,<span class="string">&#x27;-&#x27;</span>),<span class="number">15</span>,<span class="string">&#x27;-&#x27;</span>) <span class="keyword">from</span> test_table;</span><br><span class="line"># 去除左右任意个数指定字符</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">TRIM</span>(<span class="string">&#x27;a&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;aabaca&#x27;</span>);</span><br><span class="line"># 替换字符</span><br><span class="line"><span class="keyword">select</span> REPLACE(sex,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">FROM</span> test_table;</span><br></pre></td></tr></table></figure>



<ul>
<li>数据的四舍五入与截断</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 四舍五入</span><br><span class="line"># 四舍五入取整</span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">16.5</span>);</span><br><span class="line"># 四舍五入指定保留小数位数</span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">16.12348765</span>, <span class="number">4</span>);</span><br><span class="line"># 截断</span><br><span class="line"># 指定保留小数位数截断</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">12.234</span>,<span class="number">2</span>);</span><br><span class="line"># <span class="number">5.</span>	显示员工薪水数据(无条件舍去到整数字数的千位数)<span class="number">16800</span> –<span class="operator">&gt;</span> <span class="number">10000</span></span><br><span class="line"><span class="keyword">SELECT</span> SALARY, <span class="keyword">TRUNCATE</span>(SALARY <span class="operator">/</span> <span class="number">10000</span>,<span class="number">0</span>) <span class="operator">*</span> <span class="number">10000</span> <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> SALARY, <span class="built_in">FLOOR</span>(SALARY <span class="operator">/</span> <span class="number">10000</span>) <span class="operator">*</span> <span class="number">10000</span> <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<ul>
<li>其余数字函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 取余</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">100</span>,<span class="number">33</span>);</span><br></pre></td></tr></table></figure>



<ul>
<li>sign函数<ul>
<li>sign(x): x&#x3D;0得值0,x&gt;0得值1,x&lt;0得值-1</li>
</ul>
</li>
</ul>
<p>	</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">6.</span>	显示员工名字、薪水及薪水代号(薪水大于<span class="number">3000</span>显示<span class="string">&#x27;1&#x27;</span>，小于<span class="number">3000</span>显示<span class="string">&#x27;-1&#x27;</span>，与<span class="number">3000</span>相等时显示<span class="number">0</span>，可使用Sign函数)</span><br><span class="line"><span class="keyword">SELECT</span> FIRST_NAME, SALARY,Sign(SALARY<span class="number">-3000</span>) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间函数<ul>
<li>相关函数<ul>
<li>timestaffdiff(结果的单位,时间1,时间2):返回（时间2-时间1）的时间差，结果单位由interval参数给出。</li>
<li>timediff(时间1,时间2):返回差值</li>
<li>datediff(日期1,日期2):返回相差天数</li>
<li>now():当前年月日时分秒</li>
<li>curdate():当前年月日</li>
<li>curtime():当前时分秒</li>
<li>last_date(date):获取参数日期中月的最后一天</li>
<li>NOW()和CURRENT_TIMESTAMP()没有任何区别，他们都表示的是SQL开始执行时的系统时间；而SYSDATE()则表示执行此函数时的系统时间。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 获取当前时间</span><br><span class="line"><span class="keyword">SELECT</span> NOW();</span><br><span class="line"># 字符串转为时间，非法日期结果为空</span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;1-13-1999&#x27;</span>,<span class="string">&#x27;%m-%d-%Y&#x27;</span>);</span><br><span class="line"># 时间转换为字符串</span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(),<span class="string">&#x27;%Y年%m月&#x27;</span>);</span><br><span class="line"># <span class="number">7.</span> 显示当月的天数，试写出两种以上方法，<span class="keyword">SQL</span> mysql虚拟表</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> </span><br><span class="line">	<span class="keyword">WHEN</span> SUBSTR(NOW(),<span class="number">6</span>,<span class="number">2</span>) <span class="keyword">in</span> (<span class="string">&#x27;01&#x27;</span>,<span class="string">&#x27;03&#x27;</span>,<span class="string">&#x27;05&#x27;</span>,<span class="string">&#x27;07&#x27;</span>,<span class="string">&#x27;08&#x27;</span>,<span class="string">&#x27;10&#x27;</span>,<span class="string">&#x27;12&#x27;</span>)  <span class="keyword">THEN</span> <span class="number">31</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">WHEN</span> SUBSTR(NOW(),<span class="number">6</span>,<span class="number">2</span>) <span class="keyword">in</span> (<span class="string">&#x27;04&#x27;</span>,<span class="string">&#x27;06&#x27;</span>,<span class="string">&#x27;09&#x27;</span>,<span class="string">&#x27;11&#x27;</span>)  <span class="keyword">THEN</span> <span class="number">30</span></span><br><span class="line">	</span><br><span class="line">	# 闰年判断</span><br><span class="line">	<span class="keyword">WHEN</span> ((<span class="built_in">MOD</span>(SUBSTR(NOW(),<span class="number">1</span>,<span class="number">4</span>),<span class="number">4</span>) <span class="operator">=</span> <span class="number">0</span> <span class="keyword">AND</span> <span class="built_in">MOD</span>(SUBSTR(NOW(),<span class="number">1</span>,<span class="number">4</span>),<span class="number">100</span>) <span class="operator">&lt;&gt;</span> <span class="number">0</span>) <span class="keyword">OR</span> <span class="built_in">MOD</span>(SUBSTR(NOW(),<span class="number">1</span>,<span class="number">4</span>),<span class="number">400</span>) <span class="operator">=</span> <span class="number">0</span>) <span class="keyword">AND</span></span><br><span class="line">SUBSTR(NOW(),<span class="number">6</span>,<span class="number">2</span>) <span class="operator">=</span> <span class="string">&#x27;02&#x27;</span>  <span class="keyword">THEN</span> <span class="number">28</span></span><br><span class="line">	# 以上都不满足则为非闰年<span class="number">2</span>月</span><br><span class="line">	<span class="keyword">ELSE</span> <span class="number">29</span></span><br><span class="line"><span class="keyword">END</span> <span class="string">&#x27;day&#x27;</span>;</span><br><span class="line"># 方法二 增加一个月的时间再减去当前时间</span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(date_add(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">MONTH</span>), NOW());</span><br><span class="line"># 方法三 使用last_date获得当月最后一天,截取最后两位即为结果</span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(LAST_DAY(NOW()),<span class="number">9</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>WHEN-CASE-END<br>end 跟字段名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 第一种用法，<span class="keyword">case</span>后无表达式，<span class="keyword">when</span>中加条件</span><br><span class="line"># <span class="number">10.</span>	若员工工作名称为<span class="string">&#x27;PRESIDENT&#x27;</span>、 <span class="string">&#x27;MANAGER&#x27;</span>及<span class="string">&#x27;SALESMAN&#x27;</span>则显示<span class="string">&#x27;A&#x27;</span>，其他则显示<span class="string">&#x27;B&#x27;</span>  </span><br><span class="line"><span class="keyword">SELECT</span> employees.EMPLOYEE_ID,jobs.JOB_TITLE, <span class="keyword">CASE</span> </span><br><span class="line">	<span class="keyword">WHEN</span> JOB_TITLE <span class="keyword">LIKE</span> <span class="string">&#x27;%PRESIDENT%&#x27;</span> <span class="keyword">OR</span> JOB_TITLE <span class="keyword">LIKE</span> <span class="string">&#x27;%MANAGER%&#x27;</span> <span class="keyword">OR</span> JOB_TITLE <span class="keyword">LIKE</span> <span class="string">&#x27;%SALESMAN%&#x27;</span>  <span class="keyword">THEN</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line">	<span class="keyword">ELSE</span> <span class="string">&#x27;B&#x27;</span></span><br><span class="line"><span class="keyword">END</span> <span class="string">&#x27;TYPE&#x27;</span></span><br><span class="line"><span class="keyword">from</span> employees,jobs</span><br><span class="line"><span class="keyword">WHERE</span> employees.JOB_ID <span class="operator">=</span> jobs.JOB_ID <span class="keyword">ORDER</span> <span class="keyword">BY</span> EMPLOYEE_ID;</span><br><span class="line"># 第二种用法，<span class="keyword">case</span>后加表达式，<span class="keyword">when</span>比较值</span><br><span class="line"><span class="keyword">CASE</span> expr</span><br><span class="line">	<span class="keyword">WHEN</span> <span class="string">&#x27;x&#x27;</span> <span class="keyword">THEN</span> ...</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">else</span> ...</span><br><span class="line"><span class="keyword">END</span> 字段名</span><br></pre></td></tr></table></figure>

<h3 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h3><ul>
<li><p>基本概念</p>
<ul>
<li><p>内连接</p>
<p>只有两个表同时满足连接条件时会保留</p>
</li>
<li><p>左外连接</p>
<ul>
<li>保留左边表中所有记录,右边表中不满足以空代替</li>
</ul>
</li>
<li><p>右外连接</p>
<ul>
<li>与左外连接相反</li>
</ul>
</li>
</ul>
</li>
<li><p>内连接</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span>	列出emp表格及dept表格，结合后所有可能排列组合</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments;</span><br></pre></td></tr></table></figure>



<ul>
<li>左&#x2F;右外连接</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2.</span>	显示LastName是<span class="string">&#x27;SMITH&#x27;</span>及其所属部门资料</span><br><span class="line"><span class="keyword">SELECT</span> employees.EMPLOYEE_ID,employees.LAST_NAME, departments.<span class="operator">*</span> <span class="keyword">from</span> employees <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments <span class="keyword">ON</span> employees.DEPARTMENT_ID <span class="operator">=</span> departments.DEPARTMENT_ID <span class="keyword">WHERE</span> employees.LAST_NAME <span class="operator">=</span> <span class="string">&#x27;SMITH&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>别名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3.</span>	显示<span class="string">&#x27;SMITH&#x27;</span>员工及其所属部门数据(使用表格别名的方式，表格emp别名为a、表格dept别名为b)</span><br><span class="line"><span class="keyword">SELECT</span> a.EMPLOYEE_ID,a.LAST_NAME, b.<span class="operator">*</span> <span class="keyword">from</span> employees a <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments b <span class="keyword">ON</span> a.DEPARTMENT_ID <span class="operator">=</span> b.DEPARTMENT_ID <span class="keyword">WHERE</span> a.LAST_NAME <span class="operator">=</span> <span class="string">&#x27;SMITH&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>子查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">6.</span>	列出员工名字、职称及薪水及其管理者名字、职称及薪水数据</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">a.FIRST_NAME emp_first_name,a.LAST_NAME emp_last_name,a.JOB_TITLE emp_job_title, a.SALARY emp_salary,</span><br><span class="line">b.FIRST_NAME mng_first_name,b.LAST_NAME mng_last_name,b.JOB_TITLE mng_job_title, b.SALARY mng_salary </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"># 两个小表</span><br><span class="line">	(<span class="keyword">SELECT</span> FIRST_NAME,LAST_NAME,JOB_TITLE,SALARY,MANAGER_ID <span class="keyword">FROM</span> employees e,jobs j <span class="keyword">WHERE</span> e.JOB_ID <span class="operator">=</span> j.JOB_ID) <span class="keyword">as</span> a,</span><br><span class="line">	(<span class="keyword">SELECT</span> FIRST_NAME,LAST_NAME,JOB_TITLE,SALARY,EMPLOYEE_ID <span class="keyword">FROM</span> employees e,jobs j <span class="keyword">WHERE</span> e.JOB_ID <span class="operator">=</span> j.JOB_ID) <span class="keyword">as</span> b</span><br><span class="line"><span class="keyword">WHERE</span> a.MANAGER_ID <span class="operator">=</span> b.EMPLOYEE_ID;</span><br><span class="line"># 员工包含‘KING’</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">a.FIRST_NAME emp_first_name,a.LAST_NAME emp_last_name,a.JOB_TITLE emp_job_title, a.SALARY emp_salary,</span><br><span class="line">b.FIRST_NAME mng_first_name,b.LAST_NAME mng_last_name,b.JOB_TITLE mng_job_title, b.SALARY mng_salary </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"># 两个小表</span><br><span class="line">	(<span class="keyword">SELECT</span> FIRST_NAME,LAST_NAME,JOB_TITLE,SALARY,MANAGER_ID <span class="keyword">FROM</span> employees e,jobs j <span class="keyword">WHERE</span> e.JOB_ID <span class="operator">=</span> j.JOB_ID) <span class="keyword">as</span> a</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">	(<span class="keyword">SELECT</span> FIRST_NAME,LAST_NAME,JOB_TITLE,SALARY,EMPLOYEE_ID <span class="keyword">FROM</span> employees e,jobs j <span class="keyword">WHERE</span> e.JOB_ID <span class="operator">=</span> j.JOB_ID) <span class="keyword">as</span> b</span><br><span class="line"><span class="keyword">ON</span> a.MANAGER_ID <span class="operator">=</span> b.EMPLOYEE_ID;</span><br></pre></td></tr></table></figure>

<h3 id="分组-x2F-聚合函数"><a href="#分组-x2F-聚合函数" class="headerlink" title="分组&#x2F;聚合函数"></a>分组&#x2F;聚合函数</h3><p>group by 分组函数用于在聚合之前的分组统计</p>
<ul>
<li><p>聚合函数</p>
<ul>
<li>AVG() - 返回集合的平均值。</li>
<li>COUNT() - 返回集合中的项目数。</li>
<li>MAX() - 返回集合中的最大值。</li>
<li>MIN() - 返回集合中的最小值。</li>
<li>SUM() - 返回集合中所有或不同值的总和。</li>
</ul>
</li>
<li><p>聚合函数示例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span>	计算所有员工总数、薪水最低、薪水最高、薪水总和、平均薪水等数据</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) employees_count,<span class="built_in">MIN</span>(e.SALARY) min_salary,<span class="built_in">MAX</span>(e.SALARY) max_salary,<span class="built_in">SUM</span>(e.SALARY) sum_salary,<span class="built_in">AVG</span>(e.SALARY) avg_salary</span><br><span class="line"><span class="keyword">FROM</span> employees e;</span><br><span class="line"># <span class="number">2.</span>	计算各部门员工总数、薪水最低、薪水最高、薪水总和、平均薪水</span><br><span class="line"><span class="keyword">SELECT</span> IFNULL(DEPARTMENT_ID,<span class="string">&#x27;无部门&#x27;</span>) department,<span class="built_in">COUNT</span>(<span class="operator">*</span>) employees_count,<span class="built_in">MIN</span>(e.SALARY) min_salary,<span class="built_in">MAX</span>(e.SALARY) max_salary,<span class="built_in">SUM</span>(e.SALARY) sum_salary,<span class="built_in">AVG</span>(e.SALARY) avg_salary</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">GROUP</span> <span class="keyword">BY</span> DEPARTMENT_ID;</span><br><span class="line"># <span class="number">3.</span>	同范例二，但不含部门<span class="number">20</span>及管理者<span class="string">&#x27;KING&#x27;</span>数据</span><br><span class="line"># 使用IFNULL给DEPARTMENT_ID空值赋值，否则在<span class="keyword">IN</span>比较时会丢失</span><br><span class="line"><span class="keyword">SELECT</span> IFNULL(DEPARTMENT_ID,<span class="string">&#x27;无部门&#x27;</span>) department,<span class="built_in">COUNT</span>(<span class="operator">*</span>) employees_count,<span class="built_in">MIN</span>(e.SALARY) min_salary,<span class="built_in">MAX</span>(e.SALARY) max_salary,<span class="built_in">SUM</span>(e.SALARY) sum_salary,<span class="built_in">AVG</span>(e.SALARY) avg_salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> DEPARTMENT_ID</span><br><span class="line"><span class="keyword">HAVING</span> department <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">	<span class="number">20</span>,</span><br><span class="line">	# 管理者姓名中含有‘King’的部门号</span><br><span class="line">	(<span class="keyword">SELECT</span> e2.DEPARTMENT_ID <span class="keyword">FROM</span> departments d,employees e2 <span class="keyword">WHERE</span> <span class="built_in">UPPER</span>(CONCAT(e2.LAST_NAME,e2.FIRST_NAME))<span class="keyword">LIKE</span> <span class="string">&#x27;%KING%&#x27;</span> <span class="keyword">AND</span> d.MANAGER_ID <span class="operator">=</span> e2.EMPLOYEE_ID)</span><br><span class="line">);</span><br><span class="line"># 补回因为<span class="keyword">IN</span>判断丢失的部门号为空的记录(若不用IFNULL重新给<span class="keyword">NULL</span>赋值)</span><br><span class="line"># <span class="keyword">OR</span> DEPARTMENT_ID <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>起别名后排序问题</p>
<ul>
<li>别名建议直接使用英文并不加单引号，使用中文会造成无法排序</li>
</ul>
</li>
</ul>
<ul>
<li>ROLLUP与填充问题<ul>
<li>ROLLUP 分层计算综合，GROUP BY a1, a2 …. an:先计算以an分组的总和，最后计算a1的总和</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">8.</span>	计算员工数据表格中，各工作部门代号、工作类别薪水总和</span><br><span class="line"># <span class="number">9.</span>	同上例，且依照阶层关系找出各部门薪水小计及总计</span><br><span class="line"># <span class="keyword">ROLLUP</span> 分层计算综合，<span class="keyword">GROUP</span> <span class="keyword">BY</span> a1, a2 .... an:先计算以an分组的总和，最后计算a1的总和</span><br><span class="line"><span class="keyword">SELECT</span> e.DEPARTMENT_ID, e.JOB_ID,j.JOB_TITLE,<span class="built_in">sum</span>(e.SALARY) sum_salary <span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> jobs j <span class="keyword">ON</span> e.JOB_ID <span class="operator">=</span> j.JOB_ID <span class="keyword">GROUP</span> <span class="keyword">BY</span> e.DEPARTMENT_ID, e.JOB_ID <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">10.</span>	同范例<span class="number">8</span>，当部门小计时JOB字段显示’<span class="keyword">ALL</span> JOB’，当总计时detpno字段显示’<span class="keyword">ALL</span> DEPT’ 及JOB字段显示’<span class="keyword">ALL</span> JOB’</span><br><span class="line"><span class="keyword">SELECT</span> IFNULL(e.DEPARTMENT_ID,<span class="string">&#x27;ALL DEPT&#x27;</span>), IFNULL(e.JOB_ID,<span class="string">&#x27;ALL JOB&#x27;</span>),j.JOB_TITLE,<span class="built_in">sum</span>(e.SALARY) sum_salary <span class="keyword">FROM</span> </span><br><span class="line"># 无部门记录的空值会影响最后的填充，所以先子表填充替换</span><br><span class="line">(<span class="keyword">SELECT</span> IFNULL(DEPARTMENT_ID,<span class="string">&#x27;无部门信息&#x27;</span>) DEPARTMENT_ID,JOB_ID, SALARY <span class="keyword">FROM</span> employees) <span class="keyword">as</span> e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> jobs j <span class="keyword">ON</span> e.JOB_ID <span class="operator">=</span> j.JOB_ID <span class="keyword">GROUP</span> <span class="keyword">BY</span> e.DEPARTMENT_ID, e.JOB_ID <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>10题的另一种做法<ul>
<li>涉及概念:<ul>
<li>grouping (字段名): 生成一个列,可判断当前行是否为按照参数字段分组总结行,如是,值1,否则为0</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dep,job,</span><br><span class="line"><span class="keyword">CASE</span>        </span><br><span class="line">        <span class="keyword">WHEN</span></span><br><span class="line">                dep <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">                        <span class="string">&#x27;all dept&#x27;</span> <span class="keyword">ELSE</span> department_id </span><br><span class="line">                <span class="keyword">END</span> &quot;department_id&quot;,</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">WHEN</span> job <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="string">&#x27;all job&#x27;</span> <span class="keyword">ELSE</span> job_id </span><br><span class="line">        <span class="keyword">END</span> &quot;job_id&quot;,</span><br><span class="line">        sum_sa </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        (</span><br><span class="line">        <span class="keyword">SELECT</span></span><br><span class="line">                department_id,</span><br><span class="line">                job_id,</span><br><span class="line">                <span class="built_in">sum</span>( salary ) sum_sa,</span><br><span class="line">                <span class="keyword">grouping</span> ( department_id ) dep,</span><br><span class="line">                <span class="keyword">grouping</span> ( job_id ) job </span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">                employees </span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">                department_id,</span><br><span class="line">        job_id <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span> </span><br><span class="line">        ) a;</span><br></pre></td></tr></table></figure>

<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>查询出来的结果作为新表或者作为一个值在别的查询中使用</p>
<ul>
<li>简单子查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span>	找出员工数据:其薪资低于部门代码为<span class="number">10</span>中最低薪员工</span><br><span class="line"><span class="comment">-- 找出部门代码为10的部门中的最低薪资</span></span><br><span class="line"><span class="comment">-- 找出薪资低于部门10中最低薪资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="operator">*</span> <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.SALARY <span class="operator">&lt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(e.SALARY) <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.DEPARTMENT_ID <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">);</span><br><span class="line"># <span class="number">3.</span>	找出主管工作类别为<span class="string">&#x27;MANAGER&#x27;</span>员工数据</span><br><span class="line"><span class="comment">-- jobs表中找出job_title中包含&#x27;MANAGER&#x27;的job_id</span></span><br><span class="line"><span class="comment">-- emp表中找出job_id在以上结果集中的员工id</span></span><br><span class="line"><span class="comment">-- emp表中找出manager_id在以上结果集中的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> MANAGER_ID <span class="keyword">IN</span>	(</span><br><span class="line">	<span class="keyword">SELECT</span> EMPLOYEE_ID <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> JOB_ID <span class="keyword">IN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> JOB_ID <span class="keyword">FROM</span> jobs <span class="keyword">WHERE</span> JOB_TITLE <span class="keyword">LIKE</span> <span class="string">&#x27;%MANAGER%&#x27;</span></span><br><span class="line">	)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>UNION 合并两个表并去除重复的记录(只保留一个),要求两个表列数相同<ul>
<li>UNION ALL 合并两个表并保留重复记录</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">4.</span>	找出属于部门代号<span class="number">10</span>及<span class="number">20</span>的员工，且薪水大于该部门平均薪水</span><br><span class="line"><span class="comment">-- 查出两张表来连接,一张查部门号为10,一张查部门号为20</span></span><br><span class="line"><span class="keyword">SELECT</span> EMPLOYEE_ID,SALARY <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> SALARY <span class="operator">&gt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(SALARY) <span class="keyword">FROM</span> employees <span class="keyword">GROUP</span> <span class="keyword">BY</span> DEPARTMENT_ID <span class="keyword">HAVING</span> DEPARTMENT_ID <span class="operator">=</span> <span class="number">10</span> </span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> DEPARTMENT_ID <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="comment">-- UNION ALL 纵向连接表,要求列数相同</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> EMPLOYEE_ID,SALARY <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> SALARY <span class="operator">&gt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(SALARY) <span class="keyword">FROM</span> employees <span class="keyword">GROUP</span> <span class="keyword">BY</span> DEPARTMENT_ID <span class="keyword">HAVING</span> DEPARTMENT_ID <span class="operator">=</span> <span class="number">20</span> </span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> DEPARTMENT_ID <span class="operator">=</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>子查询于SELECT子句<ul>
<li>子查询跟在select之后,先执行外部查询,得到结果集后便利其代入子查询</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">6.</span>	使用子查询于<span class="keyword">Select</span>子句，找出员工数据及其主管名字</span><br><span class="line"><span class="comment">-- 这里的子查询跟在select之后,应该也是先执行外部查询,得到结果集后便利其代入子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> e1.<span class="operator">*</span>, (<span class="keyword">select</span> e2.FIRST_NAME <span class="keyword">from</span> employees e2 <span class="keyword">WHERE</span> e1.MANAGER_ID<span class="operator">=</span>e2.EMPLOYEE_ID) <span class="keyword">as</span> manager_name <span class="keyword">FROM</span> employees e1 <span class="keyword">ORDER</span> <span class="keyword">BY</span> e1.EMPLOYEE_ID;	</span><br></pre></td></tr></table></figure>

<ul>
<li>EXISTS 子查询<ul>
<li>EXISTS:结果存在为真,不存在为假<ul>
<li>1、 首先执行一次外部查询，并缓存结果集，如 SELECT * FROM A</li>
<li>2、遍历外部查询结果集的每一行记录R，代入子查询中作为条件进行查询，如 SELECT 1 FROM B WHERE B.id &#x3D; A.id</li>
<li>3、如果子查询有返回结果，则EXISTS子句返回TRUE，这一行R可作为外部查询的结果行，否则不能作为结果</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">7.</span>	使用<span class="keyword">Exists</span>子句找出主管工作类别为<span class="string">&#x27;MANAGER&#x27;</span>的员工数据</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> employees e1, employees e2</span><br><span class="line"><span class="keyword">WHERE</span> e1.MANAGER_ID <span class="operator">=</span> e2.EMPLOYEE_ID</span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line"><span class="keyword">EXISTS</span> (</span><br><span class="line"><span class="comment">-- 使用外部查询查出的每一条记录作为表在内部查询中比较,若内部查询中满足条件,保留该结果</span></span><br><span class="line"><span class="comment">-- 这里是查找该雇员的jobid所对应的jobtitle为manager的记录是否存在</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> jobs j <span class="keyword">WHERE</span> e2.JOB_ID <span class="operator">=</span> j.JOB_ID <span class="keyword">AND</span> j.JOB_TITLE <span class="keyword">LIKE</span> <span class="string">&#x27;%MANAGER%&#x27;</span> </span><br><span class="line">);</span><br><span class="line"># <span class="number">8.</span>	同上例，找出主管工作类型不为<span class="string">&#x27;MANAGER的员工数据&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="comment">-- 这里用左外连接,使用内连接会出现很多冗余</span></span><br><span class="line"><span class="keyword">FROM</span> employees e1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e2</span><br><span class="line"><span class="keyword">ON</span> e1.MANAGER_ID <span class="operator">=</span> e2.EMPLOYEE_ID</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> jobs j <span class="keyword">WHERE</span> e2.JOB_ID <span class="operator">=</span> j.JOB_ID <span class="keyword">AND</span> j.JOB_TITLE <span class="keyword">LIKE</span> <span class="string">&#x27;%MANAGER%&#x27;</span> </span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 补充主管为null的员工数据</span></span><br><span class="line"><span class="keyword">OR</span> e1.MANAGER_ID <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> e1.EMPLOYEE_ID</span><br><span class="line">;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="两个表的交并差"><a href="#两个表的交并差" class="headerlink" title="两个表的交并差"></a>两个表的交并差</h3><ul>
<li>测试数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span>	由emp表格中，找出为主管的数据 ，此为主管数据</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> e2.<span class="operator">*</span> <span class="keyword">FROM</span> employees e1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> employees e2 <span class="keyword">ON</span> e2.EMPLOYEE_ID <span class="operator">=</span> e1.MANAGER_ID;</span><br><span class="line"># <span class="number">2.</span>	由emp表格中，找出部门为<span class="number">30</span>，此为业务部门数据</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> employees <span class="keyword">WHERE</span> DEPARTMENT_ID <span class="operator">=</span> <span class="number">30</span>;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>交</p>
<p>交的话可以通过IN, 在其中一个表查出所有的ID,接着在另一个表中保留ID IN (集合)的记录</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">4.</span>	透过范例一及范例二所得的数据，找出为业务部门且为主管数据</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> e2.<span class="operator">*</span> <span class="keyword">FROM</span> employees e1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> employees e2 <span class="keyword">ON</span> e2.EMPLOYEE_ID <span class="operator">=</span> e1.MANAGER_ID <span class="keyword">WHERE</span> e2.EMPLOYEE_ID <span class="keyword">IN</span></span><br><span class="line">(<span class="keyword">SELECT</span> EMPLOYEE_ID <span class="keyword">from</span> employees <span class="keyword">WHERE</span> DEPARTMENT_ID <span class="operator">=</span> <span class="number">30</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>并</p>
<p>并可以直接使用UNION</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3.</span>	透过范例一及范例二所得的数据，找出为业务部门或为主管数据</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> e2.<span class="operator">*</span> <span class="keyword">FROM</span> employees e1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> employees e2 <span class="keyword">ON</span> e2.EMPLOYEE_ID <span class="operator">=</span> e1.MANAGER_ID</span><br><span class="line"><span class="keyword">UNION</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> employees <span class="keyword">WHERE</span> DEPARTMENT_ID <span class="operator">=</span> <span class="number">30</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>差</p>
<p>与交类似,改为NOT IN</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">5.</span>	透过范例一及范例二所得的数据，找出为主管但不为业务部门数据</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> e2.<span class="operator">*</span> <span class="keyword">FROM</span> employees e1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> employees e2 <span class="keyword">ON</span> e2.EMPLOYEE_ID <span class="operator">=</span> e1.MANAGER_ID <span class="keyword">WHERE</span> e2.EMPLOYEE_ID <span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line">(<span class="keyword">SELECT</span> EMPLOYEE_ID <span class="keyword">from</span> employees <span class="keyword">WHERE</span> DEPARTMENT_ID <span class="operator">=</span> <span class="number">30</span>);</span><br></pre></td></tr></table></figure>

<h3 id="查询语句执行顺序"><a href="#查询语句执行顺序" class="headerlink" title="查询语句执行顺序"></a>查询语句执行顺序</h3><p>(8) SELECT (9) DISTINCT (11) <TOP_specification> <select_list><br>(1) FROM <left_table><br>(3) <join_type> JOIN <right_table><br>(2) ON <join_condition><br>(4) WHERE <where_condition><br>(5) GROUP BY <group_by_list><br>(6) WITH {CUBE | ROLLUP}<br>(7) HAVING <having_condition><br>(10) ORDER BY <order_by_list> </order_by_list></having_condition></group_by_list></where_condition></join_condition></right_table></join_type></left_table></select_list></TOP_specification></p>
<h2 id="INSERT"><a href="#INSERT" class="headerlink" title="INSERT"></a>INSERT</h2><ul>
<li>单条记录插入</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 注明字段名</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> jobs(字段列表,..,.....) <span class="keyword">VALUES</span> (值列表,...,.....)</span><br><span class="line"># 所有字段都插入</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> jobs <span class="keyword">VALUES</span> (值列表,...,.....)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>从其他表拷贝<ul>
<li>需要查出来的子表与即将插入到的表的列数相同</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 插入整张表</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp_temp <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees;</span><br><span class="line"># 指定元素插入</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table1 (name, sex, age)<span class="keyword">SELECT</span> user_name, sex, age <span class="keyword">FROM</span> table2 <span class="keyword">WHERE</span> ....;</span><br></pre></td></tr></table></figure>

<h2 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h2><ul>
<li>一定注意条件</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table1 <span class="keyword">WHERE</span> .....</span><br></pre></td></tr></table></figure>

<p>删除时不可以给表起别名</p>
<h2 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h2><ul>
<li>子查询出来要当表用需要起别名 <ul>
<li>Every derived table must have its own alias</li>
</ul>
</li>
<li>如果在修改的过程中需要使用该表中的数据,需要先把该表中的数据查询出来之后,起一个别名作为子表,外边再套一层SELECT * FROM(…)AS a;<ul>
<li>You can’t specify target table ‘employees’ for update in FROM clause</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">7.</span>	工作职称为<span class="string">&#x27;MANAGER&#x27;</span>的员工加薪<span class="number">1.5</span>倍</span><br><span class="line"><span class="comment">-- You can&#x27;t specify target table &#x27;employees&#x27; for update in FROM clause</span></span><br><span class="line"><span class="comment">-- 解决方法:中间包一层</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> SALARY <span class="operator">=</span> SALARY <span class="operator">*</span> <span class="number">1.5</span> <span class="keyword">WHERE</span> EMPLOYEE_ID <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span>(</span><br><span class="line">		<span class="keyword">SELECT</span> EMPLOYEE_ID <span class="keyword">FROM</span> employees e, jobs j <span class="keyword">WHERE</span> e.JOB_ID <span class="operator">=</span> j.JOB_ID <span class="keyword">AND</span> j.JOB_TITLE <span class="keyword">LIKE</span> <span class="string">&#x27;%MANAGER%&#x27;</span></span><br><span class="line">	) <span class="keyword">AS</span> a</span><br><span class="line">)</span><br><span class="line"># <span class="number">8.</span>	工作职称为<span class="string">&#x27;CLARK&#x27;</span>的员工，薪水修正为所有员工的平均薪水</span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> SALARY <span class="operator">=</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span>(</span><br><span class="line">		<span class="comment">-- 平均薪资</span></span><br><span class="line">		<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(employees.SALARY) <span class="keyword">FROM</span> employees</span><br><span class="line">	) <span class="keyword">as</span> b</span><br><span class="line">) <span class="keyword">WHERE</span> EMPLOYEE_ID <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> EMPLOYEE_ID <span class="keyword">FROM</span> employees e, jobs j <span class="keyword">WHERE</span> e.JOB_ID <span class="operator">=</span> j.JOB_ID <span class="keyword">AND</span> j.JOB_TITLE <span class="keyword">LIKE</span> <span class="string">&#x27;%CLERK%&#x27;</span></span><br><span class="line">	) <span class="keyword">as</span> a</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h1 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h1><h2 id="CREATE-TABLE"><a href="#CREATE-TABLE" class="headerlink" title="CREATE TABLE"></a>CREATE TABLE</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name(</span><br><span class="line">     column_name_1 data_type <span class="keyword">default</span> <span class="keyword">value</span> column_constraint,</span><br><span class="line">     column_name_2 data_type <span class="keyword">default</span> <span class="keyword">value</span> column_constraint,</span><br><span class="line">     ...,</span><br><span class="line">     table_constraint</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>表名唯一: 由table_name指定的表名在数据库中必须是唯一的。 如果创建的表的名称与已存在的表相同，则数据库系统将发出错误。</li>
<li>类型,约束: 在CREATE TABLE语句中，指定以逗号分隔的列定义列表。每个列定义由列名，列的数据类型，默认值和一个或多个列约束组成。列的数据类型指定列可以存储的数据类型。 列的数据类型可以是数字，字符，日期等。列约束控制可以存储在列中的值的类型。 例如，NOT NULL约束确保列不包含NULL值。列可能有多个列约束。 例如，users表的username列可以同时具有NOT NULL和UNIQUE约束。如果约束包含多个列，则使用表约束。 例如，如果表的主键包含两列，则在这种情况下，必须使用PRIMARY KEY表约束。</li>
</ul>
<h2 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h2><ul>
<li>NOT NULL - 某列不能存储NULL 值</li>
<li>UNIQUE - 某列每行的值必须唯一</li>
<li>PRIMARY KEY - 主键，附有NOT NULL与UNIQUE效果</li>
<li>FOREIGN KEY - 参照另一个表中的值，参照完整性</li>
<li>CHECK - 保证列中的值符合指定的条件</li>
<li>DEFULT - 规定没有给列赋值时的默认值</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># mysql</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">P_Id <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">LastName <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">FirstName <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">CHECK</span> (P_Id<span class="operator">&gt;</span><span class="number">0</span>)</span><br><span class="line">)</span><br><span class="line"># oracle, <span class="keyword">sql</span> server</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">P_Id <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">CHECK</span> (P_Id<span class="operator">&gt;</span><span class="number">0</span>),</span><br><span class="line">LastName <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">FirstName <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br><span class="line"># <span class="keyword">check</span>命名,多列<span class="keyword">check</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">P_Id <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">LastName <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">FirstName <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">Address <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">City <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> chk_Person <span class="keyword">CHECK</span> (P_Id<span class="operator">&gt;</span><span class="number">0</span> <span class="keyword">AND</span> City<span class="operator">=</span><span class="string">&#x27;Sandnes&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><ul>
<li>普通索引、单列索引<ul>
<li>length: 每列值的前length</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 创建</span><br><span class="line"><span class="keyword">CREATE</span> INDEX index_name <span class="keyword">ON</span> <span class="keyword">table</span>(<span class="keyword">column</span>(length))</span><br><span class="line"># 修改</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> INDEX index_name <span class="keyword">ON</span> (<span class="keyword">column</span>(length))</span><br><span class="line"># 删除</span><br><span class="line"><span class="keyword">DROP</span> INDEX index_name <span class="keyword">ON</span> <span class="keyword">table</span></span><br></pre></td></tr></table></figure>

<ul>
<li>唯一索引<ul>
<li>唯一索引不止用于提升查询性能，还用于保证数据完整性。唯一索引不允许向表中插入任何重复值。其基本语法如下所示：</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX index_name</span><br><span class="line"><span class="keyword">on</span> table_name (column_name);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> indexName <span class="keyword">ON</span> (<span class="keyword">column</span>(length))</span><br></pre></td></tr></table></figure>

<ul>
<li>聚簇索引<ul>
<li>　聚簇索引在表中两个或更多的列的基础上建立。其基本语法如下所示：</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX index_name</span><br><span class="line"><span class="keyword">on</span> table_name (column1, column2);</span><br></pre></td></tr></table></figure>

<ul>
<li>隐式索引<ul>
<li>隐式索引由数据库服务器在创建某些对象的时候自动生成。例如，对于主键约束和唯一约束，数据库服务器就会自动创建索引。</li>
</ul>
</li>
<li>何时避免使用索引<ul>
<li>小的数据表不应当使用索引；</li>
<li>需要频繁进行大批量的更新或者插入操作的表；</li>
<li>如果列中包含大数或者 NULL 值，不宜创建索引；</li>
<li>频繁操作的列不宜创建索引。</li>
</ul>
</li>
</ul>
<h2 id="ALTER-TABLE"><a href="#ALTER-TABLE" class="headerlink" title="ALTER TABLE"></a>ALTER TABLE</h2><h3 id="添加列"><a href="#添加列" class="headerlink" title="添加列"></a>添加列</h3><ul>
<li>ADD COLUMN</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">4.</span>于emp_temp表格中，加入性别字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp_temp <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> sex <span class="type">VARCHAR</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h3 id="删除列"><a href="#删除列" class="headerlink" title="删除列"></a>删除列</h3><ul>
<li>DROP COLUMN</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">6.</span>将SEX字段删除</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp_temp <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> sex;</span><br></pre></td></tr></table></figure>

<h3 id="改变数据类型"><a href="#改变数据类型" class="headerlink" title="改变数据类型"></a>改变数据类型</h3><ul>
<li>MODIFY COLUMN</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 5.修正范例四性别字段为Varhar2(10)</span><br><span class="line">ALTER TABLE emp_temp MODIFY COLUMN sex VARCHAR(10);</span><br></pre></td></tr></table></figure>

<h3 id="更改表名"><a href="#更改表名" class="headerlink" title="更改表名"></a>更改表名</h3><ul>
<li>RENAME TO</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">7.</span>将表格对象更名为emp_temp2</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp_temp RENAME <span class="keyword">TO</span> emp_temp2;</span><br></pre></td></tr></table></figure>

<h3 id="增加约束"><a href="#增加约束" class="headerlink" title="增加约束"></a>增加约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">8.</span>加入限制条件emp_pk(<span class="keyword">Primary</span> Key)于emp_temp2表格中empno字段上</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp_temp2 <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY(EMPLOYEE_ID);</span><br></pre></td></tr></table></figure>

<h2 id="DROP-TABLE"><a href="#DROP-TABLE" class="headerlink" title="DROP TABLE"></a>DROP TABLE</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> table_name</span><br></pre></td></tr></table></figure>

<h2 id="CREATE-INDEX"><a href="#CREATE-INDEX" class="headerlink" title="CREATE INDEX"></a>CREATE INDEX</h2><ul>
<li>见&lt;CREATE TABLE - 索引&gt;</li>
</ul>
<h2 id="DROP-INDEX"><a href="#DROP-INDEX" class="headerlink" title="DROP INDEX"></a>DROP INDEX</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">DROP</span> INDEX index_name</span><br></pre></td></tr></table></figure>

<h2 id="DROP-DATABASE"><a href="#DROP-DATABASE" class="headerlink" title="DROP DATABASE"></a>DROP DATABASE</h2><p>databasename用反引号圈住</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE `database_name`</span><br></pre></td></tr></table></figure>

<h2 id="CREATE-VIEW"><a href="#CREATE-VIEW" class="headerlink" title="CREATE VIEW"></a>CREATE VIEW</h2><ul>
<li>CREATE VIEW … AS SELECT…. : SELECT后为view中数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW emp_v1 AS SELECT * FROM employees WHERE DEPARTMENT_ID = 20;</span><br></pre></td></tr></table></figure>

<ul>
<li>SELECT 结果中有列名重复时无法创建视图</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3.</span>	建立emp_v3的<span class="keyword">VIEW</span>，数据源为emp表格与dept表格，使用<span class="keyword">JOIN</span>合并(键值为deptno)</span><br><span class="line"><span class="comment">-- 重复的列</span></span><br><span class="line"><span class="comment">-- 如果只有一个重复的列可使用using</span></span><br><span class="line"><span class="comment">-- 若有多个,应该显示的列出所有字段</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> emp_v3;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> emp_v3 <span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">e.EMPLOYEE_ID,e.FIRST_NAME,e.LAST_NAME,e.EMAIL,e.PHONE_NUMBER,e.HIRE_DATE,e.JOB_ID,e.SALARY,e.COMMISSION_PCT,e.MANAGER_ID,e.DEPARTMENT_ID,d.DEPARTMENT_ID dep_dep_id,d.DEPARTMENT_NAME,d.MANAGER_ID dep_manager_id,d.LOCATION_ID</span><br><span class="line"> <span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">USING</span>(DEPARTMENT_ID);</span><br></pre></td></tr></table></figure>

<h1 id="DCL"><a href="#DCL" class="headerlink" title="DCL"></a>DCL</h1><h2 id="GRANT"><a href="#GRANT" class="headerlink" title="GRANT"></a>GRANT</h2><p>授予访问权限,对用户进行mysql服务器&#x2F;数据库&#x2F;表&#x2F;表字段等的不同权限授予</p>
<h2 id="REVOKE"><a href="#REVOKE" class="headerlink" title="REVOKE"></a>REVOKE</h2><p>撤销访问权限</p>
<h2 id="COMMIT"><a href="#COMMIT" class="headerlink" title="COMMIT"></a>COMMIT</h2><p>提交事务处理</p>
<h2 id="ROLLBACK"><a href="#ROLLBACK" class="headerlink" title="ROLLBACK"></a>ROLLBACK</h2><p>事务处理回退</p>
<h2 id="SAVEPOINT"><a href="#SAVEPOINT" class="headerlink" title="SAVEPOINT"></a>SAVEPOINT</h2><p>设置保存点</p>
<h2 id="LOCK"><a href="#LOCK" class="headerlink" title="LOCK"></a>LOCK</h2><p>对数据库的特定部分进行锁定</p>
<h1 id="常用SQL函数及关键字"><a href="#常用SQL函数及关键字" class="headerlink" title="常用SQL函数及关键字"></a>常用SQL函数及关键字</h1><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><ul>
<li>AVG() 返回平均值</li>
<li>COUNT() 返回匹配条件的行数,null值不计入</li>
<li>MAX() 返回该列最大值</li>
<li>MIN()返回该列最小值</li>
</ul>
<h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><ul>
<li>WITH ROLLUP 分层算总和</li>
<li>TRUNCATE 截断数字,可指定小数位数</li>
<li>DUAL 虚拟表 可以当一个表使用,mysql中可以查询多条</li>
</ul>
<h1 id="SQL优化基础"><a href="#SQL优化基础" class="headerlink" title="SQL优化基础"></a>SQL优化基础</h1><h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><p>可通过更改STOERGE_ENGINE配置变量来更改MySQL服务器的默认存储引擎</p>
<ul>
<li>MyISAM: MySQL插件式的存储引擎,在WEB,数据仓储等其他应用环境下最常用的存储引擎之一。</li>
<li>InnoDB：用于事务处理应用程序，具有众多特性，包括ACID事务支持</li>
<li>BDB：可替代InnoDB的事务引擎，支持COMMIT，ROLLBACK 和其他事务特性。</li>
<li>Memory：将所有数据存储在RAM中，在需要快速查找引用和其它类似数据的环境下，可提供极快的访问</li>
<li>Merge：允许MySQL DBA或者开发人员将一系列等同的MyISAM表以逻辑方式组合在一起，并作为一个对象引用他们。对于诸如数据仓储等VLDB环境十分适合</li>
<li>Archive：为大量很少引用的历史，归档或安全审计信息的存储和检索提供了完美的解决方案</li>
<li>Federated：能够将多个分离的MySQL服务器连接起来，从多个物理服务器创建一个逻辑数据库，十分适合于分布式环境或者数据集市环境</li>
</ul>
<h3 id="存储引擎相关命令"><a href="#存储引擎相关命令" class="headerlink" title="存储引擎相关命令"></a>存储引擎相关命令</h3><ul>
<li>查看当前默认的引擎</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;default_storage_engine&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>查看指定表当前的引擎</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">table</span> status <span class="keyword">where</span> NAME <span class="operator">=</span> <span class="string">&#x27;表名&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>修改MySQL默认的数据库引擎<br>打开配置文件my.ini，将“default-storage-engine&#x3D;MYISAM”改为你想设定的，然后重启即可</li>
<li>查看MySQL支持的引擎有哪些</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> engines;</span><br></pre></td></tr></table></figure>

<h2 id="MySQL优化方式"><a href="#MySQL优化方式" class="headerlink" title="MySQL优化方式"></a>MySQL优化方式</h2><h3 id="应用优化方式"><a href="#应用优化方式" class="headerlink" title="应用优化方式"></a>应用优化方式</h3><ul>
<li>设计合理的数据表结构,适当冗余<ul>
<li>如若某表中某一字段经常要与别的表联合查询,可将该字段冗余到其他表中</li>
</ul>
</li>
<li>对数据库表建立合适有效的数据库索引</li>
<li>数据查询编写简洁高效的SQL语句</li>
</ul>
<p><strong>表结构设计原则</strong></p>
<ul>
<li>选择合适的数据类型,如果能够定长尽量定长,定长的表查询检索更新速度都很快</li>
<li>使用ENUM而不是VARCHAR,如果你有一个字段，比如“性别”，“国家”，“民族”， “状态”或“部门”，你知道这些字段的取值是有限而且固定的，那么，你应该使用 ENUM 而不是VARCHAR。ENUM类型是非常快和紧凑的，在实际 上，其保存的是 TINYINT，但其外表上显示为字符串。这样一来，用这个 字段来做一些选项列表变得相当的完美 。</li>
<li>不要使用无法加索引的类型作为关键字段，比如 text类型</li>
<li>为了避免联表查询，有时候可以适当的数据冗余，比如 邮箱、姓名这些不容易更改的数据</li>
<li>选择合适的表引擎，有时候 MyISAM 适合，有时候 InnoDB适合</li>
<li>为保证查询性能，最好每个表都建立有 auto_increment 字段， 建立合适的数据库索引</li>
<li>最好给每个字段都设定 default</li>
</ul>
<p><strong>索引建立规则</strong></p>
<ul>
<li>一般针对数据分散的关键字进行建立索引，比如ID、QQ， 像性别、状态值等等建立索引没有意义</li>
<li>字段唯一，最少，不可为null</li>
<li>对大数据量表建立聚集索引，避免更新操作带来的碎片。（<strong>聚集索引就是存放的物理顺序和列中的顺序一样。</strong>）</li>
<li>尽量使用短索引，一般对int、char&#x2F;varchar、date&#x2F;time 等 类型的字段建立索引</li>
<li>需要的时候建立联合索引，但是要注意查询SQL语句的编写</li>
<li>谨慎建立 unique 类型的索引（唯一索引）</li>
<li>大文本字段不建立为索引，如果要对大文本字段进行检索， 可以考虑全文索引</li>
<li>频繁更新的列不适合建立索引</li>
<li>order by 字句中的字段，where 子句中字段，最常用的sql 语句中字段，应建立索引。</li>
<li>唯一性约束，系统将默认为该字段建立索引。</li>
<li>对于只是做查询用的数据库索引越多越好，但对于在线实时系统建议控制在5个以内。</li>
<li>索引不仅能提高查询SQL性能，同时也可以提高带where字句的update，Delete SQL性能。</li>
<li>Decimal 类型字段不要单独建立为索引，但覆盖索引可以包含这些字段。（覆盖索引是select的数据列只用从索引中就能够取得，不必读取数据行，换句话说查询列要被所建的索引覆盖。实现索引覆盖最常见的方法就是：将被查询的字段，建立到联合索引（如果只有一个字段，普通索引也可以）里去。）</li>
<li>只有建立索引以后，表内的行才按照特地的顺序存储，按照 需要可以是asc或desc方式。</li>
<li>如果索引由多个字段组成将最用来查询过滤的字段放在前面 可能会有更好的性能</li>
</ul>
<p><strong>编写高效SQL</strong></p>
<ul>
<li>能够快速缩小结果集的 WHERE 条件写在前面，如果有恒量条件， 也尽量放在前面</li>
<li>尽量避免使用 GROUP BY、DISTINCT 、OR、IN 等语句的使用，避免使用联表查询和子查询，因为将使执行效率大大下降</li>
<li>能够使用索引的字段尽量进行有效的合理排列，如果使用了 联合索引，请注意提取字段的前后顺序</li>
<li>针对索引字段使用 &gt;, &gt;&#x3D;, &#x3D;, &lt;, &lt;&#x3D;, IF NULL和BETWEEN 将会使用 索引， 如果对某个索引字段进行 LIKE 查询，使用 LIKE ‘%abc%，不能使用索引，使用 LIKE ‘abc%’ 将能够使用索引</li>
<li>如果在SQL里使用了MySQL部分自带函数，索引将失效，同时将无法 使用 MySQL 的 Query Cache，比如 LEFT(), SUBSTR(), TO_DAYS()  DATE_FORMAT(), 等，如果使用了 OR 或 IN，索引也将失效</li>
<li>使用 Explain 语句来帮助改进我们的SQL语句</li>
<li>不要在where 子句中的“&#x3D;”左边进行算术或表达式运算，否则系统将 可能无法正确使用索引</li>
<li>尽量不要在where条件中使用函数，否则将不能使用索引</li>
<li>避免使用 select *, 只取需要的字段</li>
<li>对于大数据量的查询，尽量避免在SQL语句中使用order by 字句，避免额外的开销，替代为使用ADO.NET 来实现。</li>
<li>只关心需要的表和满足条件的数据</li>
<li>适当使用临时表或表变量</li>
<li>对于连续的数值，使用between代替in</li>
<li>where 字句中尽量不要使用CASE条件</li>
<li>尽量不用触发器，特别是在大数据表上</li>
<li>更新触发器如果不是所有情况下都需要触发，应根据业务需要加 上必要判断条件</li>
<li>使用union all 操作代替OR操作，注意此时需要注意一点查询条件可以使用聚集索引，如果是非聚集索引将起到相反的结果</li>
<li>当只要一行数据时使用 LIMIT 1</li>
<li>尽可能的使用 NOT NULL填充数据库</li>
<li>拆分大的 DELETE 或 INSERT 语句</li>
<li>批量提交SQL语句</li>
</ul>
<h3 id="其他技巧"><a href="#其他技巧" class="headerlink" title="其他技巧"></a>其他技巧</h3><h4 id="常用技巧"><a href="#常用技巧" class="headerlink" title="常用技巧"></a>常用技巧</h4><ul>
<li>使用 Explain&#x2F; DESC 来分析SQL的执行情况</li>
<li>使用 SHOW PROCESSLIST 来查看当前MySQL服务器线程 执行情况，是否锁表，查看相应的SQL语句</li>
<li>设置 my.cnf 中的 long-query-time 和 log-slow-queries 能够 记录服务器那些SQL执行速度比较慢</li>
<li>另外有用的几个查询：SHOW VARIABLES、SHOW  STATUS、SHOW ENGINES</li>
<li>使用 DESC TABLE xxx 来查看表结构，使用 SHOW INDEX FROM xxx 来查看表索引</li>
<li>使用 LOAD DATA 导入数据比 INSERT INTO 快多了</li>
<li>SELECT COUNT(*) FROM Tbl 在 InnoDB 中将会扫描全表 MyISAM 中则效率很高</li>
</ul>
<h4 id="MySQL-Slow-Log"><a href="#MySQL-Slow-Log" class="headerlink" title="MySQL Slow Log"></a>MySQL Slow Log</h4><ul>
<li>mysqldumpslow - mysql官方提供的慢查询日志分析工具</li>
<li>mysqlsla - hackmysql.com推出的一款日志分析工具，功能 非常强大</li>
<li>mysql-explain-slow-log – 德国工程师使用Perl开发的把 Slow Log 输出到屏幕，功能简单</li>
<li>mysql-log-filter - Google code 上一个开源产品，报表简洁</li>
</ul>
<h1 id="习题答案解析"><a href="#习题答案解析" class="headerlink" title="习题答案解析"></a>习题答案解析</h1><h2 id="lab-2"><a href="#lab-2" class="headerlink" title="lab 2"></a>lab 2</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span>        显示员工代号、员工姓名及薪水 <span class="operator">*</span> <span class="number">1.5</span>倍后资料</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        employee_id,</span><br><span class="line">        CONCAT( first_name, <span class="string">&#x27; &#x27;</span>, last_name ),</span><br><span class="line">        salary <span class="operator">*</span> <span class="number">1.5</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees;</span><br><span class="line">        </span><br><span class="line">#<span class="number">2.</span>        显示主管(mgr)为<span class="keyword">Null</span>的员工资料</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        manager_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line">        </span><br><span class="line">#<span class="number">3.</span>        透过emp表格找出所有可能的部门代号(不可重复)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span></span><br><span class="line">        department_id </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees;</span><br><span class="line">        </span><br><span class="line">#<span class="number">4.</span>        依照员工薪水资料，由大至小排列</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">        salary <span class="keyword">DESC</span>;</span><br><span class="line">        </span><br><span class="line">#<span class="number">5.</span>        找出员工姓名为JOHN的员工数据</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        <span class="built_in">upper</span>( last_name ) <span class="operator">=</span> <span class="string">&#x27;JOHN&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">#<span class="number">6.</span>        找出薪水小于$<span class="number">3000</span>的员工数据</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        salary <span class="operator">&lt;</span> <span class="number">3000</span>;</span><br><span class="line">        </span><br><span class="line">#<span class="number">7.</span>        显示工作类别非<span class="string">&#x27;PRESIDENT&#x27;</span>及<span class="string">&#x27;MANAGER&#x27;</span>的员工数据</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        e.first_name,</span><br><span class="line">        e.last_name,</span><br><span class="line">        j.job_title </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees e,</span><br><span class="line">        jobs j </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        e.job_id <span class="operator">=</span> j.job_id </span><br><span class="line">        <span class="keyword">AND</span> LOCATE(</span><br><span class="line">                <span class="string">&#x27;PRESIDENT&#x27;</span>,</span><br><span class="line">        <span class="built_in">upper</span>( j.job_title )) <span class="operator">=</span> <span class="number">0</span> </span><br><span class="line">        <span class="keyword">AND</span> LOCATE(</span><br><span class="line">                <span class="string">&#x27;MANAGER&#x27;</span>,</span><br><span class="line">        <span class="built_in">upper</span>( j.job_title )) <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">#<span class="number">8.</span>        找出员工名字为S开头的员工</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        last_name <span class="keyword">LIKE</span> <span class="string">&#x27;S%&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">#<span class="number">9.</span>        将员工姓名及员工代码结合为新字段，重新命名为NAME_NO</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        CONCAT( first_name, <span class="string">&#x27; &#x27;</span>, last_name ) &quot;NAME_NO&quot; </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees;</span><br><span class="line">        </span><br><span class="line">#<span class="number">10.</span>        找出部门代号为<span class="number">20</span>且薪水介于<span class="number">2000</span>及<span class="number">4000</span>间(包含<span class="number">2000</span>及<span class="number">4000</span>)，并依照资深至资浅排序</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        department_id <span class="operator">=</span> <span class="number">20</span> </span><br><span class="line">        <span class="keyword">AND</span> salary <span class="keyword">BETWEEN</span> <span class="number">2000</span> </span><br><span class="line">        <span class="keyword">AND</span> <span class="number">4000</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">        hire_date;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="lab-3"><a href="#lab-3" class="headerlink" title="lab 3"></a>lab 3</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>        显示工作名称字段(转换为小写格式)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        <span class="built_in">lower</span>( job_title ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        jobs;</span><br><span class="line">        </span><br><span class="line">#<span class="number">2.</span>        显示员工名字(转换为第一个字为大写其余为小写格式)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        concat(</span><br><span class="line">                <span class="built_in">UPPER</span>(</span><br><span class="line">                <span class="keyword">LEFT</span> ( last_name, <span class="number">1</span> )),</span><br><span class="line">                <span class="built_in">substring</span>(</span><br><span class="line">                        last_name,</span><br><span class="line">                        <span class="number">2</span>,(</span><br><span class="line">                                length( last_name )<span class="operator">-</span> <span class="number">1</span> </span><br><span class="line">                        ))) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees;</span><br><span class="line">        </span><br><span class="line">#<span class="number">3.</span>        显示员工名字及工作名称结合的新字符串，并找出工作名称在新字符串的开始位置</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        concat( last_name, <span class="string">&#x27; &#x27;</span>, job_title ) &quot;NAME_JOB&quot;,</span><br><span class="line">        instr( concat( last_name, <span class="string">&#x27; &#x27;</span>, job_title ), job_title ) &quot;location&quot; </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees e,</span><br><span class="line">        jobs j </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        e.job_id <span class="operator">=</span> j.job_id;</span><br><span class="line">        </span><br><span class="line">#<span class="number">4.</span>        列出年资大于<span class="number">15</span>年的员工数据</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        (</span><br><span class="line">        date_format( now(), <span class="string">&#x27;%Y-%m-%d&#x27;</span> ) <span class="operator">-</span> date_format( hire_date, <span class="string">&#x27;%Y-%m-%d&#x27;</span> )) <span class="operator">&gt;</span> <span class="number">15</span>;</span><br><span class="line">        </span><br><span class="line">#<span class="number">5.</span>        显示员工薪水数据(无条件舍去到整数字数的千位数)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span></span><br><span class="line">        ( salary, <span class="operator">-</span> <span class="number">3</span> ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees;</span><br><span class="line">        </span><br><span class="line">#<span class="number">6.</span>        显示员工名字、薪水及薪水代号(薪水大于<span class="number">3000</span>显示<span class="string">&#x27;1&#x27;</span>，小于<span class="number">3000</span>显示<span class="string">&#x27;-1&#x27;</span>，与<span class="number">3000</span>相等时显示<span class="number">0</span>，使用Sign函数)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        last_name,</span><br><span class="line">        salary,</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line">                sign( salary <span class="operator">-</span> <span class="number">3000</span> ) </span><br><span class="line">                <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="number">1</span> </span><br><span class="line">                <span class="keyword">WHEN</span> <span class="operator">-</span> <span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="operator">-</span> <span class="number">1</span> </span><br><span class="line">                <span class="keyword">WHEN</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="number">0</span> </span><br><span class="line">        <span class="keyword">END</span> &quot;SALARY_ID&quot; </span><br><span class="line">        </span><br><span class="line">#<span class="number">7.</span>        显示当月的天数，试写出两种以上方法</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span></span><br><span class="line">        (</span><br><span class="line">                LAST_DAY(</span><br><span class="line">                sysdate()))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第二种方法：</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        DATE_FORMAT( last_day( sysdate()), <span class="string">&#x27;%d&#x27;</span> ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        DUAL;</span><br><span class="line">        </span><br><span class="line">#<span class="number">8.</span>        计算<span class="number">2010</span>年<span class="number">1</span>月<span class="number">1</span>日与目前日期差异天数</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        to_days(</span><br><span class="line">        now()) <span class="operator">-</span> to_days( <span class="string">&#x27;20100101&#x27;</span> ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        DUAL;</span><br><span class="line">        </span><br><span class="line">#<span class="number">9.</span>        若当该名员工无主管时，显示<span class="string">&#x27;NO MGR&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        last_name,</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">WHEN</span> manager_id <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="string">&#x27;NO MGR&#x27;</span> <span class="keyword">ELSE</span> manager_id </span><br><span class="line">        <span class="keyword">END</span> &quot;MANAGER_ID&quot; </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees;</span><br><span class="line">        </span><br><span class="line">#<span class="number">10.</span>        若员工工作名称为<span class="string">&#x27;PRESIDENT&#x27;</span>、 <span class="string">&#x27;MANAGER&#x27;</span>及<span class="string">&#x27;SALESMAN&#x27;</span>则显示<span class="string">&#x27;A&#x27;</span>，其他则显示<span class="string">&#x27;B&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        last_name,</span><br><span class="line">        job_title,</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line">                <span class="built_in">upper</span>( job_title ) </span><br><span class="line">                <span class="keyword">WHEN</span> <span class="string">&#x27;PRESIDENT&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="string">&#x27;A&#x27;</span> </span><br><span class="line">                <span class="keyword">WHEN</span> <span class="string">&#x27;MANAGER&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="string">&#x27;A&#x27;</span> </span><br><span class="line">                <span class="keyword">WHEN</span> <span class="string">&#x27;SALESMAN&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="string">&#x27;A&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;B&#x27;</span> </span><br><span class="line">        <span class="keyword">END</span> &quot;JOB_TYPE&quot; </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees e,</span><br><span class="line">        jobs j</span><br></pre></td></tr></table></figure>

<h2 id="lab-4"><a href="#lab-4" class="headerlink" title="lab 4"></a>lab 4</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>        列出emp表格及dept表格，结合后所有可能排列组合</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees,</span><br><span class="line">        departments;</span><br><span class="line">        </span><br><span class="line">#<span class="number">2.</span>        显示<span class="string">&#x27;SMITH&#x27;</span>及其所属部门资料</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        employee_id,</span><br><span class="line">        last_name,</span><br><span class="line">        department_name </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees,</span><br><span class="line">        departments </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        last_name <span class="operator">=</span> <span class="string">&#x27;Smith&#x27;</span> </span><br><span class="line">        <span class="keyword">AND</span> employees.department_id <span class="operator">=</span> departments.department_id;</span><br><span class="line">        </span><br><span class="line">#<span class="number">3.</span>        显示<span class="string">&#x27;SMITH&#x27;</span>员工及其所属部门数据(使用表格别名的方式，表格emp别名为a、表格dept别名为b)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        a.employee_id,</span><br><span class="line">        a.last_name,</span><br><span class="line">        b.department_name </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees a,</span><br><span class="line">        departments b </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        last_name <span class="operator">=</span> <span class="string">&#x27;Smith&#x27;</span> </span><br><span class="line">        <span class="keyword">AND</span> a.department_id <span class="operator">=</span> b.department_id;</span><br><span class="line">        </span><br><span class="line">#<span class="number">4.</span>        显示dept表格中，所在地为<span class="string">&#x27;NEW YORK&#x27;</span>的员工数据</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        e.employee_id,</span><br><span class="line">        e.last_name,</span><br><span class="line">        t.department_name,</span><br><span class="line">        t.city </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees e,</span><br><span class="line">        ( <span class="keyword">SELECT</span> department_id, department_name, city <span class="keyword">FROM</span> departments d, locations l <span class="keyword">WHERE</span> city <span class="operator">=</span> <span class="string">&#x27;NEW YORK&#x27;</span> <span class="keyword">AND</span> d.location_id <span class="operator">=</span> l.location_id ) t </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        e.department_id <span class="operator">=</span> t.department_id;</span><br><span class="line">        </span><br><span class="line">#<span class="number">5.</span>        显示主管<span class="string">&#x27;KING&#x27;</span>，直属员工资料</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        a.employee_id,</span><br><span class="line">        a.last_name </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees a,</span><br><span class="line">        employees b </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        a.manager_id <span class="operator">=</span> b.employee_id </span><br><span class="line">        <span class="keyword">AND</span> <span class="built_in">upper</span>( b.last_name ) <span class="operator">=</span> <span class="string">&#x27;KING&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">#<span class="number">6.</span>        列出员工名字、职称及薪水及其管理者名字、职称及薪水数据</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        a.last_name,</span><br><span class="line">        a.job_id,</span><br><span class="line">        a.salary,</span><br><span class="line">        b.last_name &quot;MANAGER_NAME&quot;,</span><br><span class="line">        b.job_id &quot;MANAGER_JOB_ID&quot;,</span><br><span class="line">        b.salary &quot;MANAGER_SALARY&quot; </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees a,</span><br><span class="line">        employees b </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        a.manager_id <span class="operator">=</span> b.employee_id;</span><br><span class="line">        </span><br><span class="line">#<span class="number">7.</span>        同习题六范例，并依照所属部门代码及员工薪水由大至小排列</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        a.last_name,</span><br><span class="line">        a.job_id,</span><br><span class="line">        a.salary,</span><br><span class="line">        b.last_name &quot;MANAGER_NAME&quot;,</span><br><span class="line">        b.job_id &quot;MANAGER_JOB_ID&quot;,</span><br><span class="line">        b.salary &quot;MANAGER_SALARY&quot; </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees a,</span><br><span class="line">        employees b </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        a.manager_id <span class="operator">=</span> b.employee_id </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">        a.department_id,</span><br><span class="line">        a.salary <span class="keyword">DESC</span> </span><br><span class="line">        </span><br><span class="line">#<span class="number">8.</span>        找出雇用日期早于其管理者雇用日期的员工数据，显示字段包含员工姓名、雇用日期及其管理者姓名、雇用日期</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        a.last_name,</span><br><span class="line">        a.hire_date,</span><br><span class="line">        b.last_name &quot;MANAGER_NAME&quot;,</span><br><span class="line">        b.hire_date &quot;MANAGER_HIRE_DATE&quot; </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees a,</span><br><span class="line">        employees b </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        a.manager_id <span class="operator">=</span> b.employee_id </span><br><span class="line">        <span class="keyword">AND</span> a.hire_date <span class="operator">&lt;</span> b.hire_date;</span><br><span class="line">        </span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<h2 id="lab-5"><a href="#lab-5" class="headerlink" title="lab 5"></a>lab 5</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. 计算所有员工总数、薪水最低、薪水最高、薪水总和、平均薪水等数据</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        <span class="built_in">count</span>(<span class="operator">*</span>),</span><br><span class="line">        <span class="built_in">min</span>( salary ),</span><br><span class="line">        <span class="built_in">max</span>( salary ),</span><br><span class="line">        <span class="built_in">sum</span>( salary ),</span><br><span class="line">        <span class="built_in">avg</span>( salary ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees;</span><br><span class="line">        </span><br><span class="line"><span class="comment">-- 2. 依照部门人数由大至小排列</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        department_id,</span><br><span class="line">        <span class="built_in">count</span>(<span class="operator">*</span>),</span><br><span class="line">        <span class="built_in">min</span>( salary ),</span><br><span class="line">        <span class="built_in">max</span>( salary ),</span><br><span class="line">        <span class="built_in">sum</span>( salary ),</span><br><span class="line">        <span class="built_in">avg</span>( salary ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">        department_id </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">        <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">DESC</span>;</span><br><span class="line">        </span><br><span class="line"><span class="comment">-- 5. 计算各部门员工薪水最大与最小差额</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        department_id,</span><br><span class="line">        <span class="built_in">max</span>( salary )<span class="operator">-</span> <span class="built_in">min</span>( salary ) cha </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">        department_id;</span><br><span class="line">        </span><br><span class="line"><span class="comment">-- 6. 找出部门员工总数大于等于5，且平均薪水大于$2000的员工数据，显示部门代码、部门员工数、部门平均薪水数据</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        department_id,</span><br><span class="line">        num,</span><br><span class="line">        average </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        ( <span class="keyword">SELECT</span> department_id, <span class="built_in">count</span>(<span class="operator">*</span>) num, <span class="built_in">avg</span>( salary ) average <span class="keyword">FROM</span> employees <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id ) a </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">        num <span class="operator">&gt;=</span> <span class="number">5</span> </span><br><span class="line">        <span class="keyword">AND</span> average <span class="operator">&gt;</span> <span class="number">2000</span> </span><br><span class="line">        </span><br><span class="line"><span class="comment">-- 8. 计算员工数据表格中，各工作部门代号、工作类别薪水总和</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        department_id,</span><br><span class="line">        job_id,</span><br><span class="line">        <span class="built_in">sum</span>( salary ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">        department_id,</span><br><span class="line">        job_id;</span><br><span class="line"><span class="comment">-- ----end</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">        department_id,</span><br><span class="line">        job_id,</span><br><span class="line">        <span class="built_in">sum</span>( salary ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        employees </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">        department_id,</span><br><span class="line">        job_id <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span> </span><br><span class="line"><span class="comment">-- 9：select department_id,job_id,sum(salary) from employees group by department_id,job_id with rollup      </span></span><br><span class="line"><span class="comment">-- 10. 当部门小计时JOB字段显示&#x27;ALL JOB&#x27;，当总计时，detpno字段显示&#x27;ALL DEPT&#x27;及JOB字段显示&#x27;ALL JOB&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">CASE</span>        </span><br><span class="line">        <span class="keyword">WHEN</span></span><br><span class="line">                dep <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">                        <span class="string">&#x27;all dept&#x27;</span> <span class="keyword">ELSE</span> department_id </span><br><span class="line">                <span class="keyword">END</span> &quot;department_id&quot;,</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">WHEN</span> job <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="string">&#x27;all job&#x27;</span> <span class="keyword">ELSE</span> job_id </span><br><span class="line">        <span class="keyword">END</span> &quot;job_id&quot;,</span><br><span class="line">        sum_sa </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">        (</span><br><span class="line">        <span class="keyword">SELECT</span></span><br><span class="line">                department_id,</span><br><span class="line">                job_id,</span><br><span class="line">                <span class="built_in">sum</span>( salary ) sum_sa,</span><br><span class="line">                <span class="keyword">grouping</span> ( department_id ) dep,</span><br><span class="line">                <span class="keyword">grouping</span> ( job_id ) job </span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">                employees </span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">                department_id,</span><br><span class="line">        job_id <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span> </span><br><span class="line">        ) a;</span><br></pre></td></tr></table></figure>

<h2 id="lab-6"><a href="#lab-6" class="headerlink" title="lab 6"></a>lab 6</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span>        找出员工数据，其薪资低于部门代码为<span class="number">10</span>中最低薪员工</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> employees</span><br><span class="line"> <span class="keyword">where</span> salary <span class="operator">&lt;</span></span><br><span class="line">       (<span class="keyword">select</span> <span class="built_in">min</span>(salary) <span class="keyword">from</span> employees <span class="keyword">where</span> department_id <span class="operator">=</span> <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>        找出部门代码为<span class="number">10</span>及<span class="number">20</span>的员工数据</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employees <span class="keyword">where</span> department_id <span class="keyword">in</span> (<span class="number">10</span>,<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>        找出主管工作类别为<span class="string">&#x27;MANAGER&#x27;</span>之员工数据</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> employees</span><br><span class="line"> <span class="keyword">where</span> manager_id <span class="keyword">in</span> (<span class="keyword">select</span> employee_id</span><br><span class="line">                        <span class="keyword">from</span> employees a, jobs b</span><br><span class="line">                       <span class="keyword">where</span> a.job_id <span class="operator">=</span> b.job_id</span><br><span class="line">                         <span class="keyword">and</span> b.job_title <span class="keyword">like</span> <span class="string">&#x27;%Manager%&#x27;</span>);</span><br><span class="line">#<span class="number">4.</span>        找出属于部门代号<span class="number">10</span>及<span class="number">20</span>的员工，且薪水大于该部门平均薪水</span><br><span class="line"><span class="keyword">select</span> a.<span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> employees a,</span><br><span class="line">       (<span class="keyword">select</span> department_id, <span class="built_in">avg</span>(salary) average</span><br><span class="line">          <span class="keyword">from</span> employees</span><br><span class="line">         <span class="keyword">where</span> department_id <span class="keyword">in</span> (<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">         <span class="keyword">group</span> <span class="keyword">by</span> department_id) b</span><br><span class="line"> <span class="keyword">where</span> a.department_id <span class="operator">=</span> b.department_id <span class="keyword">and</span> salary<span class="operator">&gt;</span>average;</span><br><span class="line"> </span><br><span class="line"> #<span class="number">5.</span>        使用子查询于<span class="keyword">FROM</span>子句方式，找出主管工作类别为<span class="string">&#x27;MANAGER&#x27;</span>的员工数据</span><br><span class="line"> <span class="keyword">select</span> a.<span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> employees a,</span><br><span class="line">       (<span class="keyword">select</span> a.<span class="operator">*</span></span><br><span class="line">          <span class="keyword">from</span> employees a, jobs b</span><br><span class="line">         <span class="keyword">where</span> a.job_id <span class="operator">=</span> b.job_id</span><br><span class="line">           <span class="keyword">and</span> b.job_title <span class="keyword">like</span> <span class="string">&#x27;%Manager%&#x27;</span>) b</span><br><span class="line"> <span class="keyword">where</span> a.manager_id <span class="operator">=</span> b.employee_id;</span><br><span class="line"> </span><br><span class="line"> #<span class="number">6.</span>        使用子查询于<span class="keyword">Select</span>子句，找出员工数据及其主管名字</span><br><span class="line"> <span class="keyword">select</span> a.<span class="operator">*</span>,(<span class="keyword">select</span> b.last_name <span class="keyword">from</span> employees b <span class="keyword">where</span> a.manager_id <span class="operator">=</span> b.employee_id ) <span class="keyword">as</span> manager_name <span class="keyword">from</span> employees a</span><br><span class="line"> </span><br><span class="line"> #<span class="number">7.</span>        使用<span class="keyword">Exists</span>子句找出主管工作类别为<span class="string">&#x27;MANAGER&#x27;</span>的员工数据</span><br><span class="line"> <span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> employees c</span><br><span class="line"> <span class="keyword">where</span> <span class="keyword">exists</span> (<span class="keyword">select</span> employee_id</span><br><span class="line">          <span class="keyword">from</span> employees a, jobs b</span><br><span class="line">         <span class="keyword">where</span> a.job_id <span class="operator">=</span> b.job_id</span><br><span class="line">           <span class="keyword">and</span> b.job_title <span class="keyword">like</span> <span class="string">&#x27;%Manager%&#x27;</span></span><br><span class="line">           <span class="keyword">and</span> c.manager_id <span class="operator">=</span> a.employee_id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#<span class="number">8.</span>        同上例，找出主管工作类型不为<span class="string">&#x27;MANAGER&#x27;</span>的员工数据</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> employees c</span><br><span class="line"> <span class="keyword">where</span> <span class="keyword">exists</span> (<span class="keyword">select</span> employee_id</span><br><span class="line">          <span class="keyword">from</span> employees a, jobs b</span><br><span class="line">         <span class="keyword">where</span> a.job_id <span class="operator">=</span> b.job_id</span><br><span class="line">           <span class="keyword">and</span> b.job_title <span class="keyword">not</span> <span class="keyword">like</span> <span class="string">&#x27;%Manager%&#x27;</span></span><br><span class="line">           <span class="keyword">and</span> c.manager_id <span class="operator">=</span> a.employee_id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- -----------------------------------------</span></span><br><span class="line"></span><br><span class="line">#<span class="number">1.</span>        由emp表格中，找出为主管的数据 ，此为主管数据</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SELECT DISTINCT mag.EMPLOYEE_ID from employees emp LEFT JOIN  employees mag ON emp.MANAGER_ID = mag.EMPLOYEE_ID</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employees <span class="keyword">where</span> employee_id <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> manager_id <span class="keyword">from</span> employees )</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>        由emp表格中，找出部门为<span class="number">30</span>，此为业务部门数据</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employees a <span class="keyword">where</span> a.department_id<span class="operator">=</span><span class="number">30</span></span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>        透过范例一及范例二所得的数据，找出为业务部门或为主管数据</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> employees</span><br><span class="line"> <span class="keyword">where</span> employee_id <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> manager_id <span class="keyword">from</span> employees)</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employees a <span class="keyword">where</span> a.department_id <span class="operator">=</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#<span class="number">4.</span>        透过范例一及范例二所得的数据，找出为业务部门且为主管数据</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> employees</span><br><span class="line"> <span class="keyword">where</span> employee_id <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> manager_id <span class="keyword">from</span> employees)</span><br><span class="line"><span class="keyword">intersect</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employees a <span class="keyword">where</span> a.department_id <span class="operator">=</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line">#<span class="number">5.</span>        透过范例一及范例二所得的数据，找出为主管但不为业务部门数据</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> employees</span><br><span class="line"> <span class="keyword">where</span> employee_id <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> manager_id <span class="keyword">from</span> employees)</span><br><span class="line">minus</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employees a <span class="keyword">where</span> a.department_id <span class="operator">=</span> <span class="number">30</span></span><br></pre></td></tr></table></figure>

<h2 id="lab-8"><a href="#lab-8" class="headerlink" title="lab 8"></a>lab 8</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-----------Lab 8：如何操作数据-----------</span></span><br><span class="line"><span class="number">1.</span>        将员工<span class="string">&#x27;CLARK&#x27;</span>数据重新写一笔于emp表格中(其中empno修改为<span class="number">8000</span>、deptno 修改为<span class="number">20</span>)</span><br><span class="line"><span class="keyword">update</span> employees <span class="keyword">set</span> employee_id<span class="operator">=</span><span class="number">8000</span>,department_id<span class="operator">=</span><span class="number">20</span> <span class="keyword">where</span> <span class="built_in">upper</span>(last_name) <span class="keyword">like</span> <span class="string">&#x27;%CLARK%&#x27;</span></span><br><span class="line"><span class="number">2.</span>        工作职称为<span class="string">&#x27;MANAGER&#x27;</span>的员工加薪<span class="number">1.5</span>倍</span><br><span class="line"><span class="keyword">update</span> employees</span><br><span class="line">   <span class="keyword">set</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.5</span></span><br><span class="line"> <span class="keyword">where</span> employee_id <span class="keyword">in</span> (<span class="keyword">select</span> employee_id</span><br><span class="line">                         <span class="keyword">from</span> employees a, jobs b</span><br><span class="line">                        <span class="keyword">where</span> a.job_id <span class="operator">=</span> b.job_id</span><br><span class="line">                          <span class="keyword">and</span> b.job_title <span class="keyword">like</span> <span class="string">&#x27;%Manager%&#x27;</span>)</span><br><span class="line"><span class="number">3.</span>        工作职称为<span class="string">&#x27;CLARK&#x27;</span>的员工，薪水修正为所有员工的平均薪水</span><br><span class="line"><span class="keyword">update</span> employees</span><br><span class="line">   <span class="keyword">set</span> salary <span class="operator">=</span> <span class="built_in">avg</span>(salary)</span><br><span class="line"> <span class="keyword">where</span> employee_id <span class="keyword">in</span> (<span class="keyword">select</span> employee_id</span><br><span class="line">                         <span class="keyword">from</span> employees a, jobs b</span><br><span class="line">                        <span class="keyword">where</span> a.job_id <span class="operator">=</span> b.job_id</span><br><span class="line">                          <span class="keyword">and</span> <span class="built_in">upper</span>(b.job_title) <span class="keyword">like</span> <span class="string">&#x27;%CLARK%&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="SQL-思考："><a href="#SQL-思考：" class="headerlink" title="SQL 思考："></a>SQL 思考：</h1><p><strong>A)  BETWEEN AND 对比 &lt;&#x3D; and &gt;&#x3D;</strong></p>
<ul>
<li><p>相同点</p>
<ul>
<li>两者在mysql中都包括端点</li>
<li>两者在mysql中都可以比较整型或字符串</li>
</ul>
</li>
<li><p>不同点</p>
<ul>
<li><p>BETWEEN AND 使用时需要注意顺序，&lt;&#x3D; and &gt;&#x3D;比较灵活</p>
</li>
<li><p>BETWEEN AND 使用更加简洁</p>
</li>
</ul>
</li>
</ul>
<p>​    <strong>B) ORDER BY 执行时机</strong></p>
<p>​	ORDER BY 在查询语句最后、分页之前（若分页）对结果进行排序。</p>
<p>​	<strong>C) ORDER BY 多列顺序对结果影响</strong></p>
<p>​	ORDER BY 会按照比较的字段顺序对结果进行排序，若有多个条件，先按条件一进行排序，在条件一相同的结果集中按照条件二进行排序，以此类推。</p>
<p><strong>D）日期为何能作计算</strong></p>
<p>日期底层或许是直接使用数值存储为yyyyMMddHHmmss的数据</p>
<h1 id="现在都有那些数据库，每种数据库的区别、应用场景、优点是什么"><a href="#现在都有那些数据库，每种数据库的区别、应用场景、优点是什么" class="headerlink" title="现在都有那些数据库，每种数据库的区别、应用场景、优点是什么"></a>现在都有那些数据库，每种数据库的区别、应用场景、优点是什么</h1><pre><code>   eg: 关系型、文档型、内存型、分布式....
       Mysql Oracle 达梦 Hbase...
</code></pre>
<ul>
<li><p>类型</p>
<ul>
<li>关系型数据库<ul>
<li>如MYSQL，Oracle，SQL Server，SQLite，达梦等</li>
</ul>
</li>
<li>非关系型数据库<ul>
<li>键值型：如redis</li>
<li>文档型：如MongoDB</li>
<li>列式数据库：如HBase</li>
<li>图形数据库：如NEo4J</li>
</ul>
</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li><p>关系型数据库</p>
<p>优点</p>
<ul>
<li>保持数据的一致性</li>
<li>容易理解，接近人的思考方式</li>
<li>SQL语言方便使用</li>
</ul>
<p>缺点</p>
<ul>
<li>由于其需要维护一致性导致其读写性能比较差</li>
<li>当字段不固定时，关系型数据库处理麻烦</li>
<li>在进行大量数据的写入时效率较差</li>
</ul>
</li>
<li><p>非关系型数据库</p>
<p>优点</p>
<ul>
<li>适合处理高并发、大批量的数据</li>
<li>支持分布式集群，负载均衡，效率较高</li>
<li>扩展简单</li>
<li>成本低廉</li>
</ul>
<p>缺点</p>
<ul>
<li>技术起步晚，相关资料有限</li>
<li>事务处理能力弱</li>
<li>无法保证数据的完整性和安全性</li>
</ul>
</li>
</ul>
</li>
<li><p>应用场景：</p>
<ul>
<li>关系型数据库<ul>
<li>处理复杂、数据量相对较少、安全性要求较高、数据格式单一的场景</li>
</ul>
</li>
<li>非关系型数据库<ul>
<li>海量数据、多格式数据存储，对查询速度要求快的场景</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="了解Mysql-SQL解析器、存储结构、索引结构相关知识"><a href="#了解Mysql-SQL解析器、存储结构、索引结构相关知识" class="headerlink" title="了解Mysql SQL解析器、存储结构、索引结构相关知识"></a>了解Mysql SQL解析器、存储结构、索引结构相关知识</h1><ul>
<li><p>SQL解析器</p>
<p>通过词法分析和语法分析将sql语句进行解析并生成语法树</p>
</li>
<li><p>存储结构</p>
<p>MySQL 5.5 版本以后，默认存储引擎由 MyISAM 修改为 InnoDB。InnoDB采取页的方式，作为磁盘和内存之间交互的基本单位，一个页的大小一般是16KB，一次数据读取会把整页都读取到内存中，再从内存中读取目标数据；</p>
<p><img src="/2023/03/31/%E7%AC%94%E8%AE%B0/sql/sql/image-20220726185513420.png" alt="image-20220726185513420"></p>
<p><img src="/2023/03/31/%E7%AC%94%E8%AE%B0/sql/sql/image-20220726185532894.png" alt="image-20220726185532894"></p>
</li>
<li><p>索引结构</p>
<p>mysql索引的数据结构是树，常用的存储引擎innodb采用的是B+Tree。</p>
</li>
</ul>
<h1 id="DML-x2F-DDL-x2F-DCL：基础用法掌握。"><a href="#DML-x2F-DDL-x2F-DCL：基础用法掌握。" class="headerlink" title="DML&#x2F;DDL&#x2F;DCL：基础用法掌握。"></a>DML&#x2F;DDL&#x2F;DCL：基础用法掌握。</h1><p>​    eg: 给用户A添加数据库B中的表C的查询权限，DCL语句该怎么写？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">select</span> <span class="keyword">ON</span> B.C <span class="keyword">TO</span> <span class="string">&#x27;A&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h1 id="基础查询部分："><a href="#基础查询部分：" class="headerlink" title="基础查询部分："></a>基础查询部分：</h1><p>​    </p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hoxis/p/10006871.html#3-%E8%A7%A3%E6%9E%90%E5%99%A8">MySQL实战 | 01-当执行一条 select 语句时，MySQL 到底做了啥？ - hoxis - 博客园 (cnblogs.com)</a></p>
<p>思考题：一条SQL查询语句是如何执行的<br>    问题：如果表 T 中没有字段 k，而你执行了这个语句 select * from T where k&#x3D;1,<br>     那肯定是会报“不存在这个列”的错误： “Unknown column ‘k’ in ‘where clause’”<br>     这个错误是在上面提到的哪个阶段报出来的呢？</p>
<p>​	答： 在分析器阶段发现该错误 </p>
<h1 id="MySQL常用函数学习"><a href="#MySQL常用函数学习" class="headerlink" title="MySQL常用函数学习"></a>MySQL常用函数学习</h1><p>测试数据：</p>
<p><img src="/2023/03/31/%E7%AC%94%E8%AE%B0/sql/sql/image-20220726185549243.png" alt="image-20220726185549243"></p>
<ul>
<li>大小写控制函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,`name`,sex, <span class="built_in">LOWER</span>(`name`), <span class="built_in">UPPER</span>(sex) <span class="keyword">from</span> test_table ;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2023/03/31/%E7%AC%94%E8%AE%B0/sql/sql/image-20220726185614087.png" alt="image-20220726185614087"></p>
<ul>
<li>字符控制函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 连接字符串</span><br><span class="line"><span class="keyword">select</span> id,`name`,sex, CONCAT(id,<span class="string">&#x27; : &#x27;</span>,`name`,<span class="string">&#x27;-&#x27;</span>,sex) <span class="string">&#x27;concat&#x27;</span> <span class="keyword">from</span> test_table ;</span><br><span class="line"># 连接字符串,截取字符串</span><br><span class="line"><span class="keyword">select</span> `name`, <span class="built_in">UPPER</span>(substr(sex,<span class="number">1</span>,<span class="number">1</span>)) <span class="keyword">from</span> test_table ;</span><br><span class="line"># 获得字符串长度</span><br><span class="line"><span class="keyword">select</span> `name`,LENGTH(`name`) name_length <span class="keyword">from</span> test_table;</span><br><span class="line"># 获取字符所在位置</span><br><span class="line"><span class="keyword">select</span> `name`,INSTR(sex,<span class="string">&#x27;m&#x27;</span>) <span class="keyword">from</span> test_table;</span><br><span class="line"># 字符串左右填充</span><br><span class="line"><span class="keyword">select</span> `name`,RPAD(LPAD(`name`,<span class="number">10</span>,<span class="string">&#x27;-&#x27;</span>),<span class="number">15</span>,<span class="string">&#x27;-&#x27;</span>) <span class="keyword">from</span> test_table;</span><br><span class="line"># 去除左右任意个数指定字符</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">TRIM</span>(<span class="string">&#x27;a&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;aabaca&#x27;</span>);</span><br><span class="line"># 替换字符</span><br><span class="line"><span class="keyword">select</span> REPLACE(sex,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">FROM</span> test_table;</span><br></pre></td></tr></table></figure>

<ul>
<li>数字函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 四舍五入取整</span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">16.5</span>);</span><br><span class="line"># 四舍五入指定保留小数位数</span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">16.12348765</span>, <span class="number">4</span>);</span><br><span class="line"># 指定保留小数位数截断</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">12.234</span>,<span class="number">2</span>);</span><br><span class="line"># 取余</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">100</span>,<span class="number">33</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>日期函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 获取当前时间</span><br><span class="line"><span class="keyword">SELECT</span> NOW();</span><br><span class="line"># 字符串转为时间，非法日期结果为空</span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;1-13-1999&#x27;</span>,<span class="string">&#x27;%m-%d-%Y&#x27;</span>);</span><br><span class="line"># 时间转换为字符串</span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(),<span class="string">&#x27;%Y年%m月&#x27;</span>);</span><br></pre></td></tr></table></figure>



<ul>
<li>条件表达式</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 第一种用法，<span class="keyword">case</span>后无表达式，<span class="keyword">when</span>中加条件</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> </span><br><span class="line">	<span class="keyword">WHEN</span> SUBSTR(NOW(),<span class="number">6</span>,<span class="number">2</span>) <span class="keyword">in</span> (<span class="string">&#x27;01&#x27;</span>,<span class="string">&#x27;03&#x27;</span>,<span class="string">&#x27;05&#x27;</span>,<span class="string">&#x27;07&#x27;</span>,<span class="string">&#x27;08&#x27;</span>,<span class="string">&#x27;10&#x27;</span>,<span class="string">&#x27;12&#x27;</span>)  <span class="keyword">THEN</span> <span class="number">31</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">WHEN</span> SUBSTR(NOW(),<span class="number">6</span>,<span class="number">2</span>) <span class="keyword">in</span> (<span class="string">&#x27;04&#x27;</span>,<span class="string">&#x27;06&#x27;</span>,<span class="string">&#x27;09&#x27;</span>,<span class="string">&#x27;11&#x27;</span>)  <span class="keyword">THEN</span> <span class="number">30</span></span><br><span class="line">	</span><br><span class="line">	# 闰年判断</span><br><span class="line">	<span class="keyword">WHEN</span> ((<span class="built_in">MOD</span>(SUBSTR(NOW(),<span class="number">1</span>,<span class="number">4</span>),<span class="number">4</span>) <span class="operator">=</span> <span class="number">0</span> <span class="keyword">AND</span> <span class="built_in">MOD</span>(SUBSTR(NOW(),<span class="number">1</span>,<span class="number">4</span>),<span class="number">100</span>) <span class="operator">&lt;&gt;</span> <span class="number">0</span>) <span class="keyword">OR</span> <span class="built_in">MOD</span>(SUBSTR(NOW(),<span class="number">1</span>,<span class="number">4</span>),<span class="number">400</span>) <span class="operator">=</span> <span class="number">0</span>) <span class="keyword">AND</span></span><br><span class="line">SUBSTR(NOW(),<span class="number">6</span>,<span class="number">2</span>) <span class="operator">=</span> <span class="string">&#x27;02&#x27;</span>  <span class="keyword">THEN</span> <span class="number">28</span></span><br><span class="line">	# 以上都不满足则为非闰年<span class="number">2</span>月</span><br><span class="line">	<span class="keyword">ELSE</span> <span class="number">29</span></span><br><span class="line"><span class="keyword">END</span> <span class="string">&#x27;day&#x27;</span>;</span><br><span class="line"># 第二种用法，<span class="keyword">case</span>后加表达式，<span class="keyword">when</span>比较值</span><br><span class="line"><span class="keyword">CASE</span> expr</span><br><span class="line">	<span class="keyword">WHEN</span> <span class="string">&#x27;x&#x27;</span> <span class="keyword">THEN</span> ...</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">else</span> ...</span><br><span class="line"><span class="keyword">END</span> 字段名</span><br></pre></td></tr></table></figure>

<h1 id="去重DISTINCT"><a href="#去重DISTINCT" class="headerlink" title="去重DISTINCT"></a>去重DISTINCT</h1><h1 id="LIKE-x2F-NOT-LIKE"><a href="#LIKE-x2F-NOT-LIKE" class="headerlink" title="LIKE&#x2F;NOT LIKE"></a>LIKE&#x2F;NOT LIKE</h1><h1 id="IN-x2F-EXISTS"><a href="#IN-x2F-EXISTS" class="headerlink" title="IN&#x2F;EXISTS"></a>IN&#x2F;EXISTS</h1><p>IN是做外表和内表通过Hash连接，先查询子表，再查询主表，不管子查询是否有数据，都对子查询进行全部匹配。<br>EXISTS是外表做loop循环，先主查询，再子查询，然后去子查询中匹配，如果匹配到就退出子查询返回true，将结果放到结果集<br>所以：子查询结果集越大用EXISTS，子查询结果集越小用IN</p>
<h1 id="内连接-x2F-全连接-x2F-左右连接、子查询"><a href="#内连接-x2F-全连接-x2F-左右连接、子查询" class="headerlink" title="内连接&#x2F;全连接&#x2F;左右连接、子查询"></a>内连接&#x2F;全连接&#x2F;左右连接、子查询</h1><ul>
<li><p>基本概念</p>
<ul>
<li><p>内连接</p>
<p>只有两个表同时满足连接条件时会保留</p>
</li>
<li><p>左外连接</p>
<ul>
<li>保留左边表中所有记录,右边表中不满足以空代替</li>
</ul>
</li>
<li><p>右外连接</p>
<ul>
<li>与左外连接相反</li>
</ul>
</li>
</ul>
</li>
<li><p>内连接</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span>	列出emp表格及dept表格，结合后所有可能排列组合</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments;</span><br></pre></td></tr></table></figure>



<ul>
<li>左&#x2F;右外连接</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2.</span>	显示LastName是<span class="string">&#x27;SMITH&#x27;</span>及其所属部门资料</span><br><span class="line"><span class="keyword">SELECT</span> employees.EMPLOYEE_ID,employees.LAST_NAME, departments.<span class="operator">*</span> <span class="keyword">from</span> employees <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments <span class="keyword">ON</span> employees.DEPARTMENT_ID <span class="operator">=</span> departments.DEPARTMENT_ID <span class="keyword">WHERE</span> employees.LAST_NAME <span class="operator">=</span> <span class="string">&#x27;SMITH&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>别名</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3.</span>	显示<span class="string">&#x27;SMITH&#x27;</span>员工及其所属部门数据(使用表格别名的方式，表格emp别名为a、表格dept别名为b)</span><br><span class="line"><span class="keyword">SELECT</span> a.EMPLOYEE_ID,a.LAST_NAME, b.<span class="operator">*</span> <span class="keyword">from</span> employees a <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments b <span class="keyword">ON</span> a.DEPARTMENT_ID <span class="operator">=</span> b.DEPARTMENT_ID <span class="keyword">WHERE</span> a.LAST_NAME <span class="operator">=</span> <span class="string">&#x27;SMITH&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>子查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">6.</span>	列出员工名字、职称及薪水及其管理者名字、职称及薪水数据</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">a.FIRST_NAME emp_first_name,a.LAST_NAME emp_last_name,a.JOB_TITLE emp_job_title, a.SALARY emp_salary,</span><br><span class="line">b.FIRST_NAME mng_first_name,b.LAST_NAME mng_last_name,b.JOB_TITLE mng_job_title, b.SALARY mng_salary </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"># 两个小表</span><br><span class="line">	(<span class="keyword">SELECT</span> FIRST_NAME,LAST_NAME,JOB_TITLE,SALARY,MANAGER_ID <span class="keyword">FROM</span> employees e,jobs j <span class="keyword">WHERE</span> e.JOB_ID <span class="operator">=</span> j.JOB_ID) <span class="keyword">as</span> a,</span><br><span class="line">	(<span class="keyword">SELECT</span> FIRST_NAME,LAST_NAME,JOB_TITLE,SALARY,EMPLOYEE_ID <span class="keyword">FROM</span> employees e,jobs j <span class="keyword">WHERE</span> e.JOB_ID <span class="operator">=</span> j.JOB_ID) <span class="keyword">as</span> b</span><br><span class="line"><span class="keyword">WHERE</span> a.MANAGER_ID <span class="operator">=</span> b.EMPLOYEE_ID;</span><br><span class="line"># 员工包含‘KING’</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">a.FIRST_NAME emp_first_name,a.LAST_NAME emp_last_name,a.JOB_TITLE emp_job_title, a.SALARY emp_salary,</span><br><span class="line">b.FIRST_NAME mng_first_name,b.LAST_NAME mng_last_name,b.JOB_TITLE mng_job_title, b.SALARY mng_salary </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"># 两个小表</span><br><span class="line">	(<span class="keyword">SELECT</span> FIRST_NAME,LAST_NAME,JOB_TITLE,SALARY,MANAGER_ID <span class="keyword">FROM</span> employees e,jobs j <span class="keyword">WHERE</span> e.JOB_ID <span class="operator">=</span> j.JOB_ID) <span class="keyword">as</span> a</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">	(<span class="keyword">SELECT</span> FIRST_NAME,LAST_NAME,JOB_TITLE,SALARY,EMPLOYEE_ID <span class="keyword">FROM</span> employees e,jobs j <span class="keyword">WHERE</span> e.JOB_ID <span class="operator">=</span> j.JOB_ID) <span class="keyword">as</span> b</span><br><span class="line"><span class="keyword">ON</span> a.MANAGER_ID <span class="operator">=</span> b.EMPLOYEE_ID;</span><br></pre></td></tr></table></figure>

<h2 id="子查询-1"><a href="#子查询-1" class="headerlink" title="子查询"></a>子查询</h2><p>查询出来的结果作为新表或者作为一个值在别的查询中使用</p>
<ul>
<li>简单子查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span>	找出员工数据:其薪资低于部门代码为<span class="number">10</span>中最低薪员工</span><br><span class="line"><span class="comment">-- 找出部门代码为10的部门中的最低薪资</span></span><br><span class="line"><span class="comment">-- 找出薪资低于部门10中最低薪资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="operator">*</span> <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.SALARY <span class="operator">&lt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(e.SALARY) <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.DEPARTMENT_ID <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">);</span><br><span class="line"># <span class="number">3.</span>	找出主管工作类别为<span class="string">&#x27;MANAGER&#x27;</span>员工数据</span><br><span class="line"><span class="comment">-- jobs表中找出job_title中包含&#x27;MANAGER&#x27;的job_id</span></span><br><span class="line"><span class="comment">-- emp表中找出job_id在以上结果集中的员工id</span></span><br><span class="line"><span class="comment">-- emp表中找出manager_id在以上结果集中的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> MANAGER_ID <span class="keyword">IN</span>	(</span><br><span class="line">	<span class="keyword">SELECT</span> EMPLOYEE_ID <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> JOB_ID <span class="keyword">IN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> JOB_ID <span class="keyword">FROM</span> jobs <span class="keyword">WHERE</span> JOB_TITLE <span class="keyword">LIKE</span> <span class="string">&#x27;%MANAGER%&#x27;</span></span><br><span class="line">	)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>UNION 合并两个表并去除重复的记录(只保留一个),要求两个表列数相同<ul>
<li>UNION ALL 合并两个表并保留重复记录</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">4.</span>	找出属于部门代号<span class="number">10</span>及<span class="number">20</span>的员工，且薪水大于该部门平均薪水</span><br><span class="line"><span class="comment">-- 查出两张表来连接,一张查部门号为10,一张查部门号为20</span></span><br><span class="line"><span class="keyword">SELECT</span> EMPLOYEE_ID,SALARY <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> SALARY <span class="operator">&gt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(SALARY) <span class="keyword">FROM</span> employees <span class="keyword">GROUP</span> <span class="keyword">BY</span> DEPARTMENT_ID <span class="keyword">HAVING</span> DEPARTMENT_ID <span class="operator">=</span> <span class="number">10</span> </span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> DEPARTMENT_ID <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="comment">-- UNION ALL 纵向连接表,要求列数相同</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> EMPLOYEE_ID,SALARY <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> SALARY <span class="operator">&gt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(SALARY) <span class="keyword">FROM</span> employees <span class="keyword">GROUP</span> <span class="keyword">BY</span> DEPARTMENT_ID <span class="keyword">HAVING</span> DEPARTMENT_ID <span class="operator">=</span> <span class="number">20</span> </span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> DEPARTMENT_ID <span class="operator">=</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>子查询于SELECT子句<ul>
<li>子查询跟在select之后,先执行外部查询,得到结果集后便利其代入子查询</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">6.</span>	使用子查询于<span class="keyword">Select</span>子句，找出员工数据及其主管名字</span><br><span class="line"><span class="comment">-- 这里的子查询跟在select之后,应该也是先执行外部查询,得到结果集后便利其代入子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> e1.<span class="operator">*</span>, (<span class="keyword">select</span> e2.FIRST_NAME <span class="keyword">from</span> employees e2 <span class="keyword">WHERE</span> e1.MANAGER_ID<span class="operator">=</span>e2.EMPLOYEE_ID) <span class="keyword">as</span> manager_name <span class="keyword">FROM</span> employees e1 <span class="keyword">ORDER</span> <span class="keyword">BY</span> e1.EMPLOYEE_ID;	</span><br></pre></td></tr></table></figure>

<ul>
<li>EXISTS 子查询<ul>
<li>EXISTS:结果存在为真,不存在为假<ul>
<li>1、 首先执行一次外部查询，并缓存结果集，如 SELECT * FROM A</li>
<li>2、遍历外部查询结果集的每一行记录R，代入子查询中作为条件进行查询，如 SELECT 1 FROM B WHERE B.id &#x3D; A.id</li>
<li>3、如果子查询有返回结果，则EXISTS子句返回TRUE，这一行R可作为外部查询的结果行，否则不能作为结果</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">7.</span>	使用<span class="keyword">Exists</span>子句找出主管工作类别为<span class="string">&#x27;MANAGER&#x27;</span>的员工数据</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> employees e1, employees e2</span><br><span class="line"><span class="keyword">WHERE</span> e1.MANAGER_ID <span class="operator">=</span> e2.EMPLOYEE_ID</span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line"><span class="keyword">EXISTS</span> (</span><br><span class="line"><span class="comment">-- 使用外部查询查出的每一条记录作为表在内部查询中比较,若内部查询中满足条件,保留该结果</span></span><br><span class="line"><span class="comment">-- 这里是查找该雇员的jobid所对应的jobtitle为manager的记录是否存在</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> jobs j <span class="keyword">WHERE</span> e2.JOB_ID <span class="operator">=</span> j.JOB_ID <span class="keyword">AND</span> j.JOB_TITLE <span class="keyword">LIKE</span> <span class="string">&#x27;%MANAGER%&#x27;</span> </span><br><span class="line">);</span><br><span class="line"># <span class="number">8.</span>	同上例，找出主管工作类型不为<span class="string">&#x27;MANAGER的员工数据&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="comment">-- 这里用左外连接,使用内连接会出现很多冗余</span></span><br><span class="line"><span class="keyword">FROM</span> employees e1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e2</span><br><span class="line"><span class="keyword">ON</span> e1.MANAGER_ID <span class="operator">=</span> e2.EMPLOYEE_ID</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> jobs j <span class="keyword">WHERE</span> e2.JOB_ID <span class="operator">=</span> j.JOB_ID <span class="keyword">AND</span> j.JOB_TITLE <span class="keyword">LIKE</span> <span class="string">&#x27;%MANAGER%&#x27;</span> </span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 补充主管为null的员工数据</span></span><br><span class="line"><span class="keyword">OR</span> e1.MANAGER_ID <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> e1.EMPLOYEE_ID</span><br><span class="line">;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="TRUNCATE关键字"><a href="#TRUNCATE关键字" class="headerlink" title="TRUNCATE关键字"></a>TRUNCATE关键字</h1><p>truncate的作用是清空表或者说是截断表，只能作用于表。truncate的语法很简单，后面直接跟表名即可，例如： truncate table tbl_name 或者 truncate tbl_name 。</p>
<p>执行truncate语句需要拥有表的drop权限，从逻辑上讲，truncate table类似于delete删除所有行的语句或drop table然后再create table语句的组合。为了实现高性能，它绕过了删除数据的DML方法，因此，它不能回滚。尽管truncate table与delete相似，但它被分类为DDL语句而不是DML语句。</p>
<h1 id="虚拟表DUAL"><a href="#虚拟表DUAL" class="headerlink" title="虚拟表DUAL"></a>虚拟表DUAL</h1><p> 可以当一个表使用,mysql中可以查询多条</p>
<h1 id="连表查询：区别-x2F-使用场景-x2F-联表限制-amp-技巧-x2F-全连接Where和On的区别"><a href="#连表查询：区别-x2F-使用场景-x2F-联表限制-amp-技巧-x2F-全连接Where和On的区别" class="headerlink" title="连表查询：区别&#x2F;使用场景&#x2F;联表限制&amp;技巧&#x2F;全连接Where和On的区别"></a>连表查询：区别&#x2F;使用场景&#x2F;联表限制&amp;技巧&#x2F;全连接Where和On的区别</h1><p>在使用left jion时，on和where条件的区别如下：<br>1、 on条件是在生成临时表时使用的条件，它不管on中的条件是否为真，都会返回左边表中的记录。<br>2、where条件是在临时表生成好后，再对临时表进行过滤的条件。这时已经没有left join的含义（必须返回左边表的记录）了，条件不为真的就全部过滤掉。</p>
<h1 id="WITH-ROLLUP及其他关键字-x2F-新特性了解。"><a href="#WITH-ROLLUP及其他关键字-x2F-新特性了解。" class="headerlink" title="WITH ROLLUP及其他关键字&#x2F;新特性了解。"></a>WITH ROLLUP及其他关键字&#x2F;新特性了解。</h1><p>ROLLUP 分层计算综合，GROUP BY a1, a2 …. an:先计算以an分组的总和，最后计算a1的总和</p>
<h1 id="一些练习sql"><a href="#一些练习sql" class="headerlink" title="一些练习sql"></a>一些练习sql</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span> 查询 <span class="number">01</span> 课程比 <span class="number">02</span> 课程成绩高的学生的信息及课程分数</span><br><span class="line"><span class="comment">-- 联表目的：一行记录中包括s1的分数与s2的分数</span></span><br><span class="line"><span class="keyword">SELECT</span> s.s_id, s.s_name, s.s_birth, s.s_sex, sc1.s_score sc1_score,sc2.s_score sc2_score</span><br><span class="line"><span class="keyword">FROM</span> student s </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc1 <span class="keyword">ON</span> sc1.s_id <span class="operator">=</span> s.s_id <span class="keyword">AND</span> sc1.c_id <span class="operator">=</span> <span class="number">01</span></span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc2 <span class="keyword">ON</span> sc2.s_id <span class="operator">=</span> s.s_id <span class="keyword">AND</span> sc2.c_id <span class="operator">=</span> <span class="number">02</span></span><br><span class="line"><span class="keyword">WHERE</span> sc2.s_score <span class="operator">&lt;</span> sc1.s_score;</span><br><span class="line"></span><br><span class="line"># <span class="number">2.</span> 查询 <span class="number">01</span> 课程比 <span class="number">02</span> 课程成绩高的学生的信息及课程分数</span><br><span class="line"><span class="keyword">SELECT</span> s.s_id, s.s_name, s.s_birth, s.s_sex, sc1.s_score sc1_score,sc2.s_score sc2_score</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc1 <span class="keyword">ON</span> sc1.s_id <span class="operator">=</span> s.s_id <span class="keyword">AND</span> sc1.c_id <span class="operator">=</span> <span class="number">01</span></span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc2 <span class="keyword">ON</span> sc2.s_id <span class="operator">=</span> s.s_id <span class="keyword">AND</span> sc2.c_id <span class="operator">=</span> <span class="number">02</span></span><br><span class="line"><span class="keyword">WHERE</span> sc2.s_score <span class="operator">&gt;</span> sc1.s_score;</span><br><span class="line"></span><br><span class="line"># <span class="number">3.</span> 查询平均成绩大于等于 <span class="number">60</span> 分的同学的学生编号和学生姓名和平均成绩</span><br><span class="line"><span class="keyword">SELECT</span> s.s_id,s.s_name, <span class="built_in">AVG</span>(sc.s_score) avg_score</span><br><span class="line"><span class="keyword">FROM</span> student s </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> sc.s_id <span class="operator">=</span> s.s_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.s_id</span><br><span class="line"><span class="keyword">HAVING</span> avg_score <span class="operator">&gt;</span> <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">4.</span> 查询平均成绩小于 <span class="number">60</span> 分的同学的学生编号和学生姓名和平均成绩，包括有成绩的和无成绩的</span><br><span class="line"><span class="keyword">SELECT</span> s.s_id,s.s_name, <span class="built_in">AVG</span>(sc.s_score) avg_score</span><br><span class="line"><span class="keyword">FROM</span> student s </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> sc.s_id <span class="operator">=</span> s.s_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.s_id</span><br><span class="line"><span class="keyword">HAVING</span> avg_score <span class="operator">&lt;</span> <span class="number">60</span> <span class="keyword">OR</span> avg_score <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">5.</span> 查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩</span><br><span class="line"><span class="keyword">SELECT</span> s.s_id, s.s_name, <span class="built_in">COUNT</span>(sc.c_id) count_course, <span class="built_in">SUM</span>(sc.s_score)</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> sc.s_id <span class="operator">=</span> s.s_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> s.s_id;</span><br><span class="line"></span><br><span class="line"># <span class="number">6.</span> 查询 “李” 姓老师的数量</span><br><span class="line"><span class="comment">-- 聚合函数什么时候执行？</span></span><br><span class="line"><span class="comment">-- 这里可以count（1）来得到组内的记录数</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(t.t_name,<span class="number">1</span>,<span class="number">1</span>) last_name,<span class="built_in">COUNT</span>(<span class="number">1</span>) flag </span><br><span class="line"><span class="keyword">FROM</span> teacher t </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> last_name </span><br><span class="line"><span class="keyword">HAVING</span> last_name <span class="operator">=</span> &quot;李&quot;;</span><br><span class="line"></span><br><span class="line"># <span class="number">7.</span> 查询学过张三老师授课的同学的信息</span><br><span class="line"><span class="comment">-- 子查询组合教师信息，课程信息，选课信息</span></span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span> s.s_id <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> s_id </span><br><span class="line">	<span class="keyword">FROM</span> teacher t </span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> course c <span class="keyword">ON</span> t.t_id <span class="operator">=</span> c.t_id</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> c.c_id <span class="operator">=</span> sc.c_id</span><br><span class="line">	<span class="keyword">WHERE</span> t.t_name <span class="operator">=</span> &quot;张三&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># <span class="number">8.</span> 找出没有学过张三老师课程的学生</span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span> s.s_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> s_id </span><br><span class="line">	<span class="keyword">FROM</span> teacher t </span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> course c <span class="keyword">ON</span> t.t_id <span class="operator">=</span> c.t_id</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> c.c_id <span class="operator">=</span> sc.c_id</span><br><span class="line">	<span class="keyword">WHERE</span> t.t_name <span class="operator">=</span> &quot;张三&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># <span class="number">9.</span> 查询学过编号为 <span class="number">01</span> ，并且学过编号为 <span class="number">02</span> 课程的学生信息</span><br><span class="line"><span class="comment">-- 与第一题类似</span></span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc1 <span class="keyword">ON</span> sc1.s_id <span class="operator">=</span> s.s_id <span class="keyword">AND</span> sc1.c_id <span class="operator">=</span> <span class="number">01</span></span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc2 <span class="keyword">ON</span> sc2.s_id <span class="operator">=</span> s.s_id <span class="keyword">AND</span> sc2.c_id <span class="operator">=</span> <span class="number">02</span></span><br><span class="line"><span class="keyword">WHERE</span> sc1.c_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> sc2.c_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">10.</span> 查询学过编号为 <span class="number">01</span> ，但是没有学过编号为 <span class="number">02</span> 课程的学生信息</span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc1 <span class="keyword">ON</span> sc1.s_id <span class="operator">=</span> s.s_id <span class="keyword">AND</span> sc1.c_id <span class="operator">=</span> <span class="number">01</span></span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc2 <span class="keyword">ON</span> sc2.s_id <span class="operator">=</span> s.s_id <span class="keyword">AND</span> sc2.c_id <span class="operator">=</span> <span class="number">02</span></span><br><span class="line"><span class="keyword">WHERE</span> sc1.c_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> sc2.c_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">11.</span> 查询没有学完全部课程的同学的信息</span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span> s.s_id <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> sc.s_id</span><br><span class="line">	<span class="keyword">FROM</span> score sc</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.s_id</span><br><span class="line">	<span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="operator">&lt;</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> course</span><br><span class="line">	)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># <span class="number">12.</span> 查询至少有一门课与（学号为<span class="number">01</span>的同学所学）相同的同学的信息</span><br><span class="line"><span class="comment">-- 查出学号为01的同学所学的课程的课程号</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span> s.s_id <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> sc.s_id</span><br><span class="line">	<span class="keyword">FROM</span> score sc</span><br><span class="line">	<span class="keyword">WHERE</span> sc.c_id <span class="keyword">IN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> sc.c_id </span><br><span class="line">		<span class="keyword">FROM</span> score sc</span><br><span class="line">		<span class="keyword">WHERE</span> sc.s_id <span class="operator">=</span> <span class="number">01</span></span><br><span class="line">	)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># <span class="number">13.</span> 查询和<span class="number">01</span>同学学习的课程完全相同的同学的信息</span><br><span class="line"><span class="comment">-- 取不相同的反</span></span><br><span class="line"><span class="comment">-- 不相同：</span></span><br><span class="line"><span class="comment">--		选课数量小于01的选课数量 的同学</span></span><br><span class="line"><span class="comment">--		选了01没选的课 的同学</span></span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> s.s_id <span class="operator">=</span> sc.s_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.s_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">count</span>(sc.c_id) <span class="operator">&lt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">count</span>(sc.c_id) count_course</span><br><span class="line">	<span class="keyword">FROM</span> student s</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> s.s_id <span class="operator">=</span> sc.s_id</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.s_id</span><br><span class="line">	<span class="keyword">HAVING</span> sc.s_id <span class="operator">=</span> <span class="number">01</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span> s.s_id <span class="keyword">NOT</span> <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> sc.s_id</span><br><span class="line">	<span class="keyword">FROM</span> score sc</span><br><span class="line">	<span class="keyword">WHERE</span> sc.c_id <span class="keyword">IN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> sc.c_id </span><br><span class="line">		<span class="keyword">FROM</span> score sc</span><br><span class="line">		<span class="keyword">WHERE</span> sc.s_id <span class="operator">=</span> <span class="number">01</span></span><br><span class="line">	)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># <span class="number">14.</span> 查询没有修过张三老师讲授的任何一门课程的学生姓名</span><br><span class="line"><span class="keyword">SELECT</span> s.s_name </span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span> s.s_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> s_id </span><br><span class="line">	<span class="keyword">FROM</span> teacher t </span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> course c <span class="keyword">ON</span> t.t_id <span class="operator">=</span> c.t_id</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> c.c_id <span class="operator">=</span> sc.c_id</span><br><span class="line">	<span class="keyword">WHERE</span> t.t_name <span class="operator">=</span> &quot;张三&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># <span class="number">15.</span> 查询两门及以上不及格课程的同学的学号，姓名及平均成绩</span><br><span class="line"><span class="keyword">SELECT</span> s.s_id, s.s_name, <span class="built_in">AVG</span>(sc.s_score)</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> s.s_id <span class="operator">=</span> sc.s_id</span><br><span class="line"><span class="keyword">WHERE</span> sc.s_score <span class="operator">&lt;</span> <span class="number">60</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> s_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">16.</span> 检索<span class="number">01</span>课程分数小于<span class="number">60</span>，按分数降序排列的学生信息</span><br><span class="line"><span class="keyword">select</span> s.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> s.s_id <span class="operator">=</span> sc.s_id <span class="keyword">AND</span> sc.c_id <span class="operator">=</span> <span class="number">01</span></span><br><span class="line"><span class="keyword">WHERE</span> sc.s_score <span class="operator">&lt;</span> <span class="number">60</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sc.s_score <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">17.</span> 按平均成绩从高到低（降序） 显示所有学生的所有课程的成绩以及平均成绩</span><br><span class="line"><span class="comment">-- 这里是按照课程的平均成绩还是学生的？</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> score sc</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> sc.c_id avg_cid, <span class="built_in">AVG</span>(sc.s_score) avg_score <span class="keyword">FROM</span> score sc <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_id</span><br><span class="line">) <span class="keyword">AS</span> avg_score_t <span class="keyword">ON</span> avg_score_t.avg_cid <span class="operator">=</span> sc.c_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_score_t.avg_score;</span><br><span class="line"></span><br><span class="line"># <span class="number">18.</span> 查询各科成绩最高分、最低分和平均分</span><br><span class="line"><span class="keyword">SELECT</span> sc.c_id,<span class="built_in">MAX</span>(sc.s_score),<span class="built_in">MIN</span>(sc.s_score),<span class="built_in">AVG</span>(sc.s_score)</span><br><span class="line"><span class="keyword">FROM</span> score sc</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.c_id;</span><br><span class="line"></span><br><span class="line"># <span class="number">19.</span> 按照各科成绩进行排序并显示排名</span><br><span class="line"><span class="comment">-- 开窗函数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span>,</span><br><span class="line"><span class="built_in">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> sc.c_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> sc.s_score <span class="keyword">DESC</span>)</span><br><span class="line"><span class="keyword">FROM</span> score sc;</span><br><span class="line"></span><br><span class="line"># <span class="number">20.</span> 查询学生的总成绩并进行排名</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span>,<span class="built_in">SUM</span>(sc.s_score) sum_score</span><br><span class="line"><span class="keyword">FROM</span> score sc</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.s_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sum_score <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">21.</span> 查询不同老师所教不同课程平均分从高到低显示</span><br><span class="line"><span class="keyword">SELECT</span> t.<span class="operator">*</span>,c.<span class="operator">*</span>,<span class="built_in">AVG</span>(sc.s_score) avg_score</span><br><span class="line"><span class="keyword">FROM</span> teacher t</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> course c <span class="keyword">ON</span> t.t_id <span class="operator">=</span> c.t_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> c.c_id <span class="operator">=</span> sc.c_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.c_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_score <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">22.</span> 查询所有课程的成绩第二名到第三名的学生信息及该课程成绩</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">FROM</span> (</span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span>,sc.s_score,sc.c_id,</span><br><span class="line"><span class="built_in">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> sc.c_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> sc.s_score <span class="keyword">DESC</span>) rank_order</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> s.s_id <span class="operator">=</span> sc.s_id</span><br><span class="line">) <span class="keyword">AS</span> <span class="keyword">result</span></span><br><span class="line"><span class="keyword">WHERE</span> rank_order <span class="keyword">BETWEEN</span> <span class="number">2</span> <span class="keyword">AND</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">23.</span> 统计各科成绩各分数段人数：课程编号，课程名称，[<span class="number">100</span><span class="number">-85</span>],[<span class="number">85</span><span class="number">-70</span>],[<span class="number">70</span><span class="number">-60</span>],[<span class="number">0</span><span class="number">-60</span>]及所占百分比</span><br><span class="line"><span class="keyword">SELECT</span> c.c_id,c.c_name,</span><br><span class="line">(<span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> score sc <span class="keyword">WHERE</span> sc.s_score <span class="keyword">BETWEEN</span> <span class="number">85</span> <span class="keyword">AND</span> <span class="number">100</span> <span class="keyword">AND</span> c.c_id <span class="operator">=</span> sc.c_id)<span class="string">&#x27;[100-85]&#x27;</span>,</span><br><span class="line">(<span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> score sc <span class="keyword">WHERE</span> sc.s_score <span class="keyword">BETWEEN</span> <span class="number">70</span> <span class="keyword">AND</span> <span class="number">85</span> <span class="keyword">AND</span> c.c_id <span class="operator">=</span> sc.c_id)<span class="string">&#x27;[85-70]&#x27;</span>,</span><br><span class="line">(<span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> score sc <span class="keyword">WHERE</span> sc.s_score <span class="keyword">BETWEEN</span> <span class="number">60</span> <span class="keyword">AND</span> <span class="number">70</span> <span class="keyword">AND</span> c.c_id <span class="operator">=</span> sc.c_id)<span class="string">&#x27;[70-60]&#x27;</span>,</span><br><span class="line">(<span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> score sc <span class="keyword">WHERE</span> sc.s_score <span class="keyword">BETWEEN</span> <span class="number">0</span> <span class="keyword">AND</span> <span class="number">60</span> <span class="keyword">AND</span> c.c_id <span class="operator">=</span> sc.c_id)<span class="string">&#x27;[0-60]&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> course c;</span><br><span class="line"></span><br><span class="line"># <span class="number">24.</span> 查询学生的平均成绩名次</span><br><span class="line"><span class="keyword">SELECT</span> s.s_id,s.s_name,<span class="built_in">AVG</span>(s_score),</span><br><span class="line"><span class="built_in">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> sc.s_score <span class="keyword">DESC</span>) rank_order</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> s.s_id <span class="operator">=</span> sc.s_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> s.s_id;</span><br><span class="line"></span><br><span class="line"># <span class="number">25.</span> 查询各科成绩前三名的记录</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">FROM</span> (</span><br><span class="line"><span class="keyword">SELECT</span> sc.<span class="operator">*</span>,<span class="built_in">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> sc.c_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> sc.s_score <span class="keyword">DESC</span>) rank_order</span><br><span class="line"><span class="keyword">FROM</span> score sc ) <span class="keyword">result</span></span><br><span class="line"><span class="keyword">WHERE</span> rank_order <span class="operator">&lt;</span> <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">26.</span> 查询每门课被选修的学生数</span><br><span class="line"><span class="keyword">SELECT</span> c.<span class="operator">*</span>,(<span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> score sc <span class="keyword">WHERE</span> sc.c_id <span class="operator">=</span> c.c_id) <span class="string">&#x27;student_count&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> course c;</span><br><span class="line"></span><br><span class="line"># <span class="number">27.</span> 查询出只有两门课程的全部学生的学号和姓名</span><br><span class="line"><span class="keyword">SELECT</span> s.s_id,s.s_name</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span> s.s_id <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> sc.s_id</span><br><span class="line">	<span class="keyword">FROM</span> score sc </span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.s_id </span><br><span class="line">	<span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">=</span> <span class="number">2</span> </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># <span class="number">28.</span> 查询男女生人数</span><br><span class="line"><span class="keyword">SELECT</span> s.s_sex,<span class="built_in">COUNT</span>(<span class="operator">*</span>) </span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> s.s_sex;</span><br><span class="line"></span><br><span class="line"># <span class="number">29.</span> 查询名字中含有风字的学生信息</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span> s.s_name <span class="keyword">LIKE</span> &quot;%风%&quot;;</span><br><span class="line"></span><br><span class="line"># <span class="number">30.</span> 查询同名同姓的学生名单，并统计学生人数</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> s1.<span class="operator">*</span>,</span><br><span class="line">(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) </span><br><span class="line">	<span class="keyword">FROM</span>(</span><br><span class="line">			<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> s3.<span class="operator">*</span></span><br><span class="line">			<span class="keyword">FROM</span> student s3</span><br><span class="line">			<span class="keyword">INNER</span> <span class="keyword">JOIN</span> student s4 <span class="keyword">ON</span> s3.s_name <span class="operator">=</span> s4.s_name <span class="keyword">AND</span> s3.s_id <span class="operator">&lt;&gt;</span> s4.s_id</span><br><span class="line">	) <span class="keyword">AS</span> <span class="keyword">result</span></span><br><span class="line">	<span class="keyword">WHERE</span> result.s_name <span class="operator">=</span> s1.s_name</span><br><span class="line">) count_name</span><br><span class="line"><span class="keyword">FROM</span> student s1</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> student s2 <span class="keyword">ON</span> s1.s_name <span class="operator">=</span> s2.s_name <span class="keyword">AND</span> s1.s_id <span class="operator">&lt;&gt;</span> s2.s_id;</span><br><span class="line"></span><br><span class="line"># <span class="number">31.</span> 查询<span class="number">1990</span>年出生的学生信息</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span> SUBSTR(s.s_birth,<span class="number">1</span>,<span class="number">4</span>) <span class="operator">=</span> <span class="number">1990</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">32.</span> 查询每门课程的平均成绩，结果按照平均程序降序排列，平均成绩相同时，按课程编号c_id升序排列</span><br><span class="line"><span class="keyword">SELECT</span> sc.<span class="operator">*</span>,<span class="built_in">AVG</span>(sc.s_score) avg_score</span><br><span class="line"><span class="keyword">FROM</span> score sc</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.c_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_score <span class="keyword">DESC</span>, c_id <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">33.</span> 查询平均成绩大于等于<span class="number">85</span>的所有学生的学号、姓名和平均成绩</span><br><span class="line"><span class="keyword">SELECT</span> s.s_id,s.s_name,<span class="built_in">AVG</span>(sc.s_score) avg_score</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> s.s_id <span class="operator">=</span> sc.s_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.s_id</span><br><span class="line"><span class="keyword">HAVING</span> avg_score <span class="operator">&gt;=</span> <span class="number">85</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">34.</span> 查询课程名称为数学，且分数低于<span class="number">60</span>的学生姓名和分数</span><br><span class="line"><span class="keyword">SELECT</span> s.s_name, sc.s_score</span><br><span class="line"><span class="keyword">FROM</span> course c</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> sc.c_id <span class="operator">=</span> c.c_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> student s <span class="keyword">ON</span> sc.s_id <span class="operator">=</span> s.s_id</span><br><span class="line"><span class="keyword">WHERE</span> c.c_name <span class="operator">=</span> <span class="string">&#x27;数学&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> sc.s_score <span class="operator">&lt;</span> <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">35.</span> 查询所有学生的课程及分数情况</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> s.s_id <span class="operator">=</span> sc.s_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> course c <span class="keyword">ON</span> sc.c_id <span class="operator">=</span> c.c_id;</span><br><span class="line"></span><br><span class="line"># <span class="number">36.</span> 查询任何一门课程成绩在<span class="number">70</span>分以上的姓名、课程名称和分数</span><br><span class="line"><span class="keyword">SELECT</span> s.s_name,c.c_name,sc.s_score</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> s.s_id <span class="operator">=</span> sc.s_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> course c <span class="keyword">ON</span> sc.c_id <span class="operator">=</span> c.c_id</span><br><span class="line"><span class="keyword">WHERE</span> sc.s_score <span class="operator">&gt;</span> <span class="number">70</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">37.</span> 查询不及格的课程</span><br><span class="line"><span class="keyword">SELECT</span> c.<span class="operator">*</span>,sc.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> score sc </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> course c <span class="keyword">ON</span> sc.c_id <span class="operator">=</span> c.c_id</span><br><span class="line"><span class="keyword">WHERE</span> sc.s_score <span class="operator">&lt;</span> <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">38.</span> 查询课程编号为<span class="number">01</span>且课程成绩大于等于<span class="number">80</span>的学生的学号和姓名</span><br><span class="line"><span class="keyword">SELECT</span> s.s_name,c.c_name</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> s.s_id <span class="operator">=</span> sc.s_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> course c <span class="keyword">ON</span> sc.c_id <span class="operator">=</span> c.c_id</span><br><span class="line"><span class="keyword">WHERE</span> sc.s_score <span class="operator">&gt;</span> <span class="number">80</span> <span class="keyword">AND</span> sc.c_id <span class="operator">=</span> <span class="number">01</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">39.</span> 每门课程的学生人数</span><br><span class="line"><span class="keyword">SELECT</span> c_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) </span><br><span class="line"><span class="keyword">FROM</span> score sc</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> c_id;</span><br><span class="line"></span><br><span class="line"># <span class="number">40.</span> 查询选修“张三”老师所授课程中，成绩最高的学生信息及其成绩</span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span>, sc.s_score</span><br><span class="line"><span class="keyword">FROM</span> teacher t</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> course c <span class="keyword">ON</span> t.t_id <span class="operator">=</span> c.c_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> c.c_id <span class="operator">=</span> sc.c_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> student s <span class="keyword">ON</span> sc.s_id <span class="operator">=</span> s.s_id</span><br><span class="line"><span class="keyword">WHERE</span> t.t_name <span class="operator">=</span> &quot;张三&quot;</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sc.s_score <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">41.</span> 查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> s.s_id, sc1.c_id, sc1.s_score</span><br><span class="line"><span class="keyword">FROM</span> score sc1 </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc2 <span class="keyword">ON</span> sc1.s_id <span class="operator">=</span> sc2.s_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> student s <span class="keyword">ON</span> sc1.s_id <span class="operator">=</span> s.s_id</span><br><span class="line"><span class="keyword">WHERE</span> sc1.s_score <span class="operator">=</span> sc2.s_score <span class="keyword">AND</span> sc1.c_id <span class="operator">&lt;&gt;</span> sc2.c_id;</span><br><span class="line"></span><br><span class="line"># <span class="number">42.</span> 查询每门功课成绩最好的前两名</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">	,<span class="built_in">ROW_NUMBER</span>() <span class="keyword">over</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> sc.c_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> sc.s_score) row_over</span><br><span class="line">	<span class="keyword">FROM</span> score sc</span><br><span class="line">) <span class="keyword">AS</span> <span class="keyword">result</span></span><br><span class="line"><span class="keyword">WHERE</span> row_over <span class="operator">&lt;</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">43.</span> 统计每门课程的学生选修人数(超过<span class="number">5</span>人的课程才统计)</span><br><span class="line"><span class="keyword">SELECT</span> sc.c_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) count_num</span><br><span class="line"><span class="keyword">FROM</span> score sc</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> c_id</span><br><span class="line"><span class="keyword">HAVING</span> count_num <span class="operator">&gt;</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">44.</span> 检索至少选修两门课程的学生学号</span><br><span class="line"><span class="keyword">SELECT</span> sc.s_id</span><br><span class="line"><span class="keyword">FROM</span> score sc</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.s_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"># <span class="number">45.</span> 查询选修了全部课程的学生信息</span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span> s.s_id <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> sc.s_id</span><br><span class="line">	<span class="keyword">FROM</span> score sc</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.s_id</span><br><span class="line">	<span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="operator">=</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> course</span><br><span class="line">	)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># <span class="number">46.</span> 查询各学生的年龄：按照出生日期来算，当前月日 <span class="operator">&lt;</span> 出生年月的月日则年龄减一</span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span>, <span class="keyword">CASE</span> </span><br><span class="line">	<span class="keyword">WHEN</span> </span><br><span class="line">	SUBDATE(NOW(),<span class="type">INTERVAL</span> TIMESTAMPDIFF(<span class="keyword">YEAR</span>,s.s_birth,NOW()) <span class="keyword">year</span>) <span class="operator">&gt;</span> s.s_birth </span><br><span class="line">	<span class="keyword">THEN</span></span><br><span class="line">		TIMESTAMPDIFF(<span class="keyword">YEAR</span>,s.s_birth,NOW())</span><br><span class="line">	<span class="keyword">ELSE</span></span><br><span class="line">		TIMESTAMPDIFF(<span class="keyword">YEAR</span>,s.s_birth,NOW()) <span class="operator">-</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">END</span> <span class="string">&#x27;age&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> student s;</span><br><span class="line"></span><br><span class="line"># <span class="number">47.</span> 查询本周过生日的学生</span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span>,WEEK(s.s_birth),WEEK(NOW())</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">WEEK(s.s_birth) <span class="operator">=</span> WEEK(NOW());</span><br><span class="line"></span><br><span class="line"># <span class="number">48.</span> 查询下周过生日的学生</span><br><span class="line"><span class="comment">-- 一年52周</span></span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span>,WEEK(s.s_birth),WEEK(NOW())</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="built_in">MOD</span>(WEEK(s.s_birth),<span class="number">52</span>) <span class="operator">=</span> <span class="built_in">MOD</span>(WEEK(NOW())<span class="operator">+</span><span class="number">1</span>,<span class="number">52</span>);</span><br><span class="line"></span><br><span class="line"># <span class="number">49.</span> 查询本月过生日的同学</span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span>,<span class="keyword">MONTH</span>(s.s_birth),<span class="keyword">MONTH</span>(NOW())</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="keyword">MONTH</span>(s.s_birth) <span class="operator">=</span> <span class="keyword">MONTH</span>(NOW());</span><br><span class="line"></span><br><span class="line"># <span class="number">50.</span> 查询下月过生日的同学</span><br><span class="line"><span class="keyword">SELECT</span> s.<span class="operator">*</span>,<span class="keyword">MONTH</span>(s.s_birth),<span class="keyword">MONTH</span>(NOW())</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"><span class="built_in">MOD</span>(<span class="keyword">MONTH</span>(s.s_birth),<span class="number">12</span>) <span class="operator">=</span> <span class="built_in">MOD</span>(<span class="keyword">MONTH</span>(NOW())<span class="operator">+</span><span class="number">1</span>,<span class="number">12</span>);</span><br><span class="line"><span class="comment">--1、查询没学过“谌燕”老师课的同学，显示（学号、姓名）</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	hs.student_no,</span><br><span class="line">	hs.student_name </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	hand_student hs </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	<span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		<span class="number">1</span> </span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		hand_course hc,</span><br><span class="line">		hand_teacher ht,</span><br><span class="line">		hand_student_core hsc </span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">		hc.teacher_no <span class="operator">=</span> ht.teacher_no </span><br><span class="line">		<span class="keyword">AND</span> hc.course_no <span class="operator">=</span> hsc.course_no </span><br><span class="line">		<span class="keyword">AND</span> ht.teacher_name <span class="operator">=</span> <span class="string">&#x27;谌燕&#x27;</span> </span><br><span class="line">		<span class="keyword">AND</span> hsc.student_no <span class="operator">=</span> hs.student_no </span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--2、查询没有学全所有课的同学，显示（学号、姓名）</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	hs.student_no,</span><br><span class="line">	hs.student_name,</span><br><span class="line">	<span class="built_in">COUNT</span>( hsc.course_no ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	hand_student hs,</span><br><span class="line">	hand_student_core hsc </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	hs.student_no <span class="operator">=</span> hsc.student_no (<span class="operator">+</span>) </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	hs.student_no,</span><br><span class="line">	hs.student_name </span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line">	<span class="built_in">COUNT</span>( hsc.course_no ) <span class="operator">&lt;</span>  (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>( hc.course_no ) <span class="keyword">FROM</span> hand_course hc ));</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">--3、查询“c001”课程比“c002”课程成绩高的所有学生，显示（学号、姓名）</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	hsc1.student_no,</span><br><span class="line">	hs.student_name </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	( <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> hAND_student_core sc1 <span class="keyword">WHERE</span> sc1.course_no <span class="operator">=</span> <span class="string">&#x27;c001&#x27;</span> ) hsc1, #c001对应的成绩作为临时表<span class="number">1</span></span><br><span class="line">	( <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> hAND_student_core sc2 <span class="keyword">WHERE</span> sc2.course_no <span class="operator">=</span> <span class="string">&#x27;c002&#x27;</span> ) hsc2, #c002对应的成绩作为临时表<span class="number">2</span></span><br><span class="line">	hand_student hs </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">	hsc1.student_no <span class="operator">=</span> hsc2.student_no </span><br><span class="line">	<span class="keyword">AND</span> hsc1.core <span class="operator">&gt;</span> hsc2.core #分数比较</span><br><span class="line">	<span class="keyword">AND</span> hsc1.student_no <span class="operator">=</span> hs.student_no;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--4、按各科平均成绩和及格率的百分数，按及格率高到低顺序，显示（课程号、平均分、及格率）</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	hsc.course_no,</span><br><span class="line">	<span class="built_in">AVG</span>( hsc.core ) avg_core, #平均分</span><br><span class="line">	( <span class="built_in">SUM</span>( <span class="keyword">CASE</span> <span class="keyword">WHEN</span> hsc.core <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span> ) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">*</span> <span class="number">100</span> ) <span class="keyword">AS</span> pass_rate </span><br><span class="line">	#( <span class="built_in">SUM</span>( <span class="keyword">CASE</span> <span class="keyword">WHEN</span> hsc.core <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span> ) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">*</span> <span class="number">100</span> ) <span class="operator">||</span> <span class="operator">%</span> <span class="keyword">AS</span> pass_rate </span><br><span class="line">	#及格率<span class="operator">=</span>及格数÷总数×<span class="number">100</span><span class="operator">%</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	hand_student_core hsc </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	hsc.course_no #通过课程号分组</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">	pass_rate <span class="keyword">DESC</span>; #降序</span><br><span class="line"><span class="comment">-- case when语句，平均分在60及以上输出1，反之输出0</span></span><br><span class="line"><span class="comment">-- case when 可以写判断，并且函数只会返回第一个符合条件的值，其他case被忽略</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--5、1992年之后出生的学生名单找出年龄最大和最小的同学，显示（学号、姓名、年龄）</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	hand_student;</span><br><span class="line">	</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	hs.student_no,</span><br><span class="line">	hs.student_name,</span><br><span class="line">	hs.student_age </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	hand_student hs,</span><br><span class="line">	(</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		<span class="built_in">max</span>( student_age ) max_age,</span><br><span class="line">		<span class="built_in">min</span>( student_age ) min_age </span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		hand_student </span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">		to_number ( to_char ( sysdate, <span class="string">&#x27;yyyy&#x27;</span> ) <span class="operator">-</span> student_age ) <span class="operator">&gt;</span> <span class="number">1992</span> </span><br><span class="line">	) hh </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	hs.student_age <span class="operator">=</span> hh.max_age </span><br><span class="line">	<span class="keyword">OR</span> hs.student_age <span class="operator">=</span> hh.min_age;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--6、统计列出矩阵类型各分数段人数，横轴为分数段[100-85]、[85-70]、[70-60]、[&lt;60]，纵轴为课程号、课程名称</span></span><br><span class="line"><span class="keyword">SELECT</span> hsc.course_no,</span><br><span class="line">       hc.course_name,</span><br><span class="line">       <span class="built_in">SUM</span>(<span class="keyword">CASE</span></span><br><span class="line">             <span class="keyword">WHEN</span> hsc.core <span class="keyword">BETWEEN</span> <span class="number">85</span> <span class="keyword">AND</span> <span class="number">100</span> <span class="keyword">THEN</span></span><br><span class="line">              <span class="number">1</span></span><br><span class="line">             <span class="keyword">ELSE</span></span><br><span class="line">              <span class="number">0</span></span><br><span class="line">           <span class="keyword">END</span>) <span class="keyword">AS</span> &quot;[100-85]&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(<span class="keyword">CASE</span></span><br><span class="line">             <span class="keyword">WHEN</span> hsc.core <span class="keyword">BETWEEN</span> <span class="number">70</span> <span class="keyword">AND</span> <span class="number">85</span> <span class="keyword">THEN</span></span><br><span class="line">              <span class="number">1</span></span><br><span class="line">             <span class="keyword">ELSE</span></span><br><span class="line">              <span class="number">0</span></span><br><span class="line">           <span class="keyword">END</span>) <span class="keyword">AS</span> &quot;[85-70]&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(<span class="keyword">CASE</span></span><br><span class="line">             <span class="keyword">WHEN</span> hsc.core <span class="keyword">BETWEEN</span> <span class="number">60</span> <span class="keyword">AND</span> <span class="number">70</span> <span class="keyword">THEN</span></span><br><span class="line">              <span class="number">1</span></span><br><span class="line">             <span class="keyword">ELSE</span></span><br><span class="line">              <span class="number">0</span></span><br><span class="line">           <span class="keyword">END</span>) <span class="keyword">AS</span> &quot;[70-60]&quot;,</span><br><span class="line">       <span class="built_in">SUM</span>(<span class="keyword">CASE</span></span><br><span class="line">             <span class="keyword">WHEN</span> hsc.core <span class="operator">&lt;</span> <span class="number">60</span> <span class="keyword">then</span></span><br><span class="line">              <span class="number">1</span></span><br><span class="line">             <span class="keyword">ELSE</span></span><br><span class="line">              <span class="number">0</span></span><br><span class="line">           <span class="keyword">END</span>) <span class="keyword">AS</span> &quot;[&lt;60]&quot;</span><br><span class="line">  <span class="keyword">FROM</span> hand_student_core hsc, </span><br><span class="line">       hand_course hc</span><br><span class="line"> <span class="keyword">WHERE</span> hsc.course_no <span class="operator">=</span> hc.course_no</span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> hsc.course_no, hc.course_name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--7、查询各科成绩前三名的记录:(不考虑成绩并列情况)，显示（学号、课程号、分数）</span></span><br><span class="line"><span class="keyword">SELECT</span> student_no,</span><br><span class="line">       course_no,</span><br><span class="line">       core</span><br><span class="line">  <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> hsc.student_no,</span><br><span class="line">               hsc.course_no,</span><br><span class="line">               hsc.core,</span><br><span class="line">               <span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> hsc.course_no <span class="keyword">ORDER</span> <span class="keyword">BY</span> hsc.core <span class="keyword">DESC</span>) ranks</span><br><span class="line">          <span class="keyword">FROM</span> hand_student_core hsc)</span><br><span class="line"> <span class="keyword">WHERE</span> ranks <span class="operator">&lt;</span> <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--8、查询选修“谌燕”老师所授课程的学生中，成绩最高的学生，显示（学号、姓名、课程名称、成绩）</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	hs.student_no,</span><br><span class="line">	hs.student_name,</span><br><span class="line">	hc.course_name,</span><br><span class="line">	hsc.core </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	hand_student hs,</span><br><span class="line">	hand_student_core hsc,</span><br><span class="line">	hand_course hc,</span><br><span class="line">	hand_teacher ht </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	hs.student_no <span class="operator">=</span> hsc.student_no </span><br><span class="line">	<span class="keyword">AND</span> hsc.course_no <span class="operator">=</span> hc.course_no </span><br><span class="line">	<span class="keyword">AND</span> hc.teacher_no <span class="operator">=</span> ht.teacher_no </span><br><span class="line">	<span class="keyword">AND</span> ht.teacher_name <span class="operator">=</span> <span class="string">&#x27;谌燕&#x27;</span> </span><br><span class="line">	<span class="keyword">AND</span> hsc.core <span class="operator">=</span> ( <span class="keyword">SELECT</span> <span class="built_in">MAX</span>( sc.core ) <span class="keyword">FROM</span> hand_student_core sc <span class="keyword">WHERE</span> sc.course_no <span class="operator">=</span> hc.course_no );</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">--9、查询两门以上不及格课程的同学及平均成绩，显示（学号、姓名、平均成绩（保留两位小数））</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	hsc.student_no,</span><br><span class="line">	hs.student_name,</span><br><span class="line">	ROUND( <span class="built_in">AVG</span>( hsc.core ), <span class="number">2</span> ) avg_core </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	hand_student_core hsc,</span><br><span class="line">	hand_student hs </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	hsc.student_no <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		sc.student_no </span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		hand_student_core sc </span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">		sc.core <span class="operator">&lt;</span> <span class="number">60</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.student_no <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>( sc.student_no ) <span class="operator">&gt;</span> <span class="number">1</span> </span><br><span class="line">	) </span><br><span class="line">	<span class="keyword">AND</span> hsc.student_no <span class="operator">=</span> hs.student_no </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	hsc.student_no,</span><br><span class="line">	hs.student_name;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">--10、查询姓氏数量最多的学生名单，显示（学号、姓名、人数）</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	hs.student_no,</span><br><span class="line">	hs.student_name,</span><br><span class="line">	ht.cnt </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	(</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		SUBSTR( hs.student_name, <span class="number">1</span>, <span class="number">1</span> ) surname,</span><br><span class="line">		<span class="built_in">COUNT</span>( <span class="number">1</span> ) cnt,</span><br><span class="line">		<span class="built_in">dense_rank</span>() <span class="keyword">OVER</span> ( <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">COUNT</span>( <span class="number">1</span> ) <span class="keyword">DESC</span> ) ranks </span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		hand_student hs </span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	SUBSTR( hs.student_name, <span class="number">1</span>, <span class="number">1</span> )) ht,</span><br><span class="line">	hand_student hs </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	substr( hs.student_name, <span class="number">1</span>, <span class="number">1</span> ) <span class="operator">=</span> ht.surname </span><br><span class="line">	<span class="keyword">AND</span> ht.ranks <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="comment">--11、查询课程名称为“J2SE”的学生成绩信息，90以上为“优秀”、80-90为“良好”、60-80为“及格”、60分以下为“不及格”，</span></span><br><span class="line"><span class="comment">--显示（学号、姓名、课程名称、成绩、等级）</span></span><br><span class="line"><span class="keyword">SELECT</span> hsc.student_no, hs.student_name, hc.course_name, hsc.core, <span class="keyword">CASE</span> <span class="keyword">WHEN</span> hsc.core <span class="operator">&gt;=</span> <span class="number">90</span> <span class="keyword">THEN</span></span><br><span class="line">	<span class="string">&#x27;优秀&#x27;</span> </span><br><span class="line">	<span class="keyword">WHEN</span> hsc.core <span class="operator">&lt;</span> <span class="number">90</span> <span class="keyword">AND</span> hsc.core <span class="operator">&gt;=</span> <span class="number">80</span> <span class="keyword">THEN</span></span><br><span class="line">	<span class="string">&#x27;良好&#x27;</span> </span><br><span class="line">	<span class="keyword">WHEN</span> hsc.core <span class="operator">&lt;</span> <span class="number">80</span> <span class="keyword">AND</span> hsc.core <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">THEN</span></span><br><span class="line">	<span class="string">&#x27;及格&#x27;</span> </span><br><span class="line">	<span class="keyword">WHEN</span> hsc.core <span class="operator">&lt;</span> <span class="number">60</span> <span class="keyword">THEN</span></span><br><span class="line">	<span class="string">&#x27;不及格&#x27;</span> </span><br><span class="line"><span class="keyword">END</span> core_level </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	hand_student_core hsc,</span><br><span class="line">	hand_course hc,</span><br><span class="line">	hand_student hs </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	hsc.course_no <span class="operator">=</span> hc.course_no </span><br><span class="line">	<span class="keyword">AND</span> hsc.student_no <span class="operator">=</span> hs.student_no </span><br><span class="line">	<span class="keyword">AND</span> hc.course_name <span class="operator">=</span> <span class="string">&#x27;J2SE&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--12、查询教师“胡明星”的所有主管及姓名:（无主管的教师也需要显示），显示（教师编号、教师名称、主管编号、主管名称）</span></span><br><span class="line"> <span class="keyword">SELECT</span> ht1.teacher_no,</span><br><span class="line">        ht1.teacher_name,</span><br><span class="line">        ht1.manager_no,</span><br><span class="line">        ht2.teacher_name manager_name</span><br><span class="line">   <span class="keyword">FROM</span> hand_teacher ht1,</span><br><span class="line">        hand_teacher ht2</span><br><span class="line">  <span class="keyword">WHERE</span> ht1.manager_no <span class="operator">=</span> ht2.teacher_no(<span class="operator">+</span>)</span><br><span class="line">  <span class="keyword">START</span> <span class="keyword">WITH</span> ht1.teacher_name <span class="operator">=</span> <span class="string">&#x27;胡明星&#x27;</span></span><br><span class="line"><span class="keyword">CONNECT</span> <span class="keyword">BY</span> PRIOR ht1.manager_no <span class="operator">=</span> ht1.teacher_no;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--13、查询分数高于课程“J2SE”的所有学生课程信息，显示（学号，姓名，课程名称、分数）</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	hsc.student_no,</span><br><span class="line">	hs.student_name,</span><br><span class="line">	hc.course_name,</span><br><span class="line">	hsc.core </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	hand_student_core hsc,</span><br><span class="line">	hand_course hc,</span><br><span class="line">	hand_student hs </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	hsc.course_no <span class="operator">=</span> hc.course_no </span><br><span class="line">	<span class="keyword">AND</span> hsc.student_no <span class="operator">=</span> hs.student_no </span><br><span class="line">	<span class="keyword">AND</span> hsc.core <span class="operator">&gt;</span> <span class="keyword">ALL</span> ( <span class="keyword">SELECT</span> hsc.core <span class="keyword">FROM</span> hand_student_core hsc, hand_course hc <span class="keyword">WHERE</span> hsc.course_no <span class="operator">=</span> hc.course_no <span class="keyword">AND</span> hc.course_name <span class="operator">=</span> <span class="string">&#x27;J2SE&#x27;</span> ) </span><br><span class="line">	<span class="keyword">AND</span> hc.course_name <span class="operator">!=</span> <span class="string">&#x27;J2SE&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--14、查询教师、课程及选课的学生数量：(使用rollup),显示（教师名称、课程名称、选课数量）</span></span><br><span class="line"><span class="keyword">SELECT</span> ht.teacher_name,</span><br><span class="line">       hc.course_name,</span><br><span class="line">       <span class="built_in">COUNT</span>(<span class="number">1</span>) nums</span><br><span class="line">  <span class="keyword">FROM</span> hand_student_core hsc,</span><br><span class="line">       hand_teacher ht,</span><br><span class="line">       hand_course hc</span><br><span class="line"> <span class="keyword">WHERE</span> hsc.course_no <span class="operator">=</span> hc.course_no</span><br><span class="line">   <span class="keyword">AND</span> hc.teacher_no <span class="operator">=</span> ht.teacher_no</span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">ROLLUP</span>(ht.teacher_name,hc.course_name)</span><br><span class="line"> <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span></span><br><span class="line"> ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--15、查询所有课程成绩前三名的按照升序排在最开头，其余数据排序保持默认,显示（学号、成绩）</span></span><br><span class="line"><span class="keyword">SELECT</span> hs.student_no,</span><br><span class="line">       hs.core</span><br><span class="line">  <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> rownum rn,</span><br><span class="line">               hsc.student_no,</span><br><span class="line">               hsc.core,</span><br><span class="line">               <span class="built_in">row_number</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> hsc.core <span class="keyword">DESC</span>) ranks</span><br><span class="line">          <span class="keyword">FROM</span> hand_student_core hsc) hs</span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> ranks <span class="operator">&lt;=</span> <span class="number">3</span> <span class="keyword">THEN</span> <span class="operator">-</span>ranks <span class="keyword">ELSE</span> <span class="keyword">null</span> <span class="keyword">END</span>,rn;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="约束条件"><a href="#约束条件" class="headerlink" title="约束条件"></a>约束条件</h1><p>UNSIGNED ：无符号，值从0开始，无负数<br>ZEROFILL：零填充，当数据的显示长度不够的时候可以使用前补0的效果填充至指定长度,字段会自动添加UNSIGNED<br>NOT NULL：非空约束，表示该字段的值不能为空<br>DEFAULT：表示如果插入数据时没有给该字段赋值，那么就使用默认值<br>PRIMARY KEY：主键约束，表示唯一标识，不能为空，且一个表只能有一个主键。一般都是用来约束id<br>AUTO_INCREMENT：自增长，只能用于数值列，而且配合索引使用,默认起始值从1开始，每次增长1<br>UNIQUE KEY：唯一值，表示该字段下的值不能重复，null除外。比如身份证号是一人一号的，一般都会用这个进行约束<br>FOREIGN KEY：外键约束，目的是为了保证数据的完成性和唯一性，以及实现一对一或一对多关系</p>
<h1 id="一种修改或插入的办法"><a href="#一种修改或插入的办法" class="headerlink" title="一种修改或插入的办法"></a>一种修改或插入的办法</h1><p>场景为：若存在child为2的关系，则将该关系中的parent修改为5，若不存在child等于2的关系，则直接新增5，2的关系对</p>
<ol>
<li><p>不存在则插入否则不插入</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dir_dir_table (parent_dir_id, child_dir_id)  </span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;2&#x27;</span>  </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (  </span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> dir_dir_table <span class="keyword">WHERE</span> child_dir_id <span class="operator">=</span> <span class="number">2</span>  </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p> 这里使用了将子查询作为插入源的方式，若子查询没有查到内容，则不会插入任何内容，相反，若子查询的条件满足，则可插入内容</p>
</li>
<li><p>修改（此时肯定已经有了可修改的内容）</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> dir_dir_table <span class="keyword">SET</span> parent_dir_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">WHERE</span> child_dir_id <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="insert-ignore-into"><a href="#insert-ignore-into" class="headerlink" title="insert ignore into"></a>insert ignore into</h1><p>当新增的记录在表中不存在的话则插入新的记录，注意这里比较的是全部字段，而不只是插入的时候指定的字段，比如插入的时候指定自增主键的话，则肯定会插入，因为带上数据库自动分配的自增主键的话，整条记录完全是新的字段。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> IGNORE <span class="keyword">INTO</span> dir_dir_table (id, parent_dir_id, child_dir_id) <span class="keyword">VALUES</span> (<span class="number">13</span>,<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="删除表内容的几个方式"><a href="#删除表内容的几个方式" class="headerlink" title="删除表内容的几个方式"></a>删除表内容的几个方式</h1><ul>
<li><p>DROP</p>
<p>  删除整张表数据，表结构以及表的索引、约束和触发器</p>
<p>  效率高，无法回滚</p>
</li>
<li><p>TRUNCATE</p>
<p>  删除表中全部数据，保留结构、索引、约束、触发器等其他数据，无法回滚，主键自增会重置</p>
</li>
<li><p>DELETE</p>
<p>  删除部分数据，效率低，可以回滚，自增主键不会重置</p>
</li>
</ul>
<h1 id="复制表的几个方式"><a href="#复制表的几个方式" class="headerlink" title="复制表的几个方式"></a>复制表的几个方式</h1><ul>
<li><p>AS</p>
<p>  这种方式不会复制表的索引、约束、触发器等，只会复制结构和数据</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> TEMP_TABLE <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> MY_TABLE <span class="keyword">WHERE</span> ...;</span><br></pre></td></tr></table></figure>
</li>
<li><p>LIKE</p>
<p>  会复制结构、索引、约束、触发器等，但不会复制数据</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> TEMP_TABLE <span class="keyword">LIKE</span> MY_TABLE;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="mysql存储文件"><a href="#mysql存储文件" class="headerlink" title="mysql存储文件"></a>mysql存储文件</h1><p>mysql中自带的longblob类型，该类型最大可存储4g的内容</p>
<h1 id="linux-mysql执行SQL文件"><a href="#linux-mysql执行SQL文件" class="headerlink" title="linux mysql执行SQL文件"></a>linux mysql执行SQL文件</h1><p>命令行中use数据库，执行source  文件路径</p>
<h1 id="裁剪字符串"><a href="#裁剪字符串" class="headerlink" title="裁剪字符串"></a>裁剪字符串</h1><p>SUBSTR(name, 1, CHAR_LENGTH(name)-3) 截取name字段，取除name字段后三位的所有字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT SUBSTR(&#x27;成都融资事业部&#x27;, 1, CHAR_LENGTH(&#x27;成都融资事业部&#x27;)-3)</span><br></pre></td></tr></table></figure>

<p>结果：成都融资</p>
<h1 id="开启-x2F-提交-x2F-回滚事务"><a href="#开启-x2F-提交-x2F-回滚事务" class="headerlink" title="开启&#x2F;提交&#x2F;回滚事务"></a>开启&#x2F;提交&#x2F;回滚事务</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test1;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> a   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> transaction;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> test1 <span class="keyword">values</span> (<span class="number">2</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> test1 <span class="keyword">values</span> (<span class="number">3</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">commit</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test1;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> a   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test1;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> a   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> transaction;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">delete</span> <span class="keyword">from</span> test1;</span><br><span class="line">Query OK, <span class="number">3</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">rollback</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test1;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> a   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="索引-1"><a href="#索引-1" class="headerlink" title="索引"></a>索引</h1><h2 id="聚簇-x2F-非聚簇索引"><a href="#聚簇-x2F-非聚簇索引" class="headerlink" title="聚簇&#x2F;非聚簇索引"></a>聚簇&#x2F;非聚簇索引</h2><p>聚簇索引就是一级索引，将数据存储与索引集合，每个表都肯定有一个</p>
<ul>
<li>存在主键则主键索引就是聚簇索引</li>
<li>没有主键则由唯一索引</li>
<li>若没有唯一索引，则会自动生成一个rowid作为聚簇索引</li>
</ul>
<p>非聚簇索引就是二级索引，也就是用户自己创建的索引，可以存在多个</p>
<h2 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h2><p>索引本身是为了加速查询，对于查询操作来说，对数据进行预先的排序，在查询的时候进行大小的比较当然会加快查询速度。</p>
<p>索引的底层实现比如可以是B+树，对于树来说，排序的时候会有往左节点还是右节点插入值的操作，决定哪一侧就是通过比较插入值的大小</p>
<p>单个字段索引就是比较该字段的大小</p>
<p>复合索引就是，比如有三个字段ABC，则会先比较A，在A比较结果的基础上比较B，在AB的结果上比较C，从而决定插入位置，这同时也限制了，要使用复合索引的时候，必须有最左侧的字段，否则不会触发该符合索引</p>
<p>使用场景：在on或者where时有多个字段and的场景</p>
<h2 id="回表查询"><a href="#回表查询" class="headerlink" title="回表查询"></a>回表查询</h2><p>通过二级索引找到对应的主键，再到聚簇索引中找整行数据</p>
<h2 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h2><p>查询使用了索引，且返回的列在索引结构中全部都可以找到</p>
<ul>
<li><p>使用id查询：直接走聚集索引</p>
</li>
<li><p>分页优化：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> a,(<span class="keyword">select</span> id <span class="keyword">from</span> a <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">90000</span>,<span class="number">10</span>) b</span><br><span class="line"><span class="keyword">where</span> a.id <span class="operator">=</span> b.id</span><br></pre></td></tr></table></figure>

<p>  这样则会变成覆盖索引</p>
</li>
</ul>
<h2 id="索引失效"><a href="#索引失效" class="headerlink" title="索引失效"></a>索引失效</h2><ul>
<li>违反最左前缀</li>
<li>不能再索引上进行运算</li>
<li>字符串不加单引号导致类型转换</li>
<li>以%开头的模糊查询</li>
</ul>
<h1 id="驱动表"><a href="#驱动表" class="headerlink" title="驱动表"></a>驱动表</h1><ul>
<li><code>LEFT JOIN</code> 中，<strong>左表固定是驱动表</strong>，右表是被驱动表，因为左表的所有行都需要被保留并与右表匹配。</li>
<li><code>RIGHT JOIN</code> 中，<strong>右表固定是驱动表</strong>，左表是被驱动表，逻辑与 <code>LEFT JOIN</code> 相反。</li>
<li><code>INNER JOIN</code> 中，MySQL 优化器会根据表的大小、索引情况自动选择 “行数更少、查询更快” 的表作为驱动表。</li>
</ul>
<h1 id="慢查询"><a href="#慢查询" class="headerlink" title="慢查询"></a>慢查询</h1><p>定位慢查询：使用mysql自带的慢查询日志，设置超时时间</p>
<p>或者使用运维工具 skywalking</p>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p>隔离级别：</p>
<ul>
<li>未提交读</li>
<li>读已提交</li>
<li>可重复读</li>
<li>串行化</li>
</ul>
<p>脏读：一个事务读到另一个事务还没提交的数据</p>
<p>不可重复读：同一个事务两次读取的值不同</p>
<p>幻读：查询时该记录不存在，但插入时发现存在了</p>
<h1 id="undo-x2F-redo-log"><a href="#undo-x2F-redo-log" class="headerlink" title="undo&#x2F;redo log"></a>undo&#x2F;redo log</h1><p>undo log：回滚使用，保证原子性和一致性</p>
<p>redo log：恢复使用，保证持久性</p>
<h1 id="mvcc"><a href="#mvcc" class="headerlink" title="mvcc"></a>mvcc</h1><p>多版本并发控制</p>
<p>多个事务同时进行时，控制读取的事务是读的哪个事务提交的数据版本</p>
<h1 id="主从同步"><a href="#主从同步" class="headerlink" title="主从同步"></a>主从同步</h1><p>master提交事务时，将数据变更记录到binlog</p>
<p>从库读取binlog并执行</p>
<h1 id="分库分表"><a href="#分库分表" class="headerlink" title="分库分表"></a>分库分表</h1><p>水平：数量拆分</p>
<p>垂直：业务拆分</p>
<p>垂直&#x2F;水平 分库分表</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/sql/">sql</a></div><div class="post_share"><div class="social-share" data-image="/assets/img/tx.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/04/17/%E7%BB%8F%E9%AA%8C/hexo%E5%8D%9A%E5%AE%A2%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8/hexo%E5%8D%9A%E5%AE%A2%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8/" title="hexo博客框架的使用"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">hexo博客框架的使用</div></div></a></div><div class="next-post pull-right"><a href="/2023/03/09/%E7%AC%94%E8%AE%B0/juc/juc/" title="JUC"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JUC</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/assets/img/tx.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Boranget</div><div class="author-info__description">整理的一些笔记和平时的一些经验</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">198</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">206</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Boranget"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">笔记分类是一些看书或者网课做的笔记，经验分类一般是平时碰到的问题或者折腾的一些小东西。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E8%A1%A8"><span class="toc-number">1.</span> <span class="toc-text">虚拟表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%97%B6-ON-%E5%92%8C-WHERE-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.</span> <span class="toc-text">连接时 ON 和 WHERE 的区别</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%A8%E6%B2%A1%E6%9C%89group-by%E6%97%B6%E4%B9%9F%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8having"><span class="toc-number">3.</span> <span class="toc-text">在没有group by时也可以使用having</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Ein-x2F-exists"><span class="toc-number">4.</span> <span class="toc-text">关于in&#x2F;exists</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%AF%B9%E6%AF%94"><span class="toc-number">5.</span> <span class="toc-text">存储引擎对比</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Explain-x2F-Analyze"><span class="toc-number">6.</span> <span class="toc-text">Explain&#x2F;Analyze</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E7%AA%97%E5%87%BD%E6%95%B0"><span class="toc-number">7.</span> <span class="toc-text">开窗函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.</span> <span class="toc-text">数据库类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%89%B9%E7%82%B9%E5%8F%8A%E5%BA%94%E7%94%A8"><span class="toc-number">8.1.</span> <span class="toc-text">不同数据库的特点及应用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DML"><span class="toc-number">9.</span> <span class="toc-text">DML</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SELECT"><span class="toc-number">9.1.</span> <span class="toc-text">SELECT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.1.1.</span> <span class="toc-text">多表查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84-x2F-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">9.1.2.</span> <span class="toc-text">分组&#x2F;聚合函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.1.3.</span> <span class="toc-text">子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E4%B8%AA%E8%A1%A8%E7%9A%84%E4%BA%A4%E5%B9%B6%E5%B7%AE"><span class="toc-number">9.1.4.</span> <span class="toc-text">两个表的交并差</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">9.1.5.</span> <span class="toc-text">查询语句执行顺序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#INSERT"><span class="toc-number">9.2.</span> <span class="toc-text">INSERT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DELETE"><span class="toc-number">9.3.</span> <span class="toc-text">DELETE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UPDATE"><span class="toc-number">9.4.</span> <span class="toc-text">UPDATE</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DDL"><span class="toc-number">10.</span> <span class="toc-text">DDL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CREATE-TABLE"><span class="toc-number">10.1.</span> <span class="toc-text">CREATE TABLE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F"><span class="toc-number">10.2.</span> <span class="toc-text">约束</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">10.3.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ALTER-TABLE"><span class="toc-number">10.4.</span> <span class="toc-text">ALTER TABLE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%97"><span class="toc-number">10.4.1.</span> <span class="toc-text">添加列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%88%97"><span class="toc-number">10.4.2.</span> <span class="toc-text">删除列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">10.4.3.</span> <span class="toc-text">改变数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E8%A1%A8%E5%90%8D"><span class="toc-number">10.4.4.</span> <span class="toc-text">更改表名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E7%BA%A6%E6%9D%9F"><span class="toc-number">10.4.5.</span> <span class="toc-text">增加约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DROP-TABLE"><span class="toc-number">10.5.</span> <span class="toc-text">DROP TABLE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CREATE-INDEX"><span class="toc-number">10.6.</span> <span class="toc-text">CREATE INDEX</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DROP-INDEX"><span class="toc-number">10.7.</span> <span class="toc-text">DROP INDEX</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DROP-DATABASE"><span class="toc-number">10.8.</span> <span class="toc-text">DROP DATABASE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CREATE-VIEW"><span class="toc-number">10.9.</span> <span class="toc-text">CREATE VIEW</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DCL"><span class="toc-number">11.</span> <span class="toc-text">DCL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GRANT"><span class="toc-number">11.1.</span> <span class="toc-text">GRANT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#REVOKE"><span class="toc-number">11.2.</span> <span class="toc-text">REVOKE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#COMMIT"><span class="toc-number">11.3.</span> <span class="toc-text">COMMIT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROLLBACK"><span class="toc-number">11.4.</span> <span class="toc-text">ROLLBACK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SAVEPOINT"><span class="toc-number">11.5.</span> <span class="toc-text">SAVEPOINT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LOCK"><span class="toc-number">11.6.</span> <span class="toc-text">LOCK</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8SQL%E5%87%BD%E6%95%B0%E5%8F%8A%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">12.</span> <span class="toc-text">常用SQL函数及关键字</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">12.1.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">12.2.</span> <span class="toc-text">关键字</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E4%BC%98%E5%8C%96%E5%9F%BA%E7%A1%80"><span class="toc-number">13.</span> <span class="toc-text">SQL优化基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">13.1.</span> <span class="toc-text">存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">13.1.1.</span> <span class="toc-text">存储引擎相关命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E4%BC%98%E5%8C%96%E6%96%B9%E5%BC%8F"><span class="toc-number">13.2.</span> <span class="toc-text">MySQL优化方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E4%BC%98%E5%8C%96%E6%96%B9%E5%BC%8F"><span class="toc-number">13.2.1.</span> <span class="toc-text">应用优化方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%8A%80%E5%B7%A7"><span class="toc-number">13.2.2.</span> <span class="toc-text">其他技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%8A%80%E5%B7%A7"><span class="toc-number">13.2.2.1.</span> <span class="toc-text">常用技巧</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL-Slow-Log"><span class="toc-number">13.2.2.2.</span> <span class="toc-text">MySQL Slow Log</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%A0%E9%A2%98%E7%AD%94%E6%A1%88%E8%A7%A3%E6%9E%90"><span class="toc-number">14.</span> <span class="toc-text">习题答案解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#lab-2"><span class="toc-number">14.1.</span> <span class="toc-text">lab 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lab-3"><span class="toc-number">14.2.</span> <span class="toc-text">lab 3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lab-4"><span class="toc-number">14.3.</span> <span class="toc-text">lab 4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lab-5"><span class="toc-number">14.4.</span> <span class="toc-text">lab 5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lab-6"><span class="toc-number">14.5.</span> <span class="toc-text">lab 6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lab-8"><span class="toc-number">14.6.</span> <span class="toc-text">lab 8</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL-%E6%80%9D%E8%80%83%EF%BC%9A"><span class="toc-number">15.</span> <span class="toc-text">SQL 思考：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%B0%E5%9C%A8%E9%83%BD%E6%9C%89%E9%82%A3%E4%BA%9B%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E6%AF%8F%E7%A7%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%8C%BA%E5%88%AB%E3%80%81%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E3%80%81%E4%BC%98%E7%82%B9%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">16.</span> <span class="toc-text">现在都有那些数据库，每种数据库的区别、应用场景、优点是什么</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3Mysql-SQL%E8%A7%A3%E6%9E%90%E5%99%A8%E3%80%81%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E3%80%81%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86"><span class="toc-number">17.</span> <span class="toc-text">了解Mysql SQL解析器、存储结构、索引结构相关知识</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DML-x2F-DDL-x2F-DCL%EF%BC%9A%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95%E6%8E%8C%E6%8F%A1%E3%80%82"><span class="toc-number">18.</span> <span class="toc-text">DML&#x2F;DDL&#x2F;DCL：基础用法掌握。</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%9F%A5%E8%AF%A2%E9%83%A8%E5%88%86%EF%BC%9A"><span class="toc-number">19.</span> <span class="toc-text">基础查询部分：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E5%AD%A6%E4%B9%A0"><span class="toc-number">20.</span> <span class="toc-text">MySQL常用函数学习</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%BB%E9%87%8DDISTINCT"><span class="toc-number">21.</span> <span class="toc-text">去重DISTINCT</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LIKE-x2F-NOT-LIKE"><span class="toc-number">22.</span> <span class="toc-text">LIKE&#x2F;NOT LIKE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IN-x2F-EXISTS"><span class="toc-number">23.</span> <span class="toc-text">IN&#x2F;EXISTS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5-x2F-%E5%85%A8%E8%BF%9E%E6%8E%A5-x2F-%E5%B7%A6%E5%8F%B3%E8%BF%9E%E6%8E%A5%E3%80%81%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">24.</span> <span class="toc-text">内连接&#x2F;全连接&#x2F;左右连接、子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2-1"><span class="toc-number">24.1.</span> <span class="toc-text">子查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TRUNCATE%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">25.</span> <span class="toc-text">TRUNCATE关键字</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E8%A1%A8DUAL"><span class="toc-number">26.</span> <span class="toc-text">虚拟表DUAL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9E%E8%A1%A8%E6%9F%A5%E8%AF%A2%EF%BC%9A%E5%8C%BA%E5%88%AB-x2F-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-x2F-%E8%81%94%E8%A1%A8%E9%99%90%E5%88%B6-amp-%E6%8A%80%E5%B7%A7-x2F-%E5%85%A8%E8%BF%9E%E6%8E%A5Where%E5%92%8COn%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">27.</span> <span class="toc-text">连表查询：区别&#x2F;使用场景&#x2F;联表限制&amp;技巧&#x2F;全连接Where和On的区别</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WITH-ROLLUP%E5%8F%8A%E5%85%B6%E4%BB%96%E5%85%B3%E9%94%AE%E5%AD%97-x2F-%E6%96%B0%E7%89%B9%E6%80%A7%E4%BA%86%E8%A7%A3%E3%80%82"><span class="toc-number">28.</span> <span class="toc-text">WITH ROLLUP及其他关键字&#x2F;新特性了解。</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E7%BB%83%E4%B9%A0sql"><span class="toc-number">29.</span> <span class="toc-text">一些练习sql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6"><span class="toc-number">30.</span> <span class="toc-text">约束条件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E7%A7%8D%E4%BF%AE%E6%94%B9%E6%88%96%E6%8F%92%E5%85%A5%E7%9A%84%E5%8A%9E%E6%B3%95"><span class="toc-number">31.</span> <span class="toc-text">一种修改或插入的办法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#insert-ignore-into"><span class="toc-number">32.</span> <span class="toc-text">insert ignore into</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8%E5%86%85%E5%AE%B9%E7%9A%84%E5%87%A0%E4%B8%AA%E6%96%B9%E5%BC%8F"><span class="toc-number">33.</span> <span class="toc-text">删除表内容的几个方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E8%A1%A8%E7%9A%84%E5%87%A0%E4%B8%AA%E6%96%B9%E5%BC%8F"><span class="toc-number">34.</span> <span class="toc-text">复制表的几个方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mysql%E5%AD%98%E5%82%A8%E6%96%87%E4%BB%B6"><span class="toc-number">35.</span> <span class="toc-text">mysql存储文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#linux-mysql%E6%89%A7%E8%A1%8CSQL%E6%96%87%E4%BB%B6"><span class="toc-number">36.</span> <span class="toc-text">linux mysql执行SQL文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A3%81%E5%89%AA%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">37.</span> <span class="toc-text">裁剪字符串</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%90%AF-x2F-%E6%8F%90%E4%BA%A4-x2F-%E5%9B%9E%E6%BB%9A%E4%BA%8B%E5%8A%A1"><span class="toc-number">38.</span> <span class="toc-text">开启&#x2F;提交&#x2F;回滚事务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-1"><span class="toc-number">39.</span> <span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%9A%E7%B0%87-x2F-%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95"><span class="toc-number">39.1.</span> <span class="toc-text">聚簇&#x2F;非聚簇索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-number">39.2.</span> <span class="toc-text">复合索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">39.3.</span> <span class="toc-text">回表查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="toc-number">39.4.</span> <span class="toc-text">覆盖索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-number">39.5.</span> <span class="toc-text">索引失效</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A9%B1%E5%8A%A8%E8%A1%A8"><span class="toc-number">40.</span> <span class="toc-text">驱动表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2"><span class="toc-number">41.</span> <span class="toc-text">慢查询</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">42.</span> <span class="toc-text">事务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undo-x2F-redo-log"><span class="toc-number">43.</span> <span class="toc-text">undo&#x2F;redo log</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mvcc"><span class="toc-number">44.</span> <span class="toc-text">mvcc</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5"><span class="toc-number">45.</span> <span class="toc-text">主从同步</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8"><span class="toc-number">46.</span> <span class="toc-text">分库分表</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/28/%E7%BB%8F%E9%AA%8C/%E9%BB%91%E7%A5%9E%E8%AF%9D%E7%A0%B4%E8%A7%A3%E7%89%88%E8%BF%90%E8%A1%8C/%E9%BB%91%E7%A5%9E%E8%AF%9D%E7%A0%B4%E8%A7%A3%E7%89%88%E8%BF%90%E8%A1%8C/" title="黑神话破解版运行">黑神话破解版运行</a><time datetime="2026-01-28T07:51:40.000Z" title="更新于 2026-01-28 15:51:40">2026-01-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/11/%E7%AC%94%E8%AE%B0/mi6x%E7%9B%B4%E4%BE%9B%E7%94%B5/mi6x%E7%9B%B4%E4%BE%9B%E7%94%B5/" title="mi6x直供电">mi6x直供电</a><time datetime="2026-01-11T15:35:19.000Z" title="更新于 2026-01-11 23:35:19">2026-01-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/07/%E7%AC%94%E8%AE%B0/win11%E5%90%AF%E5%8A%A8%E8%87%AA%E5%8A%A8%E6%89%93%E5%BC%80%E7%83%AD%E7%82%B9/win11%E5%90%AF%E5%8A%A8%E8%87%AA%E5%8A%A8%E6%89%93%E5%BC%80%E7%83%AD%E7%82%B9/" title="win11启动自动打开热点">win11启动自动打开热点</a><time datetime="2026-01-07T02:35:19.000Z" title="更新于 2026-01-07 10:35:19">2026-01-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/07/%E7%AC%94%E8%AE%B0/%E6%8A%93%E5%8F%96B%E7%AB%99%E7%9B%B4%E6%92%AD%E9%97%B4%E5%BC%B9%E5%B9%95/%E6%8A%93%E5%8F%96B%E7%AB%99%E7%9B%B4%E6%92%AD%E9%97%B4%E5%BC%B9%E5%B9%95/" title="抓取B站直播间弹幕">抓取B站直播间弹幕</a><time datetime="2026-01-07T02:35:19.000Z" title="更新于 2026-01-07 10:35:19">2026-01-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/20/%E7%AC%94%E8%AE%B0/Dart/Dart/" title="Dart">Dart</a><time datetime="2025-12-20T02:35:19.000Z" title="更新于 2025-12-20 10:35:19">2025-12-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2026 By Boranget</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>